<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="theme-color" content="#123456"><meta name="generator" content="Hexo 4.2.0"><title>XJH&#039;s Secret Base</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="XJH&#039;s Secret Base"><meta name="msapplication-TileImage" content="/img/logo.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="XJH&#039;s Secret Base"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="144x144" href="/img/logo.png"><meta name="description" content="XJH的秘密基地"><meta property="og:type" content="blog"><meta property="og:title" content="XJH&#039;s Secret Base"><meta property="og:url" content="http://asgard-tim.github.io/"><meta property="og:site_name" content="XJH&#039;s Secret Base"><meta property="og:description" content="XJH的秘密基地"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://asgard-tim.github.io/img/og_image.png"><meta property="article:author" content="明诚"><meta property="article:tag" content="XJH&#039;s blogs"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://asgard-tim.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://Asgard-Tim.github.io"},"headline":"XJH's Secret Base","image":["http://asgard-tim.github.io/img/og_image.png"],"author":{"@type":"Person","name":"明诚"},"publisher":{"@type":"Organization","name":"XJH's Secret Base","logo":{"@type":"ImageObject","url":"http://asgard-tim.github.io/img/title.png"}},"description":"XJH的秘密基地"}</script><link rel="icon" href="/img/logo.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/xt256.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><link rel="stylesheet" href="\assets\css\APlayer.min.css" class="aplayer-style-marker">
<script src="\assets\js\APlayer.min.js" class="aplayer-script-marker"></script>
<script src="\assets\js\Meting.min.js" class="meting-script-marker"></script>
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/title.png" alt="XJH&#039;s Secret Base" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">主页</a><a class="navbar-item" href="/archives">时间轴</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com">GitHub</a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Asgard-Tim"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><a class="image is-7by3" href="/2023/08/02/index/"><img class="fill" src="/images/book.jpeg" alt="Welcome to XJH&#039;s Secret Base!"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-08-02T11:52:30.000Z" title="2023/8/2 19:52:30">2023-08-02</time>发表</span><span class="level-item"><time dateTime="2024-02-12T06:20:50.590Z" title="2024/2/12 14:20:50">2024-02-12</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/About-XJH/">About XJH</a></span><span class="level-item">2 分钟读完 (大约292个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/02/index/">Welcome to XJH&#039;s Secret Base!</a></p><div class="content">
    <div id="aplayer-HLBLIkcD" class="aplayer aplayer-tag-marker meting-tag-marker"
         data-id="3136952023" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="0px" data-preload="auto" data-theme="#555" data-volume="0.5" data-order="list"
    ></div>

<h4 id="个人简介"><a href="#个人简介" class="headerlink" title="个人简介"></a><strong>个人简介</strong></h4><hr>
<p><em>We all started from nothing and yet still wants to be someone.</em> </p>
<p><em>We came to this world empty handed, so let’s make something with our bare hands.</em> </p>
<p><em>We never asked for much because we know that it’s the sweat from our perseverance that taste the sweetest.</em></p>
<p> <em>I started from nothing, but I will get there soon.</em></p>
<p><strong>-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</strong><br><strong>个人信息：</strong></p>
<p>CQU明月科创实验班在读</p>
<p>KPL资深观众</p>
<p>钢琴只有业余八级的A叔屑粉丝</p>
<p>音游玩家（主玩Phigros，入坑不是很久）</p>
<p><img src="/images/rks5.jpg" alt="截止2024/2/11 Phigros Ranking Score"></p>
<br>

<h4 id="本博客相关"><a href="#本博客相关" class="headerlink" title="本博客相关"></a><strong>本博客相关</strong></h4><hr>
<ul>
<li>网站采用的<a target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-icarus">Icarus主题</a> </li>
<li>追求尽可能的简洁，清晰，易用。</li>
</ul>
<p>基于已有主题的新增功能（均参考网上教程）：</p>
<ul>
<li>live-2D 看板娘</li>
<li>博客内音乐播放器</li>
</ul>
<br>

<h4 id="计划"><a href="#计划" class="headerlink" title="计划"></a><strong>计划</strong></h4><h5 id="2023秋季学期"><a href="#2023秋季学期" class="headerlink" title="2023秋季学期"></a><strong>2023秋季学期</strong></h5><hr>
<blockquote>
<ul>
<li><input disabled="" type="checkbox"> 英语学习，备战六级</li>
<li><input checked="" disabled="" type="checkbox"> python基础学习</li>
<li><input checked="" disabled="" type="checkbox"> 备赛大艺展</li>
<li><input disabled="" type="checkbox"> 《动手学深度学习》书本学习</li>
<li><input checked="" disabled="" type="checkbox"> 课程TASK：数理综合：吸管水泵</li>
<li><input disabled="" type="checkbox"> 课程TASK：工程设计：斯特林发动机</li>
<li><input checked="" disabled="" type="checkbox"> 大学化学课程学习与实验</li>
<li><input disabled="" type="checkbox"> 割草机器人项目</li>
</ul>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-11T14:13:58.000Z" title="2024/2/11 22:13:58">2024-02-11</time>发表</span><span class="level-item"><time dateTime="2024-02-11T14:24:26.595Z" title="2024/2/11 22:24:26">2024-02-11</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/About-XJH/">About XJH</a><span> / </span><a class="link-muted" href="/categories/About-XJH/%E6%98%8E%E6%85%B5/">明慵</a></span><span class="level-item">34 分钟读完 (大约5056个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/11/QQmsganalysis/">QQ聊天记录分析 QQMsgAnalysis</a></p><div class="content"><p>从PC端QQ中以<code>txt</code>格式导出聊天记录，存为<code>message.txt</code>。</p>
<p>需要安装的库: <code>numpy, seaborn, pandas, wordcloud, tdqm, paddlepaddle, paddlenlp</code></p>
<h2 id="准备阶段"><a href="#准备阶段" class="headerlink" title="准备阶段"></a>准备阶段</h2><h3 id="引入包"><a href="#引入包" class="headerlink" title="引入包"></a>引入包</h3><ul>
<li>pandas: 基础数据框架</li>
<li>matplotlib &amp; seaborn: 主要绘图框架</li>
<li>jieba: 中文分词</li>
<li>wordcloud: 词云</li>
<li>paddlenlp: 情感分析</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">import</span> jieba.posseg <span class="keyword">as</span> pseg</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> matplotlib.ticker <span class="keyword">as</span> mticker</span><br><span class="line"><span class="keyword">import</span> matplotlib.transforms <span class="keyword">as</span> mtransforms</span><br><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> ListedColormap</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> font_manager <span class="keyword">as</span> fm</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> paddlenlp <span class="keyword">import</span> Taskflow</span><br><span class="line">%matplotlib inline</span><br></pre></td></tr></table></figure>

<h3 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_messages</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    <span class="comment"># 定义CSV文件头部</span></span><br><span class="line">    header = [<span class="string">&quot;LocalId&quot;</span>, <span class="string">&quot;TalkerId&quot;</span>, <span class="string">&quot;Type&quot;</span>, <span class="string">&quot;SubType&quot;</span>, <span class="string">&quot;IsSender&quot;</span>, <span class="string">&quot;CreateTime&quot;</span>, <span class="string">&quot;Status&quot;</span>,</span><br><span class="line">              <span class="string">&quot;StrContent&quot;</span>, <span class="string">&quot;StrTime&quot;</span>, <span class="string">&quot;Remark&quot;</span>, <span class="string">&quot;NickName&quot;</span>, <span class="string">&quot;Sender&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打开输入和输出文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;w&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> outfile:</span><br><span class="line">        csv_writer = csv.writer(outfile)</span><br><span class="line">        csv_writer.writerow(header)  <span class="comment"># 写入头部</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 用集合存储姓名</span></span><br><span class="line">        names = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 逐行读取txt文件内容并转换为csv格式</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            lines = file.readlines()</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(lines), <span class="number">3</span>):</span><br><span class="line">                timestamp_and_name = lines[i].strip().split(<span class="string">&#x27; &#x27;</span>, <span class="number">2</span>)</span><br><span class="line">                date_time = timestamp_and_name[<span class="number">0</span>] + <span class="string">&#x27; &#x27;</span> + timestamp_and_name[<span class="number">1</span>]  <span class="comment"># 日期时间</span></span><br><span class="line">                name = timestamp_and_name[<span class="number">2</span>]  <span class="comment"># 姓名（或用户名）</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 根据姓名判断是否在指定范围内，如果不在，则跳过该条消息</span></span><br><span class="line">                <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;王婧怡(清辉)&quot;</span>, <span class="string">&quot;成王败寇。&quot;</span>, <span class="string">&quot;皇后&quot;</span>, <span class="string">&quot;王婧怡&quot;</span>, <span class="string">&quot;世界之巅&quot;</span>, <span class="string">&quot;2558749399&quot;</span>]:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                message = lines[i + <span class="number">1</span>].strip()  <span class="comment"># 消息内容</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 如果消息内容为空，则跳过该条消息</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> message:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 根据消息内容设置Type字段的值</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;[图片]&quot;</span> <span class="keyword">in</span> message:</span><br><span class="line">                    type_value = <span class="number">3</span></span><br><span class="line">                <span class="keyword">elif</span> <span class="string">&quot;[表情]&quot;</span> <span class="keyword">in</span> message:</span><br><span class="line">                    type_value = <span class="number">47</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    type_value = <span class="number">1</span>  <span class="comment"># 默认为1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 根据姓名设置IsSender字段的值</span></span><br><span class="line">                <span class="keyword">if</span> name <span class="keyword">in</span> [<span class="string">&quot;王婧怡(清辉)&quot;</span>, <span class="string">&quot;成王败寇。&quot;</span>, <span class="string">&quot;皇后&quot;</span>, <span class="string">&quot;王婧怡&quot;</span>]:</span><br><span class="line">                    is_sender = <span class="number">0</span></span><br><span class="line">                <span class="keyword">elif</span> name <span class="keyword">in</span> [<span class="string">&quot;世界之巅&quot;</span>, <span class="string">&quot;2558749399&quot;</span>]:</span><br><span class="line">                    is_sender = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 将姓名添加到集合中，如果之前没有出现过的话</span></span><br><span class="line">                <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> names:</span><br><span class="line">                    <span class="comment"># print(name)</span></span><br><span class="line">                    names.add(name)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 自动生成LocalId</span></span><br><span class="line">                local_id = i // <span class="number">3</span> + <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 构建CSV行</span></span><br><span class="line">                csv_row = [local_id, <span class="number">1</span>, type_value, <span class="number">0</span>, is_sender, i, <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                           message, date_time, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br><span class="line">                csv_writer.writerow(csv_row)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;转换完成，结果保存在 <span class="subst">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line"><span class="comment"># convert_messages(&quot;message.txt&quot;, &quot;messages.csv&quot;)</span></span><br></pre></td></tr></table></figure>

<h3 id="绘图设置"><a href="#绘图设置" class="headerlink" title="绘图设置"></a>绘图设置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sns.set_theme(style=<span class="string">&quot;ticks&quot;</span>)</span><br><span class="line">font = <span class="string">&quot;simsun.ttc&quot;</span></span><br><span class="line">fp = fm.FontProperties(fname=font)</span><br><span class="line">plt.rcParams[<span class="string">&quot;axes.unicode_minus&quot;</span>] = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="人名标签"><a href="#人名标签" class="headerlink" title="人名标签"></a>人名标签</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">labels = [<span class="string">&quot;WJY&quot;</span>, <span class="string">&quot;XJH&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="数据读取"><a href="#数据读取" class="headerlink" title="数据读取"></a>数据读取</h3><ul>
<li><code>filePath</code>: 消息记录文件的路径</li>
<li><code>dStart</code>: 开始的时间</li>
<li><code>dEnd</code>: 结束的时间</li>
<li><code>tZone</code>: 时区，例如北京时间为 <code>+8</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">filePath = <span class="string">&quot;messages.csv&quot;</span></span><br><span class="line">dStart = <span class="string">&quot;2022-08-07 00:00:00 +0800&quot;</span></span><br><span class="line">dEnd = <span class="string">&quot;2024-02-10 23:59:59 +0800&quot;</span></span><br><span class="line">tZone = <span class="number">8</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(filePath, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">df.loc[:, <span class="string">&quot;StrTime&quot;</span>] = pd.to_datetime(df[<span class="string">&quot;StrTime&quot;</span>])</span><br><span class="line">df.loc[:, <span class="string">&quot;day&quot;</span>] = pd.to_datetime(df[<span class="string">&quot;StrTime&quot;</span>]).dt.dayofweek</span><br><span class="line">df.loc[:, <span class="string">&quot;hour&quot;</span>] = pd.to_datetime(df[<span class="string">&quot;StrTime&quot;</span>]).dt.hour</span><br><span class="line">df.loc[:, <span class="string">&quot;Count&quot;</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">dfs = [df.query(<span class="string">&quot;IsSender == 0&quot;</span>), df.query(<span class="string">&quot;IsSender == 1&quot;</span>)]</span><br></pre></td></tr></table></figure>

<h3 id="消息过滤"><a href="#消息过滤" class="headerlink" title="消息过滤"></a>消息过滤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">textFilter</span>(<span class="params">text: <span class="built_in">str</span></span>):</span><br><span class="line">    text = text.lower()</span><br><span class="line">    <span class="comment"># try:</span></span><br><span class="line">    <span class="comment">#     co = re.compile(&quot;[\U00010000-\U0010ffff]&quot;)</span></span><br><span class="line">    <span class="comment"># except re.error:</span></span><br><span class="line">    <span class="comment">#     co = re.compile(&quot;[\uD800-\uDBFF][\uDC00-\uDFFF]&quot;)</span></span><br><span class="line">    <span class="comment"># text = co.sub(&quot; &quot;, text)</span></span><br><span class="line">    co = re.<span class="built_in">compile</span>(<span class="string">&quot;\[[\u4e00-\u9fa5]+\]&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> co.sub(<span class="string">&quot; &quot;</span>, text)</span><br></pre></td></tr></table></figure>

<h3 id="获取文本消息"><a href="#获取文本消息" class="headerlink" title="获取文本消息"></a>获取文本消息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">texts = [</span><br><span class="line">    [textFilter(i) <span class="keyword">for</span> i <span class="keyword">in</span> dfs[<span class="number">0</span>].query(<span class="string">&quot;Type == 1&quot;</span>)[<span class="string">&quot;StrContent&quot;</span>].to_list()],</span><br><span class="line">    [textFilter(i) <span class="keyword">for</span> i <span class="keyword">in</span> dfs[<span class="number">1</span>].query(<span class="string">&quot;Type == 1&quot;</span>)[<span class="string">&quot;StrContent&quot;</span>].to_list()],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="消息频率分析"><a href="#消息频率分析" class="headerlink" title="消息频率分析"></a>消息频率分析</h2><h3 id="类型分析"><a href="#类型分析" class="headerlink" title="类型分析"></a>类型分析</h3><p>根据消息的类型进行分类，可以看出喜欢发送的消息类型，同时也可以看出谁发的多</p>
<ul>
<li>1 &#x3D; Text</li>
<li>3 &#x3D; Image</li>
<li>34 &#x3D; Voice</li>
<li>43 &#x3D; Video</li>
<li>47 &#x3D; Sticker</li>
<li>48 &#x3D; Location</li>
<li>10000 &#x3D; System</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    data[labels[i]] = [</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">&quot;Type == 1&quot;</span>)),</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">&quot;Type == 3&quot;</span>)),</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">&quot;Type == 34&quot;</span>)),</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">&quot;Type == 43&quot;</span>)),</span><br><span class="line">        <span class="built_in">len</span>(dfs[i].query(<span class="string">&quot;Type == 47&quot;</span>)),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">data = (</span><br><span class="line">    pd.DataFrame(data, index=[<span class="string">&quot;Text&quot;</span>, <span class="string">&quot;Image&quot;</span>, <span class="string">&quot;Voice&quot;</span>, <span class="string">&quot;Video&quot;</span>, <span class="string">&quot;Sticker&quot;</span>])</span><br><span class="line">    .reset_index()</span><br><span class="line">    .melt(<span class="string">&quot;index&quot;</span>)</span><br><span class="line">    .rename(columns=&#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;Type&quot;</span>, <span class="string">&quot;variable&quot;</span>: <span class="string">&quot;Person&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;Count&quot;</span>&#125;)</span><br><span class="line">)</span><br><span class="line">g = sns.catplot(data, kind=<span class="string">&quot;bar&quot;</span>, x=<span class="string">&quot;Type&quot;</span>, y=<span class="string">&quot;Count&quot;</span>, hue=<span class="string">&quot;Person&quot;</span>, palette=<span class="string">&quot;dark&quot;</span>, alpha=<span class="number">0.6</span>, height=<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ax <span class="keyword">in</span> g.axes.ravel():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        ax.bar_label(ax.containers[i], fontsize=<span class="number">9</span>)</span><br><span class="line">sns.move_legend(g, <span class="string">&quot;upper right&quot;</span>)</span><br><span class="line">plt.yscale(<span class="string">&quot;log&quot;</span>)</span><br><span class="line"></span><br><span class="line">g.figure.set_size_inches(<span class="number">6</span>, <span class="number">5</span>)</span><br><span class="line">g.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_17_0.png" alt="png"></p>
<h3 id="消息长度分析"><a href="#消息长度分析" class="headerlink" title="消息长度分析"></a>消息长度分析</h3><ul>
<li><code>sN</code>: 设置显示范围：<br>$$<br>\mu + \mathrm{sN} * \sigma<br>$$</li>
<li><code>multiple</code>: 直方图堆叠格式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sN = <span class="number">3</span></span><br><span class="line">multiple = <span class="string">&quot;dodge&quot;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mu, std = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">data = &#123;<span class="string">&quot;Length&quot;</span>: [], <span class="string">&quot;Person&quot;</span>: []&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    length = [<span class="built_in">len</span>(textFilter(i)) <span class="keyword">for</span> i <span class="keyword">in</span> texts[i]]</span><br><span class="line">    data[<span class="string">&quot;Length&quot;</span>] += length</span><br><span class="line">    data[<span class="string">&quot;Person&quot;</span>] += [labels[i]] * <span class="built_in">len</span>(length)</span><br><span class="line">    <span class="keyword">if</span> np.mean(length) + sN * np.std(length) &gt; mu + std:</span><br><span class="line">        mu, std = np.mean(length), np.std(length)</span><br><span class="line">xlim = <span class="built_in">int</span>(np.ceil(mu + sN * std))</span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(data)</span><br><span class="line">bins = np.linspace(<span class="number">0</span>, xlim, xlim + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ax = sns.histplot(</span><br><span class="line">    data=data,</span><br><span class="line">    x=<span class="string">&quot;Length&quot;</span>,</span><br><span class="line">    hue=<span class="string">&quot;Person&quot;</span>,</span><br><span class="line">    bins=bins,</span><br><span class="line">    multiple=multiple,</span><br><span class="line">    edgecolor=<span class="string">&quot;.3&quot;</span>,</span><br><span class="line">    linewidth=<span class="number">0.5</span>,</span><br><span class="line">    palette=<span class="string">&quot;dark&quot;</span>,</span><br><span class="line">    alpha=<span class="number">0.6</span>,</span><br><span class="line">)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, xlim)</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Length of Message&quot;</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_20_0.png" alt="png"></p>
<h3 id="每日活跃分析"><a href="#每日活跃分析" class="headerlink" title="每日活跃分析"></a>每日活跃分析</h3><p>划分每日24小时内每小时发送的消息数，可以得知每天的活跃的时间段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;<span class="string">&quot;Time&quot;</span>: [], <span class="string">&quot;Person&quot;</span>: []&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    hour = dfs[i][<span class="string">&quot;hour&quot;</span>].to_list()</span><br><span class="line">    data[<span class="string">&quot;Time&quot;</span>] += hour</span><br><span class="line">    data[<span class="string">&quot;Person&quot;</span>] += [labels[i]] * <span class="built_in">len</span>(hour)</span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(data)</span><br><span class="line">bins = np.arange(<span class="number">0</span>, <span class="number">25</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ax = sns.histplot(</span><br><span class="line">    data=data,</span><br><span class="line">    x=<span class="string">&quot;Time&quot;</span>,</span><br><span class="line">    hue=<span class="string">&quot;Person&quot;</span>,</span><br><span class="line">    bins=bins,</span><br><span class="line">    multiple=multiple,</span><br><span class="line">    edgecolor=<span class="string">&quot;.3&quot;</span>,</span><br><span class="line">    linewidth=<span class="number">0.5</span>,</span><br><span class="line">    palette=<span class="string">&quot;dark&quot;</span>,</span><br><span class="line">    alpha=<span class="number">0.6</span>,</span><br><span class="line">)</span><br><span class="line">ax.set_xticks(bins)</span><br><span class="line">ax.set_xticklabels(bins)</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Hour&quot;</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">24</span>)</span><br><span class="line">sns.move_legend(ax, loc=<span class="string">&quot;upper center&quot;</span>, bbox_to_anchor=(<span class="number">0.5</span>, <span class="number">1.2</span>), ncol=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_22_0.png" alt="png"></p>
<h3 id="每周活跃分析"><a href="#每周活跃分析" class="headerlink" title="每周活跃分析"></a>每周活跃分析</h3><p>查看一周内从周一到周日每天发送的消息数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">&quot;day&quot;</span>)</span><br><span class="line">data = df.groupby(grouper)[<span class="string">&quot;Count&quot;</span>].<span class="built_in">sum</span>()</span><br><span class="line">data = data.sort_index()</span><br><span class="line">data.index = [<span class="string">&quot;Mon&quot;</span>, <span class="string">&quot;Tue&quot;</span>, <span class="string">&quot;Wed&quot;</span>, <span class="string">&quot;Thu&quot;</span>, <span class="string">&quot;Fri&quot;</span>, <span class="string">&quot;Sat&quot;</span>, <span class="string">&quot;Sun&quot;</span>]</span><br><span class="line"></span><br><span class="line">ax = sns.barplot(data=data, errorbar=<span class="literal">None</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Weekday&quot;</span>)</span><br><span class="line">ax.bar_label(ax.containers[<span class="number">0</span>], fontsize=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_24_0.png" alt="png"></p>
<h3 id="按周划分年度活跃分析"><a href="#按周划分年度活跃分析" class="headerlink" title="按周划分年度活跃分析"></a>按周划分年度活跃分析</h3><p>划分每7天内发送的消息数，可以得知每周的活跃的时间段</p>
<ul>
<li><code>wTicks</code>: 每个刻度相差的数值</li>
<li><code>wStart</code>: <strong>当年</strong>第一个周一的日期</li>
<li><code>wEnd</code>: <strong>次年</strong>第一个周一的日期</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wTicks = <span class="number">500</span></span><br><span class="line">wStart = <span class="string">&quot;2022-08-01&quot;</span></span><br><span class="line">wEnd = <span class="string">&quot;2024-02-09&quot;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">&quot;StrTime&quot;</span>, freq=<span class="string">&quot;W-MON&quot;</span>)</span><br><span class="line">data = df.groupby(grouper)[<span class="string">&quot;Count&quot;</span>].<span class="built_in">sum</span>().to_frame()</span><br><span class="line">data.index = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">&quot;W-MON&quot;</span>).strftime(<span class="string">&quot;%m-%d&quot;</span>)</span><br><span class="line">data.columns = [<span class="string">&quot;Count&quot;</span>]</span><br><span class="line"></span><br><span class="line">vM = np.ceil(data[<span class="string">&quot;Count&quot;</span>].<span class="built_in">max</span>() / wTicks) * wTicks</span><br><span class="line">norm = plt.Normalize(<span class="number">0</span>, vM)</span><br><span class="line">sm = plt.cm.ScalarMappable(cmap=<span class="string">&quot;Reds&quot;</span>, norm=norm)</span><br><span class="line"></span><br><span class="line">ax = sns.barplot(x=data.index, y=data[<span class="string">&quot;Count&quot;</span>], hue=data[<span class="string">&quot;Count&quot;</span>], hue_norm=norm, palette=<span class="string">&quot;Reds&quot;</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Date&quot;</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line"><span class="keyword">for</span> bar <span class="keyword">in</span> ax.containers:</span><br><span class="line">    ax.bar_label(bar, fontsize=<span class="number">10</span>, fmt=<span class="string">&quot;%.0f&quot;</span>)</span><br><span class="line">ax.get_legend().remove()</span><br><span class="line"></span><br><span class="line">axpos = ax.get_position()</span><br><span class="line">caxpos = mtransforms.Bbox.from_extents(axpos.x1 + <span class="number">0.02</span>, axpos.y0, axpos.x1 + <span class="number">0.03</span>, axpos.y1)</span><br><span class="line">cax = ax.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">locator = mticker.MultipleLocator(wTicks)</span><br><span class="line">formatter = mticker.StrMethodFormatter(<span class="string">&quot;&#123;x:.0f&#125;&quot;</span>)</span><br><span class="line">cax.figure.colorbar(sm, cax=cax, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
</code></pre>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_27_1.png" alt="png"></p>
<h3 id="按周划分聊天热情分析"><a href="#按周划分聊天热情分析" class="headerlink" title="按周划分聊天热情分析"></a>按周划分聊天热情分析</h3><p>划分每7天内的聊天热情指数，聊天热情指数为发送的消息数减去收到的消息数与总消息数的比值：<br>$$<br>E &#x3D; \frac{Q_\mathrm{S} - Q_\mathrm{R}}{Q_\mathrm{S} + Q_\mathrm{R}}<br>$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">&quot;StrTime&quot;</span>, freq=<span class="string">&quot;W-MON&quot;</span>)</span><br><span class="line">df_W1 = dfs[<span class="number">0</span>].groupby(grouper)[<span class="string">&quot;Count&quot;</span>].<span class="built_in">sum</span>()</span><br><span class="line">df_W2 = dfs[<span class="number">1</span>].groupby(grouper)[<span class="string">&quot;Count&quot;</span>].<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(&#123;<span class="string">&quot;E&quot;</span>: (df_W1 - df_W2) / (df_W1 + df_W2)&#125;)</span><br><span class="line">data.index = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">&quot;W-MON&quot;</span>).strftime(<span class="string">&quot;%m-%d&quot;</span>)</span><br><span class="line"></span><br><span class="line">vM = data[<span class="string">&quot;E&quot;</span>].<span class="built_in">abs</span>().<span class="built_in">max</span>()</span><br><span class="line">vm = data[<span class="string">&quot;E&quot;</span>].<span class="built_in">min</span>()</span><br><span class="line">norm = plt.Normalize(-vM, vM)</span><br><span class="line">sm = plt.cm.ScalarMappable(cmap=<span class="string">&quot;coolwarm&quot;</span>, norm=norm)</span><br><span class="line"><span class="built_in">print</span>(data.index)</span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&quot;E&quot;</span>])</span><br><span class="line"><span class="keyword">if</span> data[<span class="string">&quot;E&quot;</span>].isna().<span class="built_in">any</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;列 &#x27;E&#x27; 中包含NaN项&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;列 &#x27;E&#x27; 中不包含NaN项&quot;</span>)</span><br><span class="line">data[<span class="string">&quot;E&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">ax = sns.barplot(x=data.index, y=data[<span class="string">&quot;E&quot;</span>], hue=data[<span class="string">&quot;E&quot;</span>], hue_norm=norm, palette=<span class="string">&quot;coolwarm&quot;</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Date&quot;</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Enthusiasm Index&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> bar <span class="keyword">in</span> ax.containers:</span><br><span class="line">    ax.bar_label(bar, fontsize=<span class="number">10</span>, fmt=<span class="string">&quot;%.2f&quot;</span>)</span><br><span class="line">ax.get_legend().remove()</span><br><span class="line"></span><br><span class="line">axpos = ax.get_position()</span><br><span class="line">caxpos = mtransforms.Bbox.from_extents(axpos.x1 + <span class="number">0.02</span>, axpos.y0, axpos.x1 + <span class="number">0.03</span>, axpos.y1)</span><br><span class="line">cax = ax.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">locator = mticker.MultipleLocator(<span class="number">0.1</span>)</span><br><span class="line">formatter = mticker.StrMethodFormatter(<span class="string">&quot;&#123;x:.2f&#125;&quot;</span>)</span><br><span class="line">cax.figure.colorbar(sm, cax=cax, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
F:\user\Temp\ipykernel_9048\3741989350.py:18: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing &#39;df[col].method(value, inplace=True)&#39;, try using &#39;df.method(&#123;col: value&#125;, inplace=True)&#39; or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.
</code></pre>
<p>​<br>​      data[“E”].fillna(0, inplace&#x3D;True)</p>
<pre><code>Index([&#39;08-01&#39;, &#39;08-08&#39;, &#39;08-15&#39;, &#39;08-22&#39;, &#39;08-29&#39;, &#39;09-05&#39;, &#39;09-12&#39;, &#39;09-19&#39;,
       &#39;09-26&#39;, &#39;10-03&#39;, &#39;10-10&#39;, &#39;10-17&#39;, &#39;10-24&#39;, &#39;10-31&#39;, &#39;11-07&#39;, &#39;11-14&#39;,
       &#39;11-21&#39;, &#39;11-28&#39;, &#39;12-05&#39;, &#39;12-12&#39;, &#39;12-19&#39;, &#39;12-26&#39;, &#39;01-02&#39;, &#39;01-09&#39;,
       &#39;01-16&#39;, &#39;01-23&#39;, &#39;01-30&#39;, &#39;02-06&#39;, &#39;02-13&#39;, &#39;02-20&#39;, &#39;02-27&#39;, &#39;03-06&#39;,
       &#39;03-13&#39;, &#39;03-20&#39;, &#39;03-27&#39;, &#39;04-03&#39;, &#39;04-10&#39;, &#39;04-17&#39;, &#39;04-24&#39;, &#39;05-01&#39;,
       &#39;05-08&#39;, &#39;05-15&#39;, &#39;05-22&#39;, &#39;05-29&#39;, &#39;06-05&#39;, &#39;06-12&#39;, &#39;06-19&#39;, &#39;06-26&#39;,
       &#39;07-03&#39;, &#39;07-10&#39;, &#39;07-17&#39;, &#39;07-24&#39;, &#39;07-31&#39;, &#39;08-07&#39;, &#39;08-14&#39;, &#39;08-21&#39;,
       &#39;08-28&#39;, &#39;09-04&#39;, &#39;09-11&#39;, &#39;09-18&#39;, &#39;09-25&#39;, &#39;10-02&#39;, &#39;10-09&#39;, &#39;10-16&#39;,
       &#39;10-23&#39;, &#39;10-30&#39;, &#39;11-06&#39;, &#39;11-13&#39;, &#39;11-20&#39;, &#39;11-27&#39;, &#39;12-04&#39;, &#39;12-11&#39;,
       &#39;12-18&#39;, &#39;12-25&#39;, &#39;01-01&#39;, &#39;01-08&#39;, &#39;01-15&#39;, &#39;01-22&#39;, &#39;01-29&#39;, &#39;02-05&#39;],
      dtype=&#39;object&#39;)
08-01    0.120000
08-08    0.109091
08-15    0.071633
08-22   -0.007092
08-29    0.075426
           ...   
01-08   -0.003752
01-15    0.100529
01-22    0.159184
01-29    0.068273
02-05    0.014085
Name: E, Length: 80, dtype: float64
列 &#39;E&#39; 中包含NaN项
</code></pre>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_29_2.png" alt="png"></p>
<h3 id="按日划分年度活跃分析"><a href="#按日划分年度活跃分析" class="headerlink" title="按日划分年度活跃分析"></a>按日划分年度活跃分析</h3><p>以热力图的方式展示按日划分的年度活跃情况</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">&quot;StrTime&quot;</span>, freq=<span class="string">&quot;D&quot;</span>)</span><br><span class="line">data = df.groupby(grouper)[<span class="string">&quot;Count&quot;</span>].<span class="built_in">sum</span>()</span><br><span class="line">data = data.to_frame()</span><br><span class="line"></span><br><span class="line">wStart = <span class="string">&quot;2023-01-01&quot;</span></span><br><span class="line">wEnd = <span class="string">&quot;2024-01-01&quot;</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">&quot;date&quot;</span>] = data.index</span><br><span class="line">data[<span class="string">&quot;week&quot;</span>] = data[<span class="string">&quot;date&quot;</span>].dt.isocalendar()[<span class="string">&quot;week&quot;</span>]</span><br><span class="line">data[<span class="string">&quot;day&quot;</span>] = data[<span class="string">&quot;date&quot;</span>].dt.dayofweek</span><br><span class="line">data.index = <span class="built_in">range</span>(<span class="built_in">len</span>(data))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">if</span> data.loc[i, <span class="string">&quot;week&quot;</span>] &gt; <span class="number">1</span>:</span><br><span class="line">        data.loc[i, <span class="string">&quot;week&quot;</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">data = data.pivot_table(index=<span class="string">&quot;day&quot;</span>, columns=<span class="string">&quot;week&quot;</span>, values=<span class="string">&quot;Count&quot;</span>)</span><br><span class="line">data.index = [<span class="string">&quot;Mon&quot;</span>, <span class="string">&quot;Tue&quot;</span>, <span class="string">&quot;Wed&quot;</span>, <span class="string">&quot;Thu&quot;</span>, <span class="string">&quot;Fri&quot;</span>, <span class="string">&quot;Sat&quot;</span>, <span class="string">&quot;Sun&quot;</span>]</span><br><span class="line">data.columns = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">&quot;W-MON&quot;</span>).strftime(<span class="string">&quot;%m-%d&quot;</span>)</span><br><span class="line"></span><br><span class="line">ax = sns.heatmap(</span><br><span class="line">    data,</span><br><span class="line">    annot=<span class="literal">False</span>,</span><br><span class="line">    linewidths=<span class="number">0.5</span>,</span><br><span class="line">    cbar_kws=&#123;<span class="string">&quot;orientation&quot;</span>: <span class="string">&quot;vertical&quot;</span>, <span class="string">&quot;location&quot;</span>: <span class="string">&quot;left&quot;</span>, <span class="string">&quot;pad&quot;</span>: <span class="number">0.03</span>&#125;,</span><br><span class="line">    cmap=<span class="string">&quot;Reds&quot;</span>,</span><br><span class="line">)</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Week&quot;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Weekday&quot;</span>)</span><br><span class="line">ax.figure.set_size_inches(<span class="number">24</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)


     Count       date  week  day
0       46 2022-08-07     0    6
1      104 2022-08-08     0    0
2      100 2022-08-09     0    1
3       47 2022-08-10     0    2
4        3 2022-08-11     0    3
..     ...        ...   ...  ...
547     76 2024-02-05     6    0
548      0 2024-02-06     6    1
549      0 2024-02-07     6    2
550     47 2024-02-08     6    3
551     24 2024-02-09     6    4

[552 rows x 4 columns]
</code></pre>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_31_2.png" alt="png"></p>
<h2 id="词语分析"><a href="#词语分析" class="headerlink" title="词语分析"></a>词语分析</h2><h3 id="分词词典、停止词与去除词性"><a href="#分词词典、停止词与去除词性" class="headerlink" title="分词词典、停止词与去除词性"></a>分词词典、停止词与去除词性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jieba.load_userdict(<span class="string">&quot;thuocl.txt&quot;</span>)</span><br><span class="line">jieba.load_userdict(<span class="string">&quot;userdict.txt&quot;</span>)</span><br><span class="line">stopwords = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&quot;stopwords.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).readlines()] + [<span class="string">&quot; &quot;</span>, <span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\r\n&quot;</span>]</span><br><span class="line">wordclass = [<span class="string">&quot;v&quot;</span>, <span class="string">&quot;u&quot;</span>, <span class="string">&quot;vd&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="string">&quot;p&quot;</span>, <span class="string">&quot;w&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="分词函数"><a href="#分词函数" class="headerlink" title="分词函数"></a>分词函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">wordSplit</span>(<span class="params">texts, wordclass</span>):</span><br><span class="line">    words = []</span><br><span class="line">    pbar = tqdm(total=<span class="built_in">len</span>(texts))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(texts)):</span><br><span class="line">        res = pseg.lcut(texts[i])</span><br><span class="line">        <span class="keyword">for</span> pair <span class="keyword">in</span> res:</span><br><span class="line">            <span class="keyword">if</span> pair.word <span class="keyword">in</span> stopwords:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> pair.flag <span class="keyword">in</span> wordclass:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            words.append(pair.word)</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">            pbar.update(<span class="number">1000</span>)</span><br><span class="line">    pbar.close()</span><br><span class="line">    <span class="keyword">return</span> words</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">words = [wordSplit(texts[i], wordclass) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br></pre></td></tr></table></figure>

<pre><code>15000it [00:08, 1837.45it/s]                           
17000it [00:07, 2395.06it/s]                           
</code></pre>
<h3 id="词云绘制"><a href="#词云绘制" class="headerlink" title="词云绘制"></a>词云绘制</h3><ul>
<li><code>font</code>: 字体路径，至少支持中文，最好同时支持中文和emoji</li>
<li><code>mask</code>: 词云的蒙版，影响词云的形状</li>
<li><code>cmap</code>: 色阶</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">font = <span class="string">&quot;simsun.ttc&quot;</span></span><br><span class="line">mask = np.array(Image.<span class="built_in">open</span>(<span class="string">&quot;mask.png&quot;</span>))</span><br><span class="line">masks = [np.array(Image.<span class="built_in">open</span>(<span class="string">&quot;mask_L.jpg&quot;</span>)), np.array(Image.<span class="built_in">open</span>(<span class="string">&quot;mask_F.jpg&quot;</span>))]</span><br><span class="line">cmap = ListedColormap(</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;#fac1cf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#a9d7ba&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#58b1db&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#f296ab&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#5dab81&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#3d9ec4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#e16a8d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#237b50&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#1e8299&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#8d3549&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#35563b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;#2d5d73&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">wordCloud</span>(<span class="params">text, font, mask, cmap</span>):</span><br><span class="line">    wc = WordCloud(</span><br><span class="line">        background_color=<span class="string">&quot;white&quot;</span>,</span><br><span class="line">        scale=<span class="number">5</span>,</span><br><span class="line">        font_path=font,</span><br><span class="line">        mask=mask,</span><br><span class="line">        colormap=cmap,</span><br><span class="line">        collocations=<span class="literal">False</span>,</span><br><span class="line">    ).generate(text)</span><br><span class="line">    plt.imshow(wc)</span><br><span class="line">    plt.axis(<span class="string">&quot;off&quot;</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wordCloud(<span class="string">&quot; &quot;</span>.join(words[<span class="number">0</span>]), font, masks[<span class="number">0</span>], cmap)</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_40_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wordCloud(<span class="string">&quot; &quot;</span>.join(words[<span class="number">1</span>]), font, masks[<span class="number">1</span>], cmap)</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_41_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wordCloud(<span class="string">&quot; &quot;</span>.join(words[<span class="number">0</span>] + words[<span class="number">1</span>]), font, mask, cmap)</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_42_0.png" alt="png"></p>
<h3 id="高频词排行"><a href="#高频词排行" class="headerlink" title="高频词排行"></a>高频词排行</h3><p>列出常用的 N 个词，并且展示双方的贡献</p>
<ul>
<li><code>wN</code>: 词的数目，默认为50</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wN = <span class="number">50</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data = pd.DataFrame(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;words&quot;</span>: words[<span class="number">0</span>] + words[<span class="number">1</span>],</span><br><span class="line">        <span class="string">&quot;L&quot;</span>: [<span class="number">1</span>] * <span class="built_in">len</span>(words[<span class="number">0</span>]) + [<span class="number">0</span>] * <span class="built_in">len</span>(words[<span class="number">1</span>]),</span><br><span class="line">        <span class="string">&quot;F&quot;</span>: [<span class="number">0</span>] * <span class="built_in">len</span>(words[<span class="number">0</span>]) + [<span class="number">1</span>] * <span class="built_in">len</span>(words[<span class="number">1</span>]),</span><br><span class="line">        <span class="string">&quot;S&quot;</span>: [<span class="number">1</span>] * <span class="built_in">len</span>(words[<span class="number">0</span>]) + [<span class="number">1</span>] * <span class="built_in">len</span>(words[<span class="number">1</span>]),</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">grouper = pd.Grouper(key=<span class="string">&quot;words&quot;</span>)</span><br><span class="line">data = data.groupby(grouper).<span class="built_in">sum</span>()</span><br><span class="line">data = data.sort_values(by=<span class="string">&quot;S&quot;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">data = data.iloc[:wN]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将部分无法识别的 emoji 转化为文字</span></span><br><span class="line">tmp = data.index.to_list()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(wN):</span><br><span class="line">    <span class="keyword">if</span> tmp[i] == <span class="string">&quot;😘&quot;</span>:</span><br><span class="line">        tmp[i] = <span class="string">&quot;[亲亲]&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> tmp[i] == <span class="string">&quot;😂&quot;</span>:</span><br><span class="line">        tmp[i] = <span class="string">&quot;[笑哭]&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> tmp[i] == <span class="string">&quot;🤦&quot;</span>:</span><br><span class="line">        tmp[i] = <span class="string">&quot;[捂脸]&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> tmp[i] == <span class="string">&quot;😁&quot;</span>:</span><br><span class="line">        tmp[i] = <span class="string">&quot;[呲牙]&quot;</span></span><br><span class="line">data.index = tmp</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">ratio = data[<span class="string">&quot;L&quot;</span>] / data[<span class="string">&quot;S&quot;</span>]</span><br><span class="line">norm = plt.Normalize(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">sm = plt.cm.ScalarMappable(cmap=<span class="string">&quot;coolwarm&quot;</span>, norm=norm)</span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>), dpi=<span class="number">300</span>)</span><br><span class="line">grid = plt.GridSpec(<span class="number">1</span>, <span class="number">4</span>, wspace=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">ax0 = fig.add_subplot(grid[<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">sns.barplot(x=-data[<span class="string">&quot;L&quot;</span>], y=data.index, ax=ax0, hue=ratio, hue_norm=norm, palette=<span class="string">&quot;coolwarm&quot;</span>)</span><br><span class="line">ax1 = fig.add_subplot(grid[<span class="number">0</span>, <span class="number">1</span>:])</span><br><span class="line">sns.barplot(x=data[<span class="string">&quot;F&quot;</span>], y=data.index, ax=ax1, hue=(<span class="number">1</span> - ratio), hue_norm=norm, palette=<span class="string">&quot;coolwarm&quot;</span>)</span><br><span class="line"></span><br><span class="line">ax0.set_xlabel(<span class="string">&quot;Word Frequency&quot;</span>)</span><br><span class="line">ax0.set_ylabel(<span class="string">&quot;&quot;</span>)</span><br><span class="line">ax0.set_xticks(<span class="built_in">range</span>(-<span class="number">400</span>, <span class="number">1</span>, <span class="number">200</span>))</span><br><span class="line">ax0.set_xticklabels([<span class="number">400</span>, <span class="number">200</span>, <span class="number">0</span>])</span><br><span class="line">ax0.set_xlim(-<span class="number">400</span>, <span class="number">0</span>)</span><br><span class="line">ax0.set_yticks([])</span><br><span class="line">ax0.spines[<span class="string">&quot;left&quot;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax0.spines[<span class="string">&quot;top&quot;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax0.spines[<span class="string">&quot;right&quot;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax0.set_title(<span class="string">&quot;WJY&quot;</span>)</span><br><span class="line">ax0.get_legend().remove()</span><br><span class="line"></span><br><span class="line">ax1.set_xlabel(<span class="string">&quot;Word Frequency&quot;</span>)</span><br><span class="line">ax1.set_ylabel(<span class="string">&quot;&quot;</span>)</span><br><span class="line">ax1.set_xticks(<span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1201</span>, <span class="number">200</span>))</span><br><span class="line">ax1.set_xticklabels([<span class="number">0</span>, <span class="number">200</span>, <span class="number">400</span>, <span class="number">600</span>, <span class="number">800</span>, <span class="number">1000</span>, <span class="number">1200</span>])</span><br><span class="line">ax1.set_xlim(<span class="number">0</span>, <span class="number">1200</span>)</span><br><span class="line">ax1.set_yticks([])</span><br><span class="line">ax1.spines[<span class="string">&quot;left&quot;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax1.spines[<span class="string">&quot;top&quot;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax1.spines[<span class="string">&quot;right&quot;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax1.set_title(<span class="string">&quot;XJH&quot;</span>)</span><br><span class="line">ax1.get_legend().remove()</span><br><span class="line"></span><br><span class="line">axpos = ax1.get_position()</span><br><span class="line">caxpos = mtransforms.Bbox.from_extents(axpos.x0 + <span class="number">0.06</span>, axpos.y0 + <span class="number">0.03</span>, axpos.x1, axpos.y0 + <span class="number">0.04</span>)</span><br><span class="line">cax = ax1.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">locator = mticker.MultipleLocator(<span class="number">0.1</span>)</span><br><span class="line">formatter = mticker.StrMethodFormatter(<span class="string">&quot;&#123;x:.1f&#125;&quot;</span>)</span><br><span class="line">cax.figure.colorbar(sm, cax=cax, orientation=<span class="string">&quot;horizontal&quot;</span>, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"><span class="comment"># cax.tick_params(top=True, labeltop=True, bottom=False, labelbottom=False)</span></span><br><span class="line">cax.set_title(<span class="string">&quot;ratio&quot;</span>)</span><br><span class="line"></span><br><span class="line">x0 = ax0.get_position().x1</span><br><span class="line">x1 = ax1.get_position().x0</span><br><span class="line">xm = (x0 + x1) / <span class="number">2</span></span><br><span class="line">y0 = ax0.get_position().y0</span><br><span class="line">y1 = ax0.get_position().y1</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(wN):</span><br><span class="line">    fig.text(</span><br><span class="line">        xm, y0 + (y1 - y0) * (wN - i - <span class="number">0.5</span>) / wN, data.index[i],</span><br><span class="line">        color=<span class="string">&quot;black&quot;</span>, ha=<span class="string">&quot;center&quot;</span>, va=<span class="string">&quot;center&quot;</span>, fontproperties=fp</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">fig.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_47_0.png" alt="png"></p>
<h2 id="情感分析"><a href="#情感分析" class="headerlink" title="情感分析"></a>情感分析</h2><p>使用 <code>paddlenlp</code> 进行情感分析，得到的分数在 [-1, 1] 之间，越小越消极，越大越积极</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dfE = df.query(<span class="string">&quot;Type == 1&quot;</span>)[[<span class="string">&quot;IsSender&quot;</span>, <span class="string">&quot;StrContent&quot;</span>, <span class="string">&quot;StrTime&quot;</span>, <span class="string">&quot;hour&quot;</span>]]</span><br><span class="line">dfE.index = <span class="built_in">range</span>(<span class="built_in">len</span>(dfE))</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">senta = Taskflow(<span class="string">&quot;sentiment_analysis&quot;</span>, home_path=<span class="string">&quot;./&quot;</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scores = pd.DataFrame(senta([textFilter(i) <span class="keyword">for</span> i <span class="keyword">in</span> dfE[<span class="string">&quot;StrContent&quot;</span>].to_list()]))</span><br><span class="line">scores.loc[scores[<span class="string">&quot;label&quot;</span>] == <span class="string">&quot;negative&quot;</span>, <span class="string">&quot;score&quot;</span>] = <span class="number">1</span> - scores.loc[scores[<span class="string">&quot;label&quot;</span>] == <span class="string">&quot;negative&quot;</span>, <span class="string">&quot;score&quot;</span>]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dfE[<span class="string">&quot;score&quot;</span>] = scores[<span class="string">&quot;score&quot;</span>]</span><br><span class="line">dfE[<span class="string">&quot;score&quot;</span>] = <span class="number">2</span> * dfE[<span class="string">&quot;score&quot;</span>] - <span class="number">1</span></span><br><span class="line">dfE[<span class="string">&quot;Person&quot;</span>] = dfE.apply(<span class="keyword">lambda</span> x: labels[x[<span class="string">&quot;IsSender&quot;</span>]], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dfEs = [dfE.query(<span class="string">&quot;IsSender == 0&quot;</span>), dfE.query(<span class="string">&quot;IsSender == 1&quot;</span>)]</span><br></pre></td></tr></table></figure>

<h3 id="年度总体情感分布"><a href="#年度总体情感分布" class="headerlink" title="年度总体情感分布"></a>年度总体情感分布</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ax = sns.histplot(data=dfE, x=<span class="string">&quot;score&quot;</span>, hue=<span class="string">&quot;Person&quot;</span>, palette=<span class="string">&quot;dark&quot;</span>, alpha=<span class="number">0.6</span>, bins=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Sentiment Score&quot;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Count&quot;</span>)</span><br><span class="line">ax.set_title(<span class="string">&quot;Sentiment Distribution&quot;</span>)</span><br><span class="line">ax.set_xlim(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">3</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_54_0.png" alt="png"></p>
<h3 id="按周统计平均情感指数"><a href="#按周统计平均情感指数" class="headerlink" title="按周统计平均情感指数"></a>按周统计平均情感指数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">weekAvgSenScore</span>(<span class="params">df</span>):</span><br><span class="line">    wStart = <span class="string">&quot;2022-08-01&quot;</span></span><br><span class="line">    wEnd = <span class="string">&quot;2024-02-10&quot;</span></span><br><span class="line"></span><br><span class="line">    grouper = pd.Grouper(key=<span class="string">&quot;StrTime&quot;</span>, freq=<span class="string">&quot;W-MON&quot;</span>)</span><br><span class="line">    data = df.groupby(grouper)[<span class="string">&quot;score&quot;</span>].mean().to_frame()</span><br><span class="line">    data.index = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">&quot;W-MON&quot;</span>).strftime(<span class="string">&quot;%m-%d&quot;</span>)</span><br><span class="line">    data.columns = [<span class="string">&quot;score&quot;</span>]</span><br><span class="line"></span><br><span class="line">    vM = data[<span class="string">&quot;score&quot;</span>].<span class="built_in">abs</span>().<span class="built_in">max</span>()</span><br><span class="line">    norm = plt.Normalize(-vM, vM)</span><br><span class="line">    sm = plt.cm.ScalarMappable(cmap=<span class="string">&quot;coolwarm&quot;</span>, norm=norm)</span><br><span class="line">    data[<span class="string">&quot;score&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    ax = sns.barplot(x=data.index, y=data[<span class="string">&quot;score&quot;</span>], hue=data[<span class="string">&quot;score&quot;</span>], hue_norm=norm, palette=<span class="string">&quot;coolwarm&quot;</span>)</span><br><span class="line">    ax.set_xlabel(<span class="string">&quot;Date&quot;</span>)</span><br><span class="line">    plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">    <span class="keyword">for</span> bar <span class="keyword">in</span> ax.containers:</span><br><span class="line">        ax.bar_label(bar, fontsize=<span class="number">10</span>, fmt=<span class="string">&quot;%.2f&quot;</span>)</span><br><span class="line">    ax.get_legend().remove()</span><br><span class="line"></span><br><span class="line">    axpos = ax.get_position()</span><br><span class="line">    caxpos = mtransforms.Bbox.from_extents(axpos.x1 + <span class="number">0.02</span>, axpos.y0, axpos.x1 + <span class="number">0.03</span>, axpos.y1)</span><br><span class="line">    cax = ax.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">    locator = mticker.MultipleLocator(<span class="number">0.02</span>)</span><br><span class="line">    formatter = mticker.StrMethodFormatter(<span class="string">&quot;&#123;x:.2f&#125;&quot;</span>)</span><br><span class="line">    cax.figure.colorbar(sm, cax=cax, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"></span><br><span class="line">    ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">    ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    plt.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data[<span class="string">&quot;score&quot;</span>]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">avgSenScore0 = weekAvgSenScore(dfEs[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
F:\user\Temp\ipykernel_9048\3472776600.py:13: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing &#39;df[col].method(value, inplace=True)&#39;, try using &#39;df.method(&#123;col: value&#125;, inplace=True)&#39; or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.
</code></pre>
<p>​<br>​      data[“score”].fillna(0, inplace&#x3D;True)</p>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_57_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">avgSenScore1 = weekAvgSenScore(dfEs[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
F:\user\Temp\ipykernel_9048\3472776600.py:13: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing &#39;df[col].method(value, inplace=True)&#39;, try using &#39;df.method(&#123;col: value&#125;, inplace=True)&#39; or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.
</code></pre>
<p>​<br>​      data[“score”].fillna(0, inplace&#x3D;True)</p>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_58_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_ = weekAvgSenScore(dfE)</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
F:\user\Temp\ipykernel_9048\3472776600.py:13: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing &#39;df[col].method(value, inplace=True)&#39;, try using &#39;df.method(&#123;col: value&#125;, inplace=True)&#39; or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.
</code></pre>
<p>​<br>​      data[“score”].fillna(0, inplace&#x3D;True)</p>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_59_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ax = sns.lineplot(data=avgSenScore0, linewidth=<span class="number">3</span>, marker=<span class="string">&quot;s&quot;</span>, markersize=<span class="number">15</span>, label=labels[<span class="number">0</span>])</span><br><span class="line">ax = sns.lineplot(data=avgSenScore1, linewidth=<span class="number">3</span>, marker=<span class="string">&quot;^&quot;</span>, markersize=<span class="number">15</span>, ax=ax, label=labels[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Date&quot;</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Average Sentiment Score&quot;</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">52</span>)</span><br><span class="line">ax.legend(prop=&#123;<span class="string">&quot;size&quot;</span>: <span class="number">24</span>&#125;)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_60_0.png" alt="png"></p>
<h3 id="按周统计累计情感指数"><a href="#按周统计累计情感指数" class="headerlink" title="按周统计累计情感指数"></a>按周统计累计情感指数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">weekTotSenScore</span>(<span class="params">df</span>):</span><br><span class="line">    wStart = <span class="string">&quot;2022-08-01&quot;</span></span><br><span class="line">    wEnd = <span class="string">&quot;2024-02-10&quot;</span></span><br><span class="line">    grouper = pd.Grouper(key=<span class="string">&quot;StrTime&quot;</span>, freq=<span class="string">&quot;W-MON&quot;</span>)</span><br><span class="line">    data = df.groupby(grouper)[<span class="string">&quot;score&quot;</span>].<span class="built_in">sum</span>().to_frame()</span><br><span class="line">    data.index = pd.date_range(start=wStart, end=wEnd, freq=<span class="string">&quot;W-MON&quot;</span>).strftime(<span class="string">&quot;%m-%d&quot;</span>)</span><br><span class="line">    data.columns = [<span class="string">&quot;score&quot;</span>]</span><br><span class="line"></span><br><span class="line">    vM = data[<span class="string">&quot;score&quot;</span>].<span class="built_in">abs</span>().<span class="built_in">max</span>()</span><br><span class="line">    norm = plt.Normalize(-vM, vM)</span><br><span class="line">    sm = plt.cm.ScalarMappable(cmap=<span class="string">&quot;coolwarm&quot;</span>, norm=norm)</span><br><span class="line"></span><br><span class="line">    ax = sns.barplot(x=data.index, y=data[<span class="string">&quot;score&quot;</span>], hue=data[<span class="string">&quot;score&quot;</span>], hue_norm=norm, palette=<span class="string">&quot;coolwarm&quot;</span>)</span><br><span class="line">    ax.set_xlabel(<span class="string">&quot;Date&quot;</span>)</span><br><span class="line">    plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">    <span class="keyword">for</span> bar <span class="keyword">in</span> ax.containers:</span><br><span class="line">        ax.bar_label(bar, fontsize=<span class="number">10</span>, fmt=<span class="string">&quot;%.2f&quot;</span>)</span><br><span class="line">    ax.get_legend().remove()</span><br><span class="line"></span><br><span class="line">    axpos = ax.get_position()</span><br><span class="line">    caxpos = mtransforms.Bbox.from_extents(axpos.x1 + <span class="number">0.02</span>, axpos.y0, axpos.x1 + <span class="number">0.03</span>, axpos.y1)</span><br><span class="line">    cax = ax.figure.add_axes(caxpos)</span><br><span class="line"></span><br><span class="line">    locator = mticker.MultipleLocator(<span class="number">20</span>)</span><br><span class="line">    formatter = mticker.StrMethodFormatter(<span class="string">&quot;&#123;x:.2f&#125;&quot;</span>)</span><br><span class="line">    cax.figure.colorbar(sm, cax=cax, ticks=locator, <span class="built_in">format</span>=formatter)</span><br><span class="line"></span><br><span class="line">    ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">    ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    plt.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data[<span class="string">&quot;score&quot;</span>]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">totSenScore0 = weekTotSenScore(dfEs[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
</code></pre>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_63_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">totSenScore1 = weekTotSenScore(dfEs[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
</code></pre>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_64_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_ = weekTotSenScore(dfE)</span><br></pre></td></tr></table></figure>

<pre><code>f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
f:\ProgramData\miniconda3\envs\wechatmsg\lib\site-packages\pandas\core\groupby\grouper.py:381: FutureWarning: Dtype inference on a pandas object (Series, Index, ExtensionArray) is deprecated. The Index constructor will keep the original dtype in the future. Call `infer_objects` on the result to get the old behavior.
  ax = Index(obj[key], name=key)
</code></pre>
<p><img src="/images/QQmsganalysis_files/QQmsganalysis_65_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ax = sns.lineplot(data=totSenScore0, linewidth=<span class="number">3</span>, marker=<span class="string">&quot;s&quot;</span>, markersize=<span class="number">15</span>, label=labels[<span class="number">0</span>])</span><br><span class="line">ax = sns.lineplot(data=totSenScore1, linewidth=<span class="number">3</span>, marker=<span class="string">&quot;^&quot;</span>, markersize=<span class="number">15</span>, ax=ax, label=labels[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Date&quot;</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">60</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Total Sentiment Score&quot;</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">52</span>)</span><br><span class="line">ax.legend(prop=&#123;<span class="string">&quot;size&quot;</span>: <span class="number">24</span>&#125;)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">20</span>, <span class="number">8</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_66_0.png" alt="png"></p>
<h3 id="每日平均情感分析"><a href="#每日平均情感分析" class="headerlink" title="每日平均情感分析"></a>每日平均情感分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">&quot;hour&quot;</span>)</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    tmp = dfEs[k].groupby(grouper)[<span class="string">&quot;score&quot;</span>].mean().sort_index()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> tmp.index:</span><br><span class="line">            data.append(tmp[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.append(<span class="number">0</span>)</span><br><span class="line">    data.append(<span class="number">0</span>)</span><br><span class="line">data = pd.DataFrame(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Score&quot;</span>: data,</span><br><span class="line">        <span class="string">&quot;Person&quot;</span>: [labels[<span class="number">0</span>]] * <span class="number">25</span> + [labels[<span class="number">1</span>]] * <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">xBins = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)]</span><br><span class="line">ax = sns.histplot(</span><br><span class="line">    data=data,</span><br><span class="line">    x=xBins * <span class="number">2</span>,</span><br><span class="line">    bins=xBins,</span><br><span class="line">    weights=<span class="string">&quot;Score&quot;</span>,</span><br><span class="line">    hue=<span class="string">&quot;Person&quot;</span>,</span><br><span class="line">    multiple=multiple,</span><br><span class="line">    edgecolor=<span class="string">&quot;.3&quot;</span>,</span><br><span class="line">    linewidth=<span class="number">0.5</span>,</span><br><span class="line">    palette=<span class="string">&quot;dark&quot;</span>,</span><br><span class="line">    alpha=<span class="number">0.6</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ax.set_xticks(<span class="built_in">range</span>(<span class="number">25</span>))</span><br><span class="line">ax.set_xticklabels(<span class="built_in">range</span>(<span class="number">25</span>))</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Hour&quot;</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">24</span>)</span><br><span class="line">ax.set_ylim(np.<span class="built_in">min</span>([<span class="number">0</span>, np.floor(data[<span class="string">&quot;Score&quot;</span>].<span class="built_in">min</span>() / <span class="number">0.05</span>) * <span class="number">0.05</span>]), np.ceil(data[<span class="string">&quot;Score&quot;</span>].<span class="built_in">max</span>() / <span class="number">0.05</span>) * <span class="number">0.05</span>)</span><br><span class="line">sns.move_legend(ax, loc=<span class="string">&quot;upper center&quot;</span>, bbox_to_anchor=(<span class="number">0.5</span>, <span class="number">1.2</span>), ncol=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_68_0.png" alt="png"></p>
<h3 id="每日累计情感分析"><a href="#每日累计情感分析" class="headerlink" title="每日累计情感分析"></a>每日累计情感分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">grouper = pd.Grouper(key=<span class="string">&quot;hour&quot;</span>)</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    tmp = dfEs[k].groupby(grouper)[<span class="string">&quot;score&quot;</span>].<span class="built_in">sum</span>().sort_index()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> tmp.index:</span><br><span class="line">            data.append(tmp[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.append(<span class="number">0</span>)</span><br><span class="line">    data.append(<span class="number">0</span>)</span><br><span class="line">data = pd.DataFrame(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Score&quot;</span>: data,</span><br><span class="line">        <span class="string">&quot;Person&quot;</span>: [labels[<span class="number">0</span>]] * <span class="number">25</span> + [labels[<span class="number">1</span>]] * <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">xBins = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)]</span><br><span class="line">ax = sns.histplot(</span><br><span class="line">    data=data,</span><br><span class="line">    x=xBins * <span class="number">2</span>,</span><br><span class="line">    bins=xBins,</span><br><span class="line">    weights=<span class="string">&quot;Score&quot;</span>,</span><br><span class="line">    hue=<span class="string">&quot;Person&quot;</span>,</span><br><span class="line">    multiple=multiple,</span><br><span class="line">    edgecolor=<span class="string">&quot;.3&quot;</span>,</span><br><span class="line">    linewidth=<span class="number">0.5</span>,</span><br><span class="line">    palette=<span class="string">&quot;dark&quot;</span>,</span><br><span class="line">    alpha=<span class="number">0.6</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ax.set_xticks(<span class="built_in">range</span>(<span class="number">25</span>))</span><br><span class="line">ax.set_xticklabels(<span class="built_in">range</span>(<span class="number">25</span>))</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Hour&quot;</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">24</span>)</span><br><span class="line">ax.set_ylim(np.<span class="built_in">min</span>([<span class="number">0</span>, np.floor(data[<span class="string">&quot;Score&quot;</span>].<span class="built_in">min</span>() / <span class="number">0.05</span>) * <span class="number">0.05</span>]), np.ceil(data[<span class="string">&quot;Score&quot;</span>].<span class="built_in">max</span>() / <span class="number">0.05</span>) * <span class="number">0.05</span>)</span><br><span class="line">sns.move_legend(ax, loc=<span class="string">&quot;upper center&quot;</span>, bbox_to_anchor=(<span class="number">0.5</span>, <span class="number">1.2</span>), ncol=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">ax.figure.set_size_inches(<span class="number">8</span>, <span class="number">4</span>)</span><br><span class="line">ax.figure.set_dpi(<span class="number">150</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure>


<p><img src="/images/QQmsganalysis_files/QQmsganalysis_70_0.png" alt="png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-11-11T21:56:58.000Z" title="2023/11/12 05:56:58">2023-11-12</time>发表</span><span class="level-item"><time dateTime="2023-11-16T08:57:53.995Z" title="2023/11/16 16:57:53">2023-11-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a><span> / </span><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/">工程设计</a></span><span class="level-item">23 分钟读完 (大约3387个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/11/12/%E6%96%AF%E7%89%B9%E6%9E%97%E5%BE%AA%E7%8E%AF/">课题：斯特林发动机热力循环计算及分析</a></p><div class="content"><h1 id="课题：斯特林发动机热力循环计算及分析"><a href="#课题：斯特林发动机热力循环计算及分析" class="headerlink" title="课题：斯特林发动机热力循环计算及分析"></a>课题：斯特林发动机热力循环计算及分析</h1><p><em><strong><u>22级明月2班 20224546 许晶华</u></strong></em></p>
<p>根据<strong>选定</strong>的斯特林发动机<strong>类型</strong>，<strong>确定</strong>具体的<strong>传动机构</strong>，开展斯特林发动机的<strong>热力循环计算</strong>；从<strong>最大化斯特林发动机单次循环的输出功</strong>角度出发，<strong>优化</strong>斯特林发动机系统所涉及的<strong>传动机构、相位角等参数</strong>。</p>
 <br>

<h2 id="一、背景介绍"><a href="#一、背景介绍" class="headerlink" title="一、背景介绍"></a>一、背景介绍</h2><p>通过学习本课程，我们需要完成斯特林发动机的设计与制造过程，在此过程中掌握工程设计全流程中的基本技能。之所以选择斯特林发动机，是因为能够<strong>将热能转化为机械能</strong>，并具有以下特点：</p>
<ol>
<li><strong>效率高</strong>：斯特林发动机的热效率相对较高，与理论上最高热效率的卡诺循环相同，实际中可以达到30%以上，远高于传统内燃机；</li>
<li><strong>噪音低</strong>：斯特林发动机工作过程中没有爆炸过程，工作过程相对平滑，噪音和振动较小；</li>
<li><strong>热源多</strong>：斯特林发动机作为一种外燃机，可以直接利用任何可用热源，如太阳能、地热能与生物质能等可再生能源；</li>
<li><strong>排放少</strong>：斯特林发动机在工作过程中没有直接燃烧，为闭口系统，工质环境友好，没有任何有害物排放；</li>
<li><strong>寿命长</strong>：连续运行，安全可靠，对高温侧材料要求较高。</li>
</ol>
<p>斯特林发动机的概念可以追溯到19世纪初，但由于技术限制和市场竞争，长期以来并没有像内燃机那样广泛应用。最近，随着对环保和能源效率的关注不断增加，斯特林发动机再次引起了一些研究兴趣，在水下动力、太阳能动力、空间站动力、热泵空调动力，车用混合推进动力等方面得到了广泛的研究与重视，并且已得到了一些成功的应用。</p>
<p>斯特林发动机按照结构可分为<strong>α型、β型和γ型</strong>三类，其中α型又称为双动力活塞式发动机，β型和γ型又称为配气活塞式发动机。</p>
<p><img src="/images/hot/001.png"></p>
<p>通过对于三种类型发动机的基本结构和工作原理的分析与比较，我们最终选择<strong>β型</strong>斯特林发动机进行实际设计制作。同时考虑到整体项目要求、制作难度与成本等方面，选择<strong>单作用</strong>斯特林发动机进行制作。</p>
<p><img src="/images/hot/002.png"></p>
<p>β型斯特林发动机属于配气活塞式发动机，基本结构中包含配气与动力（做功）两种活塞。其中，配气活塞只起到配气作用，并不对外做功，其上下两端压力一致，用于使工质在循环回路中来回流动；动力活塞上、下两腔气压差很大，必须进行密封处理。</p>
<p>斯特林发动机的基本工作原理为<strong>斯特林循环</strong>。理想的斯特林循环主要包括<strong>定温压缩、定容吸热、定温膨胀和定容放热</strong>共四个过程，其中两个为定温过程，两个为定容过程：</p>
<ol>
<li>定温压缩：工作气体在活塞的压力作用下被压缩，使得气体温度降低；</li>
<li>定容吸热：压缩后的工作气体通过外部热源加热，吸收热能，温度升高；</li>
<li>定温膨胀：加热后的工作气体在活塞的推动下膨胀，产生机械功，带动发电机等设备工作；</li>
<li>定容放热：膨胀后的工作气体通过冷却器冷却，使其温度降低，回到压缩前的状态。</li>
</ol>
<p><img src="/images/hot/011.png"></p>
<p>上述四个过程循环往复，共同构成斯特林循环。为了确定并验证我们所初步设计的发动机模型能否满足课题要求的最大输出功率达到0.5W，我们需要分析研究在设定条件（与实际设计结构一致）下单次斯特林循环的输出功，并通过计算结果返回迭代传动结构、尺寸与相位角等参数的设计与确定，以实现斯特林发动机单次循环输出功的最大化。</p>
<br>

<h2 id="二、物理模型"><a href="#二、物理模型" class="headerlink" title="二、物理模型"></a>二、物理模型</h2><p>本报告将给出根据我们目前设计的具体结构参数计算的单次斯特林循环输出功，并建立目标函数通过优化相位角等参数最大化单次循环输出功。</p>
<h4 id="传动机构"><a href="#传动机构" class="headerlink" title="传动机构"></a>传动机构</h4><p>传动机构方面，我们采用曲柄连杆机构，基本的物理模型图与我们的设计建模图如下：</p>
<p><img src="/images/hot/012.png"></p>
<p><img src="/images/hot/013.png"></p>
<p><img src="/images/hot/014.png"></p>
<p>上述设计的相关参数如下：</p>
<p>【1】连杆比λ：</p>
<p>通过实际加热测试测定，四个过程状态下活塞的位置参数大致如下：</p>
<p>（1）定温压缩</p>
<p><img src="/images/hot/001.jpg"></p>
<p>（2）定容吸热</p>
<p><img src="/images/hot/002.jpg"></p>
<p>（3）定温膨胀</p>
<p><img src="/images/hot/003.jpg"></p>
<p>（4）定容放热</p>
<p><img src="/images/hot/004.jpg"></p>
<p>根据以上实际测试结果，可得到配气活塞行程s&#x3D;20-5&#x3D;15mm，动力活塞行程S&#x3D;54-24&#x3D;30mm，我们将其设计为与连杆机构活塞位移最大值 max（x）&#x3D;2R&#x3D;30mm一致，于是有曲柄半径R&#x3D;15mm，再设定连杆长度L&#x3D;100mm，可得到连杆比λ&#x3D;R&#x2F;L&#x3D;0.15；</p>
<p>【2】转速初步设定为n&#x3D;120r&#x2F;min；</p>
<p>【3】气缸内部半径为1cm（与动力活塞一致），长度为24mm;</p>
<p>【4】排气活塞半径为0.8cm，长度为20mm。</p>
<h4 id="热力学模型"><a href="#热力学模型" class="headerlink" title="热力学模型"></a>热力学模型</h4><p>为分析整个斯特林循环过程，结合我们以上的模型设计，给出如下热力学参数与假设：</p>
<p>（1）系统气密性良好、无泄漏；气缸内部半径为1cm，长度为24mm，因此未进行加热时，内部初始的工质（空气）体积<img src="/images/hot/003.png">，由此可得到工质总质量为<img src="/images/hot/004.png">(空气密度为1.29kg&#x2F;m3)；</p>
<p>（2）工质为理想气体，气体常数为<img src="/images/hot/006.png">，比热容为<img src="/images/hot/005.png">；</p>
<p>（3）通过Ansys静态热力学仿真分析（如图），在给定特定酒精灯热源的情况下，根据设计的气缸活塞模型（加上散热片），得到工质等温膨胀及等温压缩过程的温度分别为<img src="/images/hot/007.png">和<img src="/images/hot/008.png">；</p>
<p><img src="/images/hot/009.png"></p>
<p>（4）系统等容加热及等容冷却过程的体积（如状态位置参数图所示）之比为<img src="/images/hot/010.png">&#x3D;54mm&#x2F;24mm；</p>
<p>（5）忽略循环过程中的各种不可逆性。</p>
<br>

<h2 id="三、循环计算分析"><a href="#三、循环计算分析" class="headerlink" title="三、循环计算分析"></a>三、循环计算分析</h2><h4 id="理论情况"><a href="#理论情况" class="headerlink" title="理论情况"></a>理论情况</h4><p>在背景介绍中提到，一次斯特林循环主要分为四个过程，接下来将结合p-v图与物理模型中提到的实际参数数据对四个过程依次进行分析：</p>
<p>理论p-v图：</p>
<p><img src="/images/hot/015.png"></p>
<p>根据斯特林循环理论，有如下过程与单次循环做功计算结果：</p>
<p>（1）1-2：定温压缩过程</p>
<p><img src="/images/hot/016.png"></p>
<p>（2）2-3：定容吸热过程</p>
<p><img src="/images/hot/017.png"></p>
<p>（3）3-4：定温膨胀过程</p>
<p><img src="/images/hot/18.png"></p>
<p>（4）4-1：定容放热过程</p>
<p><img src="/images/hot/019.png"></p>
<p>通过综合考虑由以上四个过程循环往复进行的斯特林循环，可以初步计算得出单次斯特林循环理论所作功为<img src="/images/hot/020.png"></p>
<p>在此情况下，若<strong>设定转速为n&#x3D;120r&#x2F;min&#x3D;2r&#x2F;s</strong>，则此时该斯特林发动机的功率<strong>P&#x3D;0.389*2&#x3D;0.778W&gt;0.5W</strong>，故此设计方案理论上符合项目功能要求。</p>
<p>特别的，如果回热器性能完全（即回热器效率ηR&#x3D;1），则有Qin&#x3D;Q34&#x3D;1.382J，此时可计算得出该斯特林循环的单次做功效率为η&#x3D;Wi&#x2F;Qin&#x3D;28.1%。</p>
<h4 id="实际情况"><a href="#实际情况" class="headerlink" title="实际情况"></a>实际情况</h4><p>无法达到理想的等温或定容过程，因此需要借助史密特理论进行计算才能更接近真实情况下的单次循环做功大小。</p>
<p>基于史密特理论，<strong>暂时设定相位角为90°</strong>，可以得到实际中的<strong>p-v图</strong>如下（设定气缸内气体压强最小值即初始压强pmin为标准大气压&#x3D;100kPa)：</p>
<p><img src="/images/hot/022.png"></p>
<p>根据理论推导公式，编写代码如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">afa=<span class="built_in">pi</span>./<span class="number">2</span>;</span><br><span class="line">   theta=<span class="number">0</span>:<span class="number">0.1</span>:<span class="built_in">pi</span>*<span class="number">2</span>;</span><br><span class="line">   tc=<span class="number">439</span>;</span><br><span class="line">   te=<span class="number">611</span>;</span><br><span class="line">   vse=<span class="number">15.</span>*<span class="built_in">pi</span>;</span><br><span class="line">   vsc=<span class="number">30.</span>*<span class="built_in">pi</span>;</span><br><span class="line">   ve=vse.*(<span class="number">1</span>-<span class="built_in">cos</span>(theta))./<span class="number">2</span>;</span><br><span class="line">   vb=(vse+vsc)./<span class="number">2</span>-<span class="built_in">sqrt</span>((vse.*vse+vsc.*vsc)./<span class="number">4</span>-vse.*vsc.*<span class="built_in">cos</span>(afa)./<span class="number">2</span>);</span><br><span class="line">   vc=vse.*(<span class="number">1</span>+<span class="built_in">cos</span>(theta))./<span class="number">2</span>+vsc.*(<span class="number">1</span>-<span class="built_in">cos</span>(theta-afa))-vb;</span><br><span class="line">   vr=(<span class="number">1</span><span class="number">-0.64</span>).*<span class="number">20.</span>*<span class="built_in">pi</span>;</span><br><span class="line">   tao=tc./te;</span><br><span class="line">   k=vsc./te;</span><br><span class="line">   xb=vb./vse;</span><br><span class="line">   x=vr./vse;</span><br><span class="line">   fai=<span class="built_in">atan</span>(k.*<span class="built_in">sin</span>(afa)./(<span class="number">1</span>-tao-k.*<span class="built_in">cos</span>(afa)));</span><br><span class="line">   s=tao+<span class="number">4.</span>*tao.*x./(<span class="number">1</span>+tao)+k+<span class="number">1</span><span class="number">-2.</span>*xb;</span><br><span class="line">   b=<span class="built_in">sqrt</span>(tao.*tao+<span class="number">2.</span>*k.*(tao<span class="number">-1</span>).*<span class="built_in">cos</span>(afa)+k.*k<span class="number">-2.</span>*tao+<span class="number">1</span>);</span><br><span class="line">   deta=b./s;</span><br><span class="line">   pmin=<span class="number">100000</span>;</span><br><span class="line">   p=pmin.*(<span class="number">1</span>+deta)./(<span class="number">1</span>-deta.*<span class="built_in">cos</span>(theta-fai));</span><br><span class="line">   v=ve+vr+vc;</span><br><span class="line">   <span class="built_in">figure</span>;</span><br><span class="line">   <span class="built_in">plot</span>(v,p);</span><br><span class="line">   xlabel(<span class="string">&#x27;体积V（mm^3）&#x27;</span>);</span><br><span class="line">   ylabel(<span class="string">&#x27;压强P（Pa）&#x27;</span>);</span><br><span class="line">   title(<span class="string">&#x27;α=90°时P-V图线&#x27;</span>);</span><br><span class="line">   w=pmin.*vse.*<span class="built_in">pi</span>.*deta.*(<span class="number">1</span>-tao).*<span class="built_in">sin</span>(fai).*<span class="built_in">sqrt</span>(<span class="number">1</span>-deta)./((<span class="number">1</span>+<span class="built_in">sqrt</span>(<span class="number">1</span>-deta.*deta)).*<span class="built_in">sqrt</span>(<span class="number">1</span>+deta))/<span class="number">1000000</span>;</span><br></pre></td></tr></table></figure>

<p>通过运行上述代码段，可以得到如上图所示的p-v图线，并计算出此时单次斯特林循环的实际做功大小<strong>W&#x3D;0.1429J</strong>。</p>
<p>在此情况下，若设定转速为n&#x3D;120r&#x2F;min&#x3D;2r&#x2F;s，则此时该斯特林发动机的功率P&#x3D;0.1429*2&#x3D;0.2858W&lt;0.5W，故此设计方案理论上暂不符合项目功能要求；但若增加<strong>转速</strong>至<strong>n’&#x3D;P0&#x2F;W&#x3D;3.5r&#x2F;s&#x3D;210r&#x2F;min</strong>，即可满足设计要求。</p>
<br>

<h2 id="四、优化"><a href="#四、优化" class="headerlink" title="四、优化"></a>四、优化</h2><p>在上述的设计过程中，我们将曲柄连杆机构中曲柄的半径设计为活塞在气体膨胀压缩过程中运动的最大距离（即行程）的一半，并设定相位角（排气器活塞与动力活塞的相位差角度值）为90°（依据已有的设计经验）。事实上，通过分析史密特理论的计算式不难发现，随着相位角的改变，最终计算出的单次循环所作功也发生改变，因此在优化时需要通过绘制W-α图像直观反映二者间的关系，并找到合适的相位角α值以最大化单次循环所作功W。</p>
<p>以下是设计的MATLAB代码与绘制的对应图像：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">afa=<span class="number">0</span>:<span class="number">0.1</span>:<span class="built_in">pi</span>*<span class="number">2</span>;</span><br><span class="line">theta=<span class="number">0</span>:<span class="number">0.1</span>:<span class="built_in">pi</span>*<span class="number">2</span>;</span><br><span class="line">tc=<span class="number">439</span>;</span><br><span class="line">te=<span class="number">611</span>;</span><br><span class="line">vse=<span class="number">15.</span>*<span class="built_in">pi</span>;</span><br><span class="line">vsc=<span class="number">30.</span>*<span class="built_in">pi</span>;</span><br><span class="line">ve=vse.*(<span class="number">1</span>-<span class="built_in">cos</span>(theta))./<span class="number">2</span>;</span><br><span class="line">vb=(vse+vsc)./<span class="number">2</span>-<span class="built_in">sqrt</span>((vse.*vse+vsc.*vsc)./<span class="number">4</span>-vse.*vsc.*<span class="built_in">cos</span>(afa)./<span class="number">2</span>);</span><br><span class="line">vc=vse.*(<span class="number">1</span>+<span class="built_in">cos</span>(theta))./<span class="number">2</span>+vsc.*(<span class="number">1</span>-<span class="built_in">cos</span>(theta-afa))-vb;</span><br><span class="line">vr=(<span class="number">1</span><span class="number">-0.64</span>).*<span class="number">20.</span>*<span class="built_in">pi</span>;</span><br><span class="line">tao=tc./te;</span><br><span class="line">k=vsc./te;</span><br><span class="line">xb=vb./vse;</span><br><span class="line">x=vr./vse;</span><br><span class="line">fai=<span class="built_in">atan</span>(k.*<span class="built_in">sin</span>(afa)./(<span class="number">1</span>-tao-k.*<span class="built_in">cos</span>(afa)));</span><br><span class="line">s=tao+<span class="number">4.</span>*tao.*x./(<span class="number">1</span>+tao)+k+<span class="number">1</span><span class="number">-2.</span>*xb;</span><br><span class="line">b=<span class="built_in">sqrt</span>(tao.*tao+<span class="number">2.</span>*k.*(tao<span class="number">-1</span>).*<span class="built_in">cos</span>(afa)+k.*k<span class="number">-2.</span>*tao+<span class="number">1</span>);</span><br><span class="line">deta=b./s;</span><br><span class="line">pmin=<span class="number">100000</span>;</span><br><span class="line">p=pmin.*(<span class="number">1</span>+deta)./(<span class="number">1</span>-deta.*<span class="built_in">cos</span>(theta-fai));</span><br><span class="line">v=ve+vr+vc;</span><br><span class="line">w=pmin.*vse.*<span class="built_in">pi</span>.*deta.*(<span class="number">1</span>-tao).*<span class="built_in">sin</span>(fai).*<span class="built_in">sqrt</span>(<span class="number">1</span>-deta)./((<span class="number">1</span>+<span class="built_in">sqrt</span>(<span class="number">1</span>-deta.*deta)).*<span class="built_in">sqrt</span>(<span class="number">1</span>+deta))/<span class="number">1000000</span>;</span><br><span class="line"><span class="built_in">plot</span>(rad2deg(afa),w)</span><br><span class="line">xlabel(<span class="string">&#x27;相位角α（°）&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;单次循环所作功W（J）&#x27;</span>);</span><br><span class="line">title(<span class="string">&#x27;单次循环所作功W随相位角α的变化关系图线&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/images/hot/021.png"></p>
<p>由图像可见，当相位角<strong>α&#x3D;51.6°</strong>左右时，单次循环所作功达到最大值<strong>Wmax&#x3D;0.169J</strong>，较原先相位角为90°的方案有所提升，只需要<strong>转速达到nmin&#x3D;P0&#x2F;Wmax≈2.96r&#x2F;s&#x3D;178r&#x2F;min</strong>即可满足设计功能要求，实现了优化效果。</p>
<br>

<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><p>在本次课题任务中，借助了热力学方法研究气缸内的封闭气体，从而对于我们小组初步设计的β型斯特林发动机模型的动力（做功）性能进行了一定的评估分析，并在此基础上通过MATLAB工具绘制函数图像，通过对于目标函数的优化以指导我们进行结构上的进一步改进以提升性能。</p>
<p>在热力学分析过程中，从斯特林循环的四个基本环节入手，结合我们设计的气缸、活塞等尺寸参数、实际测试得到的经验参数以及简单的传动机构设计（曲柄连杆机构），从理论分析逐步逼近实际，最终借助一阶的史密特等温分析方法理论实现了较为接近实际的计算模拟，得到了单次斯特林循环对外做功的数值解从而给出达到目标功率所需要设定的飞轮转速。</p>
<p>同时，在此基础上，通过改变相位角等参数，基于史密特理论中单次循环做功的计算公式，得到了可以进行优化（求极值）的目标函数，并得到了当前尺寸参数下的最大单次循环做功及其对应的相位角，有效实现了基于理论计算的迭代与优化。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-10-12T17:49:58.000Z" title="2023/10/13 01:49:58">2023-10-13</time>发表</span><span class="level-item"><time dateTime="2023-11-16T08:41:14.417Z" title="2023/11/16 16:41:14">2023-11-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a><span> / </span><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/">工程设计</a></span><span class="level-item">35 分钟读完 (大约5275个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/10/13/%E6%B0%94%E7%BC%B8%E6%B4%BB%E5%A1%9E%E6%8A%A5%E5%91%8A/">课题：发动机驱动部件的制作（气缸）</a></p><div class="content"><h1 id="课题：发动机驱动部件的制作（气缸）"><a href="#课题：发动机驱动部件的制作（气缸）" class="headerlink" title="课题：发动机驱动部件的制作（气缸）"></a>课题：发动机驱动部件的制作（气缸）</h1><p><em><strong><u>22级明月2班 20224546 许晶华</u></strong></em></p>
 <br>

<h2 id="一、需求分析"><a href="#一、需求分析" class="headerlink" title="一、需求分析"></a>一、需求分析</h2><p>β型斯特林发动机是一种热机，通过气体的循环膨胀和压缩过程来产生功。气缸作为该发动机的核心部件之一，承担了容纳工作气体和推动活塞的重要职责，将工质气体受热膨胀的能量转化为机械功。本文旨在分析β型斯特林发动机气缸的工作原理及相关参数的确定与结构设计以满足一定的性能要求，同时在此过程中提升对气体膨胀做功及整个过程中密封、摩擦、公差设计、基本加工工艺、材料传热性能乃至动力学等的认识。</p>
<h3 id="广义的设计要求"><a href="#广义的设计要求" class="headerlink" title="广义的设计要求"></a>广义的设计要求</h3><ol>
<li><strong>高热效率</strong>: 气缸必须具备高效的热传导和隔热性能，以确保最小的热能损失和高工作效率。</li>
<li><strong>耐高温性</strong>: 由于斯特林发动机工作温度较高，气缸的材料需要能够承受高温环境，同时保持结构稳定。</li>
<li><strong>公差精度</strong>: 在气缸的内径、外径和活塞直径等关键尺寸上需要达到高精度的公差，以确保气缸和活塞的匹配度。</li>
<li><strong>耐腐蚀性</strong>: 考虑到工作气体可能包含腐蚀性物质，气缸的材料应耐腐蚀，以延长使用寿命。</li>
<li><strong>轻量化</strong>: 尽量降低气缸的质量，以减小发动机的整体质量，提高机动性。</li>
<li><strong>制造工艺</strong>: 采用精密的机械加工工艺，以确保气缸内外表面的平滑度和尺寸精度。</li>
<li><strong>热传导设计</strong>: 优化气缸的热传导设计，以提高热能的传递效率。</li>
</ol>
<h3 id="具体的设计要求"><a href="#具体的设计要求" class="headerlink" title="具体的设计要求"></a>具体的设计要求</h3><p>针对最终需要完成的斯特林发动机，需要满足如下几条设计指标与功能要求：</p>
<ol>
<li><strong>最大输出功率</strong>: 不小于0.5W</li>
<li><strong>热源</strong>:普通酒精灯</li>
<li><strong>连续运行时间</strong>:不小于30分钟</li>
<li><strong>密封性能</strong>: 气缸必须能够有效密封工作气体，具有良好的密封性能以确保高效的热循环过程。</li>
<li><strong>材料选择</strong>: 选择常用的适当材料与零部件以满足高温环境下的性能需求。</li>
</ol>
<p>满足这些需求将有助于确保β型斯特林发动机的性能优越，同时提高其在各种应用领域的适用性。制作气缸需要综合考虑这些需求，并在制造过程中严格控制相关参数，以获得卓越的产品性能。</p>
<br>

<h2 id="二、方案提出"><a href="#二、方案提出" class="headerlink" title="二、方案提出"></a>二、方案提出</h2><h3 id="1-加工方式——机加工"><a href="#1-加工方式——机加工" class="headerlink" title="1. 加工方式——机加工"></a>1. 加工方式——机加工</h3><p>选用机加工方法制作缸筒与活塞的理由如下：</p>
<ol>
<li><strong>精确尺寸控制</strong>：机加工可以实现非常高的尺寸精确度，确保气缸内径和活塞直径的精确匹配。这是确保气缸与活塞之间的紧密密封以及减少能量损失的关键。精确尺寸控制也有助于降低磨损，延长气缸和活塞的寿命。</li>
<li><strong>表面质量</strong>：机加工可以产生平滑、光洁的表面，减少摩擦和磨损。这对于斯特林发动机的效率至关重要，因为高效的热循环需要最小的摩擦损失。</li>
<li><strong>公差控制</strong>：机加工允许对关键尺寸的公差进行严格控制，确保气缸和活塞的尺寸在允许范围内，从而确保它们可以良好地配合。公差控制还有助于提高气缸和活塞的互换性，降低制造成本。</li>
<li><strong>材料选择</strong>：机加工允许使用各种高强度、耐高温材料，如高温合金或陶瓷，以满足斯特林发动机在高温工作环境下的要求。这有助于提高耐高温性，确保气缸和活塞在极端条件下保持结构稳定。</li>
<li><strong>加工复杂几何形状</strong>：斯特林发动机的气缸和活塞通常具有复杂的几何形状，以实现最佳性能。机加工可以实现这些复杂形状，包括内部凹凸和特殊的密封表面，以确保气缸能够有效地容纳工作气体。</li>
</ol>
<p>总的来说，机加工满足了精确性、表面质量、公差控制、材料选择和复杂几何形状等多个需求，这些需求都对斯特林发动机的性能和产品质量产生显著影响。通过机加工，可以确保气缸和活塞能够稳定、高效地工作，从而提高发动机的性能和可靠性。</p>
<h3 id="2-装置主要部件确定"><a href="#2-装置主要部件确定" class="headerlink" title="2. 装置主要部件确定"></a>2. 装置主要部件确定</h3><p>β型斯特林发动机是一种热机，其原理基于气体的周期性膨胀和压缩过程，使发动机能够执行其热循环，将热能转化为机械能。基于实际的需求与制造情况，为方便后期接入整个斯特林发动机，考虑到β型斯特林发动机的基本工作原理，本驱动部件主要由如下四个主要部分构成：</p>
<ol>
<li><strong>气缸</strong>：气缸是β型斯特林发动机的关键组成部分，用于容纳和引导工作气体，包括热源和冷源。在工作过程中，气体会经历周期性的膨胀和压缩，这需要一个容器来容纳和引导气体。因此，气缸是必不可少的。</li>
<li><strong>排气活塞</strong>：排气活塞是β型斯特林发动机的重要组成部分，它在工作过程中与冷源接触，以帮助气体压缩。排气活塞的运动导致气体的压缩，从而提供负功。它的存在有助于形成热循环，从而使发动机能够持续工作。</li>
<li><strong>做功活塞</strong>：做功活塞是另一个重要的部件，它与热源接触，推动气体膨胀，从而提供正功。做功活塞的运动是热机的关键部分，因为它将热能转化为机械功，实现发动机的工作。</li>
<li><strong>散热片</strong>：散热片在β型斯特林发动机中的必要性主要取决于工作条件和设计要求。由于发动机工作时产生热量，散热片用于冷却气缸和活塞，以确保它们不过热。如果不进行散热，发动机温度将升高，可能导致性能下降、部件损坏或设备故障。因此，散热片在保持发动机温度稳定和可控的情况下是必要的。</li>
</ol>
<p>这些部件共同协作，构成了发动机的关键部分，使β型斯特林发动机能够将热能转化为机械能，并提供功率输出。</p>
<h3 id="3-材料选择"><a href="#3-材料选择" class="headerlink" title="3. 材料选择"></a>3. 材料选择</h3><p>基于需求分析与相关指标的要求，综合考虑各材料的导热性能与相关参数，基于这两种材料的特性和性能在斯特林发动机应用中的相对优势，最终选择**<u>不锈钢-304材料用于制作活塞、铝合金-0001材料用于制作气缸</u>**，理由如下：</p>
<ol>
<li><strong>不锈钢-304用于活塞制作</strong>：<ul>
<li><strong>高耐磨性和耐腐蚀性</strong>：不锈钢-304是一种耐磨性和耐腐蚀性较高的材料，这在活塞的应用中是非常重要的。不锈钢的表面抵抗摩擦和腐蚀，有助于提高活塞的寿命。</li>
<li><strong>高强度</strong>：不锈钢-304具有相对较高的强度，这对于承受活塞运动和高压力的应力非常重要。这有助于确保活塞的结构稳定性。</li>
<li><strong>高温稳定性</strong>：不锈钢-304在一定温度范围内表现出良好的稳定性，这对于斯特林发动机在高温环境下的应用非常有利。</li>
<li><strong>可加工性</strong>：不锈钢-304相对容易加工，使其适合制作复杂几何形状的活塞，以满足特定的设计需求。</li>
</ul>
</li>
<li><strong>铝合金-0001用于气缸制作</strong>：<ul>
<li><strong>轻质高导热性</strong>：铝合金-0001具有较低的密度，因此相对轻便，有助于降低整个发动机的质量。此外，铝合金具有良好的导热性，其导热系数相对于其他材料而言更高，可以有效地传导热量，有利于优化发动机的热传导性能。</li>
<li><strong>耐高温性</strong>：虽然铝合金的熔点较低，但在典型的斯特林发动机工作温度范围内，铝合金-0001表现出足够的耐高温性。此外，铝合金在高温下也能保持较好的强度。</li>
<li><strong>可加工性</strong>：铝合金易于加工，因此可以比较容易地制造气缸的复杂几何形状，以确保其密封性和热性能。</li>
</ul>
</li>
</ol>
<p>这样的选择有助于确保活塞和气缸能够在高温、高压和高效率的工作环境下稳定运行，并且提高了产品的寿命和性能。 除此之外，考虑到成本、加工难度与加工时间等客观限制条件因素，这两种材料也易于获取与加工，有效控制了整个制造过程的经济与时间成本。</p>
<h3 id="4-散热片的型号选择与相关尺寸的确定"><a href="#4-散热片的型号选择与相关尺寸的确定" class="headerlink" title="4. 散热片的型号选择与相关尺寸的确定"></a>4. 散热片的型号选择与相关尺寸的确定</h3><p>散热片的主要作用是从热源（如电子元件、发动机、LED等）吸收热量，并将其有效地散发到周围环境中。使用散热片的主要原因：</p>
<ol>
<li><strong>保持温度稳定</strong>：散热片有助于保持热源的温度在可接受范围内。过高的温度可能导致设备故障或元件损坏，因此散热片对于稳定运行至关重要。</li>
<li><strong>延长寿命</strong>：有效的散热可以延长设备和元件的寿命。高温环境可能导致元件老化，降低其寿命。通过散热片，可以有效地冷却元件并延长其寿命。</li>
<li><strong>提高性能</strong>：在高温环境下，设备性能通常下降。通过散热片，可以确保设备在更长时间内保持高性能，以满足连续运行时间的需求。</li>
<li><strong>安全性</strong>：一些应用中，如电子设备，高温可能导致火灾或其他安全问题。散热片有助于维持较低的温度，减少了潜在的安全风险。</li>
</ol>
<p>考虑到制造过程的时间和经济成本有限，计划设计的大致尺寸均较小；同时为了提升散热效率，决定选用现成的特定型号的散热片，并根据散热片的相关尺寸参数确定设计的气缸与活塞的具体尺寸数据。如下图1所示，是本项目中所选用的散热片，其外径为32mm，内径为17mm，厚度为10mm。</p>
<p><img src="/images/qigang/01.jpg" alt="图1：散热片型号选择"></p>
<p><em>图1：散热片型号选择</em></p>
<p>在确定了选用的散热片内径为17mm后，计划制造的气缸外径也随之确定为17mm。为尽可能地提高传热效率，气缸的侧壁厚应尽量小，在此设定为2mm。于是做功活塞的外径也随之确定为17-2&#x3D;15mm。除此之外，排气活塞的圆柱长杆半径也应与做工活塞的孔洞内径保持一致，设定为5mm；排气活塞的活塞头半径应大于圆柱长杆半径且小于气缸内径，在此设定为12mm。</p>
<h3 id="5-热力学参数分析"><a href="#5-热力学参数分析" class="headerlink" title="5. 热力学参数分析"></a>5. 热力学参数分析</h3><p>假设：</p>
<ul>
<li>圆柱形气缸的半径 r&#x3D;15mm&#x3D;0.015m。</li>
<li>圆柱形气缸底部与排气活塞顶部之间的预留距离 L*&#x3D;30mm&#x3D;0.03m。</li>
<li>工质气体是空气。</li>
<li>温度差 Δ<em>T</em> &#x3D; 高温 - 低温。</li>
</ul>
<p>假设在气缸内，高温 T*h&#x3D; 525°C &#x3D; 798K，低温 <em>Tc</em> &#x3D; 25°C &#x3D; 298K（外部环境温度）。</p>
<p>以下是计算功率的推导过程：</p>
<p>（1）计算气缸的截面积 <em>A</em>：<em>A</em>&#x3D;<em>π</em>⋅r*^2&#x3D;*π⋅(0.015m)^2≈7.07×10−4m2</p>
<p>（2）计算气缸内原有的空气的体积 <em>V</em>：<em>V</em>&#x3D;<em>A</em>⋅<em>L</em>&#x3D;(7.07×10−4m2)⋅(0.03m)&#x3D;2.12×10−5m3</p>
<p>（3）计算气缸内的气体摩尔数 <em>n</em>。使用理想气体状态方程：<em>PV</em>&#x3D;<em>n R T</em></p>
<p>其中，<em>P</em> 是气体压力， <em>V</em> 是体积， <em>n</em> 是摩尔数， <em>R</em> 是气体常数， <em>T</em> 是温度。</p>
<p>解出 <em>n</em>：<em>n</em>&#x3D;<em>PV</em>&#x2F;<em>RT</em></p>
<p>其中，<em>P</em> 可以根据工作条件确定， <em>T</em> 是绝对温度， R 是空气的气体常数。</p>
<p>（4）计算热力学效率 <em>η</em>，根据斯特林循环的定义：<em>η</em>&#x3D;1−<em>Tc</em>&#x2F;T<em>h</em></p>
<p>其中，<em>Tc</em> 和 <em>Th</em> 分别是低温和高温的绝对温度。<em>Tc</em>&#x3D;298<em>K</em> ,<em>Th</em>&#x3D;798<em>K</em></p>
<p>于是有<em>η</em>≈0.625</p>
<p>（5）计算气缸内的热量 <em>Qh</em> 和 <em>Qc</em>。根据斯特林循环的热量关系：</p>
<p><em>Qh</em>&#x3D;<em>Qc</em>&#x3D;<em>n</em>⋅C<em>p</em>⋅Δ<em>T</em>     其中，<em>Cp</em> 是空气的定压比热容。<em>Cp</em>≈1005J&#x2F;(kg*K)</p>
<p>Δ<em>T</em>&#x3D;<em>Th</em>−<em>Tc</em>&#x3D;798<em>K</em>−298<em>K</em>&#x3D;500<em>K</em></p>
<p><em>Qh</em>&#x3D;<em>Qc</em>&#x3D;n⋅<em>C</em>p⋅<em>Δ</em>T<em>≈P</em>V⋅<em>Cp</em>⋅Δ*T&#x2F;RT</p>
<p>（6）计算功率 <em>P</em>。功率是通过工质气体对气缸内工作物体做功而获得的热量。</p>
<p>斯特林发动机的热功率可以通过以下公式计算：</p>
<p><em>P</em>&#x3D;<em>Qh</em>⋅η<em>−</em>Q<em>c</em>⋅η</p>
<p><em>P</em>&#x3D;<em>n</em>⋅C<em>p</em>⋅Δ<em>T</em>⋅η</p>
<p><em>P</em>≈P⋅<em>V</em>⋅<em>Cp</em>⋅Δ<em>T</em>⋅<em>η</em>&#x2F;（R⋅T）</p>
<p>代入已知值，可计算得到功率 <em>P</em> 的数值解：**<u><em>P</em>≈0.839W&gt;0.5W，满足制造与设计需求。</u>**</p>
<br>

<h2 id="三、样机制作"><a href="#三、样机制作" class="headerlink" title="三、样机制作"></a>三、样机制作</h2><h3 id="1-Fusion360-建模"><a href="#1-Fusion360-建模" class="headerlink" title="1. Fusion360 建模"></a>1. Fusion360 建模</h3><p>基于以上的设计方案，进一步细化各个部件各部分的尺寸，分别进行做功活塞、排气活塞与气缸的三维建模并结合已有的特定型号散热片完成总装，如下图2、3、4、5所示。图6为总装整体部件的剖面图。</p>
<p><img src="/images/qigang/09.png" alt="图2：做功活塞建模效果图"></p>
<p><em>图2：做功活塞建模效果图</em></p>
<p><img src="/images/qigang/11.png" alt="图3：排气活塞建模效果图"></p>
<p><em>图3：排气活塞建模效果图</em></p>
<p><img src="/images/qigang/12.png" alt="图4：气缸建模效果图"></p>
<p><em>图4：气缸建模效果图</em></p>
<p><img src="/images/qigang/06.png" alt="图5：总装建模效果图"></p>
<p><em>图5：总装建模效果图</em></p>
<p><img src="/images/qigang/07.png" alt="图6：总装剖面图"></p>
<p><em>图6：总装剖面图</em></p>
<h3 id="2-图纸绘制"><a href="#2-图纸绘制" class="headerlink" title="2. 图纸绘制"></a>2. 图纸绘制</h3><p>为进一步将建模得到的部件模型通过机加工的方式制造出来，还需要进行工程制图以便进一步的加工与修改并最终提交给厂家进行制作。做功活塞、排气活塞与气缸的图纸如下图7、8、9所示。</p>
<p><img src="/images/qigang/13.png" alt="图7：做工活塞工程图"></p>
<p><em>图7：做功活塞工程图</em></p>
<p><img src="/images/qigang/14.png" alt="图8：排气活塞工程图"></p>
<p><em>图8：排气活塞工程图</em></p>
<p><img src="/images/qigang/10.png" alt="图9：气缸工程图"></p>
<p><em>图9：气缸工程图</em></p>
<p>在完成工程图后，与加工制造厂家确认尺寸无误后，按照以上图纸开始投入加工，历时半个月拿到加工完成的样机，并在公差的基础上对于个别部件进行简单的车削处理使各部分能够紧密连接并尽可能地减小摩擦力。</p>
<br>

<h2 id="四、最终效果"><a href="#四、最终效果" class="headerlink" title="四、最终效果"></a>四、最终效果</h2><p>各部件加工效果如下图10、11、12所示，最终总装效果图如图13所示。</p>
<p><img src="/images/qigang/04.jpg" alt="图10：做工活塞实物图"></p>
<p><em>图10：做功活塞实物图</em></p>
<p><img src="/images/qigang/03.jpg" alt="图11：排气活塞实物图"></p>
<p><em>图11：排气活塞实物图</em></p>
<p><img src="/images/qigang/02.jpg" alt="图12：气缸实物图"></p>
<p><em>图12：气缸实物图</em></p>
<p><img src="/images/qigang/08.jpg" alt="图13：总装实物图图"></p>
<p><em>图13：总装实物图</em></p>
<p>其中做工活塞在加工时出现错误，中间的连杆原本设计为圆筒形，加工时外层错加工为正方形，但并不影响整体性能。</p>
<h3 id="1020实际测试更新版"><a href="#1020实际测试更新版" class="headerlink" title="1020实际测试更新版"></a>1020实际测试更新版</h3><p><strong>测试视频</strong>见附件：气缸活塞演示视频</p>
<p><video src="images/qigang/气缸活塞演示视频.mp4"></video></p>
<p><img src="/images/qigang/15.png" alt="图14：测试始态与终态对比图"></p>
<p><em>图14：测试始态与终态对比图</em></p>
<p><strong><u>测试结果：在加热至18秒左右时，做功活塞有明显的运动，并在之后持续对外做功</u></strong></p>
<p>通过实际验证实验可知，**<u>在排气活塞预留30mm空气柱的情况下，对于气缸底部受热段进行一定时间的预热与加热，做功活塞可以成功被推出，并以一定的功率对外做功，满足基本设计需求。</u>**</p>
<p><strong><u>但由于未做密封圈等进一步设计，该驱动部件的气密性并不是特别良好，且做功活塞与气缸壁之间以及排气活塞与做功活塞之间的摩擦力相对较大，因此实际测试过程中并未达到理论计算的功率结果，需要在后续发动机的整体制造中进行进一步的设计改进。</u></strong></p>
<br>

<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><p>在本项目中，成功制作了β型斯特林发动机的基本驱动部件：气缸与活塞，整体装置由排气活塞、做功活塞、气缸和散热片四个部件组成。在制作过程中，主要完成了从分析需求与设计要求，到提出具体的设计方案，再到实际建模确定具体尺寸参数并绘制工程图纸以进行机加工，最终完成了整个驱动部件的制造。在设计的同时也对确定的参数进行了一定的热力学数值分析进行验证使得制造出的部件能够初步满足最终斯特林发动机输出功率等方面的性能要求。</p>
<p>通过完成本次项目课题，对于气体受热膨胀做功有了更深层次的认识并将这一热力学原理成功运用于设计与制造实践中，同时也提升了对密封、摩擦、公差设计、基本加工工艺、材料传热性能等多方面的认识。该驱动部件的成功制作也为后续斯特林发动机的整体制造完善与效果参数实现打下了良好的基础，有助于后续进一步设计与制造流程的开展。</p>
<p><strong>在本次项目课题中，从自己设计、建模出图纸到寻找加工方再到最终成品的组装与测试，大体完成了金属件从设计到加工再到实际测试的全流程。最终的测试结果并不算令人满意，主要是由于在设计阶段缺乏对于气密性的考虑，并未进行密封圈的设计与选型，特别是β型斯特林发动机的驱动部件，由于其有做功与排气两个活塞，两个活塞连杆之间的空隙也对整体装置的气密性造成了一定影响。除此之外，在图纸设计过程中，缺乏公差的预留也让最终加工出的成品在组装时遇到了一些小的瑕疵，进行了局部的二次微小加工才顺利完成安装，并在气密性上带来了一定的影响。不过也正是因为完成该驱动部件的制作，才能在实际的操作过程中体会到加工过程中可能存在的问题，这也有利于后面在发动机整体的一代与二代样机的过程中减少不必要的时间与加工成本，少走弯路。相信这次加工制作中所遇到的问题能在接下来的完整样机制作中得到进一步解决。</strong></p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2023/10/05/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"><img class="fill" src="/images/phi.png" alt="3.线性神经网络"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-10-05T08:20:00.000Z" title="2023/10/5 16:20:00">2023-10-05</time>发表</span><span class="level-item"><time dateTime="2023-10-05T08:20:38.394Z" title="2023/10/5 16:20:38">2023-10-05</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">动手学深度学习</a></span><span class="level-item">20 分钟读完 (大约3052个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/10/05/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/">3.线性神经网络</a></p><div class="content"><h2 id="3-1-线性回归"><a href="#3-1-线性回归" class="headerlink" title="3.1 线性回归"></a>3.1 线性回归</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">n=<span class="number">10000</span></span><br><span class="line">a=torch.ones([n])</span><br><span class="line">b=torch.ones([n])</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义计时器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Timer</span>: <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#记录多次运行时间</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.times=[]</span><br><span class="line">        self.start()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#启动计时器</span></span><br><span class="line">        self.tik=time.time()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#停止计时器并将时间记录在列表中</span></span><br><span class="line">        self.times.append(time.time()-self.tik)</span><br><span class="line">        <span class="keyword">return</span> self.times[-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">avg</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#返回平均时间</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.times)/<span class="built_in">len</span>(self.times)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sum</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#返回时间总和</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.times)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cumsum</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#返回累计时间</span></span><br><span class="line">        <span class="keyword">return</span> np.array(self.times).cumsum().tolist()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=torch.zeros(n)</span><br><span class="line">timer=Timer()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    c[i]=a[i]+b[i]</span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;timer.stop():<span class="number">.5</span>f&#125;</span>sec&#x27;</span></span><br></pre></td></tr></table></figure>




<pre><code>&#39;0.14660sec&#39;
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">timer.start()</span><br><span class="line">d=a+b</span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;timer.stop():<span class="number">.5</span>f&#125;</span>sec&#x27;</span></span><br></pre></td></tr></table></figure>




<pre><code>&#39;0.00000sec&#39;
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">normal</span>(<span class="params">x,mu,sigma</span>):</span><br><span class="line">    p=<span class="number">1</span>/math.sqrt(<span class="number">2</span>*math.pi*sigma**<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> p*np.exp(-<span class="number">0.5</span>/sigma**<span class="number">2</span>*(x-mu)**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次使用numpy进行可视化</span></span><br><span class="line">x=np.arange(-<span class="number">7</span>,<span class="number">7</span>,<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#均值和标准差对</span></span><br><span class="line">params=[(<span class="number">0</span>,<span class="number">1</span>),(<span class="number">0</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">1</span>)]</span><br><span class="line">d2l.plot(x,[normal(x,mu,sigma)<span class="keyword">for</span> mu,sigma <span class="keyword">in</span> params],xlabel=<span class="string">&#x27;x&#x27;</span>,ylabel=<span class="string">&#x27;p(x)&#x27;</span>,figsize=(<span class="number">4.5</span>,<span class="number">2.5</span>),legend=[<span class="string">f&#x27;mean<span class="subst">&#123;mu&#125;</span>,std<span class="subst">&#123;sigma&#125;</span>&#x27;</span><span class="keyword">for</span> mu,sigma <span class="keyword">in</span> params])</span><br></pre></td></tr></table></figure>


<p>​<br><img src="/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_files/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_4_0.svg" alt="svg"><br>​    </p>
<h2 id="3-2-线性回归的从零开始实现"><a href="#3-2-线性回归的从零开始实现" class="headerlink" title="3.2 线性回归的从零开始实现"></a>3.2 线性回归的从零开始实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成数据集</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">synthetic_data</span>(<span class="params">w,b,num_examples</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#生成y=Xw+b+噪声</span></span><br><span class="line">    X=torch.normal(<span class="number">0</span>,<span class="number">1</span>,(num_examples,<span class="built_in">len</span>(w)))</span><br><span class="line">    y=torch.matmul(X,w)+b</span><br><span class="line">    y+=torch.normal(<span class="number">0</span>,<span class="number">0.01</span>,y.shape)</span><br><span class="line">    <span class="keyword">return</span> X,y.reshape((-<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">true_w=torch.tensor([<span class="number">2</span>,-<span class="number">3.4</span>])</span><br><span class="line">true_b=<span class="number">4.2</span></span><br><span class="line">features,labels=synthetic_data(true_w,true_b,<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;features:&#x27;</span>,features[<span class="number">0</span>],<span class="string">&#x27;\nlabel:&#x27;</span>,labels[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<pre><code>features: tensor([ 0.7328, -0.5520]) 
label: tensor([7.5513])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d2l.set_figsize()</span><br><span class="line">d2l.plt.scatter(features[:,<span class="number">1</span>].detach().numpy(),labels.detach().numpy(),<span class="number">1</span>);</span><br></pre></td></tr></table></figure>


<p>​<br><img src="/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_files/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_7_0.svg" alt="svg"><br>​    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#读取数据集</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">data_iter</span>(<span class="params">batch_size,features,labels</span>):</span><br><span class="line">    num_examples=<span class="built_in">len</span>(features)</span><br><span class="line">    indices=<span class="built_in">list</span>(<span class="built_in">range</span>(num_examples))</span><br><span class="line">    <span class="comment">#这些样本是随机读取的，没有特定顺序</span></span><br><span class="line">    random.shuffle(indices)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,num_examples,batch_size):</span><br><span class="line">        batch_indices=torch.tensor(indices[i:<span class="built_in">min</span>(i+batch_size,num_examples)])</span><br><span class="line">        <span class="keyword">yield</span> features[batch_indices],labels[batch_indices]</span><br><span class="line">        </span><br><span class="line">batch_size=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> X,y <span class="keyword">in</span> data_iter(batch_size,features,labels):</span><br><span class="line">    <span class="built_in">print</span>(X,<span class="string">&#x27;\n&#x27;</span>,y)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<pre><code>tensor([[ 0.9175, -0.1441],
        [-0.3328, -0.4237],
        [-0.1287,  1.6801],
        [ 0.8705, -0.9030],
        [-0.4966,  1.4015],
        [ 1.3378, -1.8026],
        [ 0.5129,  1.2806],
        [ 1.1026,  1.2080],
        [ 0.6151,  0.6337],
        [-0.4683, -0.4388]]) 
 tensor([[ 6.5336],
        [ 4.9801],
        [-1.7645],
        [ 9.0089],
        [-1.5652],
        [12.9979],
        [ 0.8680],
        [ 2.2893],
        [ 3.2902],
        [ 4.7695]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#初始化模型参数</span></span><br><span class="line">w=torch.normal(<span class="number">0</span>,<span class="number">0.01</span>,size=(<span class="number">2</span>,<span class="number">1</span>),requires_grad=<span class="literal">True</span>)</span><br><span class="line">b=torch.zeros(<span class="number">1</span>,requires_grad=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义模型</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">linreg</span>(<span class="params">X,w,b</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#线性回归模型</span></span><br><span class="line">    <span class="keyword">return</span> torch.matmul(X,w)+b</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义损失函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">squared_loss</span>(<span class="params">y_hat,y</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#均方损失</span></span><br><span class="line">    <span class="keyword">return</span>(y_hat-y.reshape(y_hat.shape))**<span class="number">2</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义优化算法——小批量随机梯度下降</span></span><br><span class="line"><span class="comment">#lr:学习速率(梯度下降步长)；batch_size:批量大小</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sgd</span>(<span class="params">params,lr,batch_size</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#小批量随机梯度下降</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">            param-=lr*param.grad/batch_size</span><br><span class="line">            param.grad.zero_()</span><br><span class="line">            </span><br><span class="line"><span class="comment">#训练</span></span><br><span class="line"><span class="comment">#设置超参数</span></span><br><span class="line">lr=<span class="number">0.03</span><span class="comment">#学习率</span></span><br><span class="line">num_epochs=<span class="number">3</span><span class="comment">#迭代周期个数</span></span><br><span class="line">net=linreg</span><br><span class="line">loss=squared_loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> X,y <span class="keyword">in</span> data_iter(batch_size,features,labels):</span><br><span class="line">        l=loss(net(X,w,b),y)<span class="comment">#X和y的小批量损失</span></span><br><span class="line">        <span class="comment">#因为l的形状是（batch_size,1），而不是一个标量。l中的所有元素被加到一起，并以此计算关于[w,b]的梯度</span></span><br><span class="line">        l.<span class="built_in">sum</span>().backward()</span><br><span class="line">        sgd([w,b],lr,batch_size)<span class="comment">#使用参数的梯度以更新参数</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        train_l=loss(net(features,w,b),labels)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;epoch<span class="subst">&#123;epoch+<span class="number">1</span>&#125;</span>,loss<span class="subst">&#123;<span class="built_in">float</span>(train_l.mean()):f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>epoch1,loss0.036941
epoch2,loss0.000134
epoch3,loss0.000049
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;w的估计误差：<span class="subst">&#123;true_w-w.reshape(true_w.shape)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;b的估计误差：<span class="subst">&#123;true_b-b&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>w的估计误差：tensor([ 0.0002, -0.0002], grad_fn=&lt;SubBackward0&gt;)
b的估计误差：tensor([0.0002], grad_fn=&lt;RsubBackward1&gt;)
</code></pre>
<h2 id="3-3-线性回归的简洁实现"><a href="#3-3-线性回归的简洁实现" class="headerlink" title="3.3 线性回归的简洁实现"></a>3.3 线性回归的简洁实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成数据集</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils <span class="keyword">import</span> data</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">true_w=torch.tensor([<span class="number">2</span>,-<span class="number">3.4</span>])</span><br><span class="line">true_b=<span class="number">4.2</span></span><br><span class="line">features,labels=d2l.synthetic_data(true_w,true_b,<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#读取数据集</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_array</span>(<span class="params">data_arrays,batch_size,is_train=<span class="literal">True</span></span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#构造一个pytorch数据迭代器</span></span><br><span class="line">    dataset=data.TensorDataset(*data_arrays)</span><br><span class="line">    <span class="keyword">return</span> data.DataLoader(dataset,batch_size,shuffle=is_train)</span><br><span class="line"></span><br><span class="line">batch_size=<span class="number">10</span></span><br><span class="line">data_iter=load_array((features,labels),batch_size)</span><br><span class="line"></span><br><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(data_iter))</span><br></pre></td></tr></table></figure>




<pre><code>[tensor([[-0.6422, -0.7470],
         [-2.1785,  0.3340],
         [ 1.4011, -1.1104],
         [-0.8083, -0.3035],
         [ 0.1077, -0.1201],
         [-0.4151, -0.1079],
         [ 1.8074,  0.0904],
         [-0.3707,  0.6197],
         [ 0.3739,  0.2972],
         [ 0.2383,  1.1791]]),
 tensor([[ 5.4457],
         [-1.3122],
         [10.7837],
         [ 3.6281],
         [ 4.8105],
         [ 3.7284],
         [ 7.5017],
         [ 1.3465],
         [ 3.9247],
         [ 0.6800]])]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义模型</span></span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn<span class="comment">#nn:神经网络</span></span><br><span class="line">net=nn.Sequential(nn.Linear(<span class="number">2</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化模型参数</span></span><br><span class="line">net[<span class="number">0</span>].weight.data.normal_(<span class="number">0</span>,<span class="number">0.01</span>),net[<span class="number">0</span>].bias.data.fill_(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[ 0.0106, -0.0055]]), tensor([0.]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义损失函数</span></span><br><span class="line">loss=nn.MSELoss()<span class="comment">#均方误差：MSELoss类，平方L2范数</span></span><br><span class="line"><span class="comment">#定义优化算法</span></span><br><span class="line">trainer=torch.optim.SGD(net.parameters(),lr=<span class="number">0.03</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num_epochs=<span class="number">3</span><span class="comment">#迭代周期个数</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> X,y <span class="keyword">in</span> data_iter:</span><br><span class="line">        l=loss(net(X),y)<span class="comment">#X和y的小批量损失</span></span><br><span class="line">        trainer.zero_grad()</span><br><span class="line">        l.backward()</span><br><span class="line">        trainer.step()<span class="comment">#使用参数的梯度以更新参数</span></span><br><span class="line">    l=loss(net(features),labels)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;epoch<span class="subst">&#123;epoch+<span class="number">1</span>&#125;</span>,loss<span class="subst">&#123;l:f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<pre><code>epoch1,loss0.000223
epoch2,loss0.000112
epoch3,loss0.000112
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w=net[<span class="number">0</span>].weight.data</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;w的估计误差：&#x27;</span>,true_w-w.reshape(true_w.shape))</span><br><span class="line">b=net[<span class="number">0</span>].bias.data</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;b的估计误差：&#x27;</span>,true_b-b)</span><br></pre></td></tr></table></figure>

<pre><code>w的估计误差： tensor([ 0.0014, -0.0004])
b的估计误差： tensor([0.0008])
</code></pre>
<h2 id="3-5-图像分类数据集"><a href="#3-5-图像分类数据集" class="headerlink" title="3.5 图像分类数据集"></a>3.5 图像分类数据集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch.utils <span class="keyword">import</span> data</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">d2l.use_svg_display()</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过框架内内置函数将Fashion-MNIST数据集下载并读取到内存中</span></span><br><span class="line"><span class="comment">#通过ToTensor实例将图像数据由PIL类型变换为32位浮点数格式，并除以255使得所有像素数值均在0-1之间</span></span><br><span class="line">trans=transforms.ToTensor()</span><br><span class="line">mnist_train=torchvision.datasets.FashionMNIST(root=<span class="string">&quot;../data&quot;</span>,train=<span class="literal">True</span>,transform=trans,download=<span class="literal">True</span>)</span><br><span class="line">mnist_test=torchvision.datasets.FashionMNIST(root=<span class="string">&quot;../data&quot;</span>,train=<span class="literal">False</span>,transform=trans,download=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">len</span>(mnist_train),<span class="built_in">len</span>(mnist_test)</span><br></pre></td></tr></table></figure>




<pre><code>(60000, 10000)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mnist_train[<span class="number">0</span>][<span class="number">0</span>].shape</span><br></pre></td></tr></table></figure>




<pre><code>torch.Size([1, 28, 28])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在数字标签索引与文本名称之间进行转换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_fashion_mnist_labels</span>(<span class="params">labels</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#返回Fashion-MNIST数据集的文本标签</span></span><br><span class="line">    text_labels=[<span class="string">&#x27;t-shirt&#x27;</span>,<span class="string">&#x27;trouser&#x27;</span>,<span class="string">&#x27;pullover&#x27;</span>,<span class="string">&#x27;dress&#x27;</span>,<span class="string">&#x27;coat&#x27;</span>,<span class="string">&#x27;sandal&#x27;</span>,<span class="string">&#x27;shirt&#x27;</span>,<span class="string">&#x27;sneaker&#x27;</span>,<span class="string">&#x27;bag&#x27;</span>,<span class="string">&#x27;ankle boot&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> [text_labels[<span class="built_in">int</span>(i)] <span class="keyword">for</span> i <span class="keyword">in</span> labels]</span><br><span class="line"></span><br><span class="line"><span class="comment">#可视化样本</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_images</span>(<span class="params">imgs,num_rows,num_cols,titles=<span class="literal">None</span>,scale=<span class="number">1.5</span></span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#绘制图像列表</span></span><br><span class="line">    figsize=(num_cols*scale,num_rows*scale)</span><br><span class="line">    _,axes=d2l.plt.subplots(num_rows,num_cols,figsize=figsize)</span><br><span class="line">    axes=axes.flatten()</span><br><span class="line">    <span class="keyword">for</span> i,(ax,img) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(axes,imgs)):</span><br><span class="line">        <span class="keyword">if</span> torch.is_tensor(img):</span><br><span class="line">            <span class="comment">#图片张量</span></span><br><span class="line">            ax.imshow(img.numpy())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#PIL图片</span></span><br><span class="line">            ax.imshow(img)</span><br><span class="line">        ax.axes.get_xaxis().set_visible(<span class="literal">False</span>)</span><br><span class="line">        ax.axes.get_yaxis().set_visible(<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> titles:</span><br><span class="line">            ax.set_title(titles[i])</span><br><span class="line">    <span class="keyword">return</span> axes</span><br><span class="line"></span><br><span class="line">X,y=<span class="built_in">next</span>(<span class="built_in">iter</span>(data.DataLoader(mnist_train,batch_size=<span class="number">50</span>)))</span><br><span class="line">show_images(X.reshape(<span class="number">50</span>,<span class="number">28</span>,<span class="number">28</span>),<span class="number">10</span>,<span class="number">5</span>,titles=get_fashion_mnist_labels(y));</span><br></pre></td></tr></table></figure>


<p>​<br><img src="/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_files/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_22_0.svg" alt="svg"><br>​    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#读取小批量</span></span><br><span class="line">batch_size=<span class="number">256</span> <span class="comment">#批量大小</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_dataloader_workers</span>():  <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#使用4个进程来读取数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line">train_iter=data.DataLoader(mnist_train,batch_size,shuffle=<span class="literal">True</span>,num_workers=get_dataloader_workers())</span><br><span class="line"></span><br><span class="line"><span class="comment">#读取训练数据所需时间</span></span><br><span class="line">timer=d2l.Timer()</span><br><span class="line"><span class="keyword">for</span> X,y <span class="keyword">in</span> train_iter:</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;timer.stop():<span class="number">.2</span>f&#125;</span>sec&#x27;</span></span><br></pre></td></tr></table></figure>




<pre><code>&#39;2.11sec&#39;
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_data_fashion_mnist</span>(<span class="params">batch_size,resize=<span class="literal">None</span></span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#下载Fashion-MNIST数据集，然后将其加载到内存中</span></span><br><span class="line">    trans=[transforms.ToTensor()]</span><br><span class="line">    <span class="keyword">if</span> resize:</span><br><span class="line">        trans.insert(<span class="number">0</span>,transforms.Resize(resize))</span><br><span class="line">    trans=transforms.Compose(trans)</span><br><span class="line">    mnist_train=torchvision.datasets.FashionMNIST(root=<span class="string">&quot;../data&quot;</span>,train=<span class="literal">True</span>,transform=trans,download=<span class="literal">True</span>)</span><br><span class="line">    mnist_test=torchvision.datasets.FashionMNIST(root=<span class="string">&quot;../data&quot;</span>,train=<span class="literal">False</span>,transform=trans,download=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span>(data.DataLoader(mnist_train,batch_size,shuffle=<span class="literal">True</span>,num_workers=get_dataloader_workers()),data.DataLoader(mnist_test,batch_size,shuffle=<span class="literal">False</span>,num_workers=get_dataloader_workers()))</span><br><span class="line"></span><br><span class="line">train_iter,test_iter=load_data_fashion_mnist(<span class="number">32</span>,resize=<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> X,y <span class="keyword">in</span> train_iter:</span><br><span class="line">    <span class="built_in">print</span>(X.shape,X.dtype,y.shape,y.dtype)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<pre><code>torch.Size([32, 1, 64, 64]) torch.float32 torch.Size([32]) torch.int64
</code></pre>
<h2 id="3-6-softmax回归的从零开始实现"><a href="#3-6-softmax回归的从零开始实现" class="headerlink" title="3.6 softmax回归的从零开始实现"></a>3.6 softmax回归的从零开始实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> IPython <span class="keyword">import</span> display</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">batch_size=<span class="number">256</span></span><br><span class="line">train_iter,test_iter=d2l.load_data_fashion_mnist(batch_size)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#初始化模型参数</span></span><br><span class="line">num_inputs=<span class="number">784</span></span><br><span class="line">num_outputs=<span class="number">10</span></span><br><span class="line"></span><br><span class="line">W=torch.normal(<span class="number">0</span>,<span class="number">0.01</span>,size=(num_inputs,num_outputs),requires_grad=<span class="literal">True</span>)<span class="comment">#用正态分布初始化权重W</span></span><br><span class="line">b=torch.zeros(num_outputs,requires_grad=<span class="literal">True</span>)<span class="comment">#偏置b初始化为0</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X=torch.tensor([[<span class="number">1.0</span>,<span class="number">2.0</span>,<span class="number">3.0</span>],[<span class="number">4.0</span>,<span class="number">5.0</span>,<span class="number">6.0</span>]])</span><br><span class="line">X.<span class="built_in">sum</span>(<span class="number">0</span>,keepdim=<span class="literal">True</span>),X.<span class="built_in">sum</span>(<span class="number">1</span>,keepdim=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[5., 7., 9.]]),
 tensor([[ 6.],
         [15.]]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义softmax操作</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">softmax</span>(<span class="params">X</span>):</span><br><span class="line">    X_exp=torch.exp(X)</span><br><span class="line">    partition=X_exp.<span class="built_in">sum</span>(<span class="number">1</span>,keepdim=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> X_exp/partition <span class="comment">#应用广播机制</span></span><br><span class="line"></span><br><span class="line">X=torch.normal(<span class="number">0</span>,<span class="number">1</span>,(<span class="number">2</span>,<span class="number">5</span>))</span><br><span class="line">X_prob=softmax(X)</span><br><span class="line">X_prob,X_prob.<span class="built_in">sum</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[0.2143, 0.0127, 0.1268, 0.2248, 0.4214],
         [0.3360, 0.2826, 0.0913, 0.1454, 0.1446]]),
 tensor([1.0000, 1.0000]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义模型</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">net</span>(<span class="params">X</span>):</span><br><span class="line">    <span class="keyword">return</span> softmax(torch.matmul(X.reshape((-<span class="number">1</span>,W.shape[<span class="number">0</span>])),W)+b)   <span class="comment">#使用reshape函数将每张原始图像展平为向量</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y=torch.tensor([<span class="number">0</span>,<span class="number">2</span>])</span><br><span class="line">y_hat=torch.tensor([[<span class="number">0.1</span>,<span class="number">0.3</span>,<span class="number">0.6</span>],[<span class="number">0.3</span>,<span class="number">0.2</span>,<span class="number">0.5</span>]])</span><br><span class="line">y_hat[[<span class="number">0</span>,<span class="number">1</span>],y]</span><br></pre></td></tr></table></figure>




<pre><code>tensor([0.1000, 0.5000])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义交叉熵损失函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cross_entropy</span>(<span class="params">y_hat,y</span>):</span><br><span class="line">    <span class="keyword">return</span> - torch.log(y_hat[<span class="built_in">range</span>(<span class="built_in">len</span>(y_hat)),y])</span><br><span class="line"></span><br><span class="line">cross_entropy(y_hat,y)</span><br></pre></td></tr></table></figure>




<pre><code>tensor([2.3026, 0.6931])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">accuracy</span>(<span class="params">y_hat,y</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#计算正确预测的数量</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(y_hat.shape)&gt;<span class="number">1</span> <span class="keyword">and</span> y_hat.shape[<span class="number">1</span>]&gt;<span class="number">1</span>:</span><br><span class="line">        y_hat=y_hat.argmax(axis=<span class="number">1</span>)</span><br><span class="line">    cmp=y_hat.<span class="built_in">type</span>(y.dtype)==y</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">float</span>(cmp.<span class="built_in">type</span>(y.dtype).<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line">accuracy(y_hat,y)/<span class="built_in">len</span>(y)  <span class="comment">#正确预测的概率（分类精度率）</span></span><br></pre></td></tr></table></figure>




<pre><code>0.5
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate_accuracy</span>(<span class="params">net,data_iter</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#计算在指定数据集上模型的精度</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(net,torch.nn.Module):</span><br><span class="line">        net.<span class="built_in">eval</span>() <span class="comment">#将模型设置为评估模式</span></span><br><span class="line">    metric=Accumulator(<span class="number">2</span>) <span class="comment">#正确预测数、预测总数的叠加</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> X,y <span class="keyword">in</span> data_iter:</span><br><span class="line">            metric.add(accuracy(net(X),y),y.numel())  <span class="comment">#accracy(net(X),y):正确预测数；y.numel()预测总数</span></span><br><span class="line">    <span class="keyword">return</span> metric[<span class="number">0</span>]/metric[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Accumulator</span>: <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#在n个变量上累加</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,n</span>):</span><br><span class="line">        self.data=[<span class="number">0.0</span>]*n</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self,*args</span>):</span><br><span class="line">        self.data=[a+<span class="built_in">float</span>(b) <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(self.data,args)]</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        self.data=[<span class="number">0.0</span>]*<span class="built_in">len</span>(self.data)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self,idx</span>):</span><br><span class="line">        <span class="keyword">return</span> self.data[idx]</span><br><span class="line">    </span><br><span class="line">evaluate_accuracy(net,test_iter)</span><br></pre></td></tr></table></figure>




<pre><code>0.1326
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#训练</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_epoch_ch3</span>(<span class="params">net,train_iter,loss,updater</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#训练模型一个迭代周期</span></span><br><span class="line">    <span class="comment">#将模型设置为训练模型</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(net,torch.nn.Module):</span><br><span class="line">        net.train()</span><br><span class="line">    <span class="comment">#训练损失总和、训练准确度总和、样本数</span></span><br><span class="line">    metric=Accumulator(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> X,y <span class="keyword">in</span> train_iter:</span><br><span class="line">        <span class="comment">#计算梯度并更新参数</span></span><br><span class="line">        y_hat=net(X)</span><br><span class="line">        l=loss(y_hat,y)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(updater,torch.optim.Optimizer):</span><br><span class="line">            <span class="comment">#使用PyTorch内置的优化器和损失函数</span></span><br><span class="line">            updater.zero_grad()</span><br><span class="line">            l.mean().backward()</span><br><span class="line">            updater.step()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#使用定制的优化器和损失函数</span></span><br><span class="line">            l.<span class="built_in">sum</span>().backward()</span><br><span class="line">            updater(X.shape[<span class="number">0</span>])</span><br><span class="line">        metric.add(<span class="built_in">float</span>(l.<span class="built_in">sum</span>()),accuracy(y_hat,y),y.numel())</span><br><span class="line">    <span class="comment">#返回训练损失和训练精度</span></span><br><span class="line">    <span class="keyword">return</span> metric[<span class="number">0</span>]/metric[<span class="number">2</span>],metric[<span class="number">1</span>]/metric[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animator</span>:  <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#在动画中绘制数据</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, xlabel=<span class="literal">None</span>, ylabel=<span class="literal">None</span>, legend=<span class="literal">None</span>, xlim=<span class="literal">None</span>,ylim=<span class="literal">None</span>, xscale=<span class="string">&#x27;linear&#x27;</span>, yscale=<span class="string">&#x27;linear&#x27;</span>,fmts=(<span class="params"><span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;m--&#x27;</span>, <span class="string">&#x27;g-.&#x27;</span>, <span class="string">&#x27;r:&#x27;</span></span>), nrows=<span class="number">1</span>, ncols=<span class="number">1</span>,figsize=(<span class="params"><span class="number">3.5</span>, <span class="number">2.5</span></span>)</span>):</span><br><span class="line">        <span class="comment"># 增量地绘制多条线</span></span><br><span class="line">        <span class="keyword">if</span> legend <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            legend = []</span><br><span class="line">        d2l.use_svg_display()</span><br><span class="line">        self.fig, self.axes = d2l.plt.subplots(nrows, ncols, figsize=figsize)</span><br><span class="line">        <span class="keyword">if</span> nrows * ncols == <span class="number">1</span>:</span><br><span class="line">            self.axes = [self.axes, ]</span><br><span class="line">        <span class="comment"># 使用lambda函数捕获参数</span></span><br><span class="line">        self.config_axes = <span class="keyword">lambda</span>: d2l.set_axes(</span><br><span class="line">            self.axes[<span class="number">0</span>], xlabel, ylabel, xlim, ylim, xscale, yscale, legend)</span><br><span class="line">        self.X, self.Y, self.fmts = <span class="literal">None</span>, <span class="literal">None</span>, fmts</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="comment"># 向图表中添加多个数据点</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(y, <span class="string">&quot;__len__&quot;</span>):</span><br><span class="line">            y = [y]</span><br><span class="line">        n = <span class="built_in">len</span>(y)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(x, <span class="string">&quot;__len__&quot;</span>):</span><br><span class="line">            x = [x] * n</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.X:</span><br><span class="line">            self.X = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.Y:</span><br><span class="line">            self.Y = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">for</span> i, (a, b) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(x, y)):</span><br><span class="line">            <span class="keyword">if</span> a <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> b <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                self.X[i].append(a)</span><br><span class="line">                self.Y[i].append(b)</span><br><span class="line">        self.axes[<span class="number">0</span>].cla()</span><br><span class="line">        <span class="keyword">for</span> x, y, fmt <span class="keyword">in</span> <span class="built_in">zip</span>(self.X, self.Y, self.fmts):</span><br><span class="line">            self.axes[<span class="number">0</span>].plot(x, y, fmt)</span><br><span class="line">        self.config_axes()</span><br><span class="line">        display.display(self.fig)</span><br><span class="line">        display.clear_output(wait=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_ch3</span>(<span class="params">net,train_iter,test_iter,loss,num_epochs,updater</span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#训练模型</span></span><br><span class="line">    animator=Animator(xlabel=<span class="string">&#x27;epoch&#x27;</span>,xlim=[<span class="number">1</span>,num_epochs],ylim=[<span class="number">0.3</span>,<span class="number">0.9</span>],legend=[<span class="string">&#x27;train loss&#x27;</span>,<span class="string">&#x27;train acc&#x27;</span>,<span class="string">&#x27;test acc&#x27;</span>])</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">        train_metrics=train_epoch_ch3(net,train_iter,loss,updater)</span><br><span class="line">        test_acc=evaluate_accuracy(net,test_iter)</span><br><span class="line">        animator.add(epoch+<span class="number">1</span>,train_metrics+(test_acc,))</span><br><span class="line">    train_loss,train_acc=train_metrics</span><br><span class="line">    <span class="keyword">assert</span> train_loss&lt;<span class="number">0.5</span>,train_loss</span><br><span class="line">    <span class="keyword">assert</span> train_acc&lt;=<span class="number">1</span> <span class="keyword">and</span> train_acc&gt;<span class="number">0.7</span>,train_acc</span><br><span class="line">    <span class="keyword">assert</span> test_acc&lt;=<span class="number">1</span> <span class="keyword">and</span> test_acc&gt;<span class="number">0.7</span>,test_acc</span><br><span class="line">    </span><br><span class="line">lr=<span class="number">0.1</span> <span class="comment">#学习率</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">updater</span>(<span class="params">batch_size</span>):</span><br><span class="line">    <span class="keyword">return</span> d2l.sgd([W,b],lr,batch_size)<span class="comment">#小批量随机梯度下降</span></span><br><span class="line"></span><br><span class="line">num_epochs=<span class="number">10</span> <span class="comment">#迭代周期</span></span><br><span class="line">train_ch3(net,train_iter,test_iter,cross_entropy,num_epochs,updater)</span><br></pre></td></tr></table></figure>


<p>​<br><img src="/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_files/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_35_0.svg" alt="svg"><br>​    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#预测</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict_ch3</span>(<span class="params">net,test_iter,n=<span class="number">6</span></span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#预测标签</span></span><br><span class="line">    <span class="keyword">for</span> X,y <span class="keyword">in</span> test_iter:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    trues=d2l.get_fashion_mnist_labels(y)</span><br><span class="line">    preds=d2l.get_fashion_mnist_labels(net(X).argmax(axis=<span class="number">1</span>))</span><br><span class="line">    titles=[true+<span class="string">&#x27;\n&#x27;</span>+pred <span class="keyword">for</span> true,pred <span class="keyword">in</span> <span class="built_in">zip</span>(trues,preds)]</span><br><span class="line">    d2l.show_images(X[<span class="number">0</span>:n].reshape((n,<span class="number">28</span>,<span class="number">28</span>)),<span class="number">1</span>,n,titles=titles[<span class="number">0</span>:n])</span><br><span class="line">    </span><br><span class="line">predict_ch3(net,test_iter)</span><br></pre></td></tr></table></figure>


<p>​<br><img src="/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_files/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_36_0.svg" alt="svg"><br>​    </p>
<h2 id="3-7-softmax回归的简洁实现"><a href="#3-7-softmax回归的简洁实现" class="headerlink" title="3.7 softmax回归的简洁实现"></a>3.7 softmax回归的简洁实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">batch_size=<span class="number">256</span></span><br><span class="line">train_iter,test_iter=d2l.load_data_fashion_mnist(batch_size)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#初始化模型参数</span></span><br><span class="line"><span class="comment">#PyTorch不会隐式地调整输入的形状，因此，我们在线性层前定义了展平层（flatten),来调整网络输入的形状</span></span><br><span class="line">net=nn.Sequential(nn.Flatten(),nn.Linear(<span class="number">784</span>,<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_weights</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(m)==nn.Linear:</span><br><span class="line">        nn.init.normal_(m.weight,std=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">net.apply(init_weights);</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss=nn.CrossEntropyLoss(reduction=<span class="string">&#x27;none&#x27;</span>) <span class="comment">#保留softmax函数，但在计算交叉熵损失函数时传递未规范化的预测并同时计算softmax及其对数以防止数值上溢或下溢</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#优化算法：学习度为0.1的小批量随机梯度下降</span></span><br><span class="line">trainer=torch.optim.SGD(net.parameters(),lr=<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#训练</span></span><br><span class="line">num_epochs=<span class="number">10</span></span><br><span class="line">d2l.train_ch3(net,train_iter,test_iter,loss,num_epochs,trainer)</span><br></pre></td></tr></table></figure>


<p>​<br><img src="/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_files/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_42_0.svg" alt="svg"><br>​    </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-10-01T10:08:58.000Z" title="2023/10/1 18:08:58">2023-10-01</time>发表</span><span class="level-item"><time dateTime="2023-10-13T02:53:59.917Z" title="2023/10/13 10:53:59">2023-10-13</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a><span> / </span><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/">工程设计</a></span><span class="level-item">16 分钟读完 (大约2340个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/10/01/%E6%8A%A5%E5%91%8A/">课题：典型建筑墙体的稳态传热分析</a></p><div class="content"><h1 id="课题：典型建筑墙体的稳态传热分析"><a href="#课题：典型建筑墙体的稳态传热分析" class="headerlink" title="课题：典型建筑墙体的稳态传热分析"></a>课题：典型建筑墙体的稳态传热分析</h1><p><em><strong><u>22级明月2班 20224546 许晶华</u></strong></em></p>
 <br>

<h2 id="一、背景介绍"><a href="#一、背景介绍" class="headerlink" title="一、背景介绍"></a>一、背景介绍</h2><p>建筑墙体作为建筑的重要组成部分，在维护室内舒适温度和能源效率方面起着重要作用，研究其作用及在传热过程中的特性对生态建筑的可持续发展具有重要的指导意义。发展生态节能建筑最终的目标就是要在满足室内居住者的热舒适基础上降低建筑的能耗，对实际居住者而言较关注的是如何以较低的能耗获得舒适的建筑室内热环境。考虑到当前大部分大型公共建筑、工业建筑与高层住宅的主要承重构件包括梁、板、柱等均采用<u>钢筋混凝土结构</u>，因此本文将着重针对此种结构简化模型的传热过程进行分析。</p>
<p>稳态传热是指传热系统中各点的温度仅随位置而变化，不随时间而改变的传热过程，对于这一传热过程的分析有助于评估墙体在不同环境条件下的隔热性能，其中一个关键参数是环境空气流速。本研究旨在分析单位面积上典型建筑墙体的稳态散热过程，特别关注墙体散热量随环境空气流速的变化关系。</p>
<br>

<h2 id="二、物理模型"><a href="#二、物理模型" class="headerlink" title="二、物理模型"></a>二、物理模型</h2><p>钢筋混凝土墙体结构的物理模型如下图1、2、3所示。</p>
<p><img src="/images/wall/1.jpg" alt="图1：钢筋结构图解"></p>
<p><em>图1：钢筋结构图解</em></p>
<p><img src="/images/wall/2.jpg" alt="图2：墙体结构物理模型"></p>
<p><em>图2：墙体结构物理模型</em></p>
<p><img src="/images/wall/3.jpg" alt="图3：墙体处传热物理模型"></p>
<p><em>图3：墙体处传热物理模型</em></p>
<p>在上述简化模型中，选取房间中心为坐标原点，定义有如下参数：</p>
<p>（1）室内方墙高宽比为Ar&#x3D;L&#x2F;H；</p>
<p>（2）模型左端设有厚度为s的墙体；</p>
<p>（3）墙体内侧空气流速为V1，墙体外侧空气流速为V2；</p>
<p>（4）墙体内侧温度为Tf1，墙体外侧温度为Tf2，且由于研究室内散热过程，默认Tf1&gt;Tf2；</p>
<p>（5）钢筋混凝土结构内表面温度为Tw1，钢筋混凝土结构外表面温度为Tw2，且由于研究室内散热过程，默认Tw1&gt;Tw2。</p>
<p>注意：模型中方腔右侧墙体及上、下墙体均为绝热且不考虑厚度。</p>
<br>

<h2 id="三、传热过程分析"><a href="#三、传热过程分析" class="headerlink" title="三、传热过程分析"></a>三、传热过程分析</h2><p>该简化传热过程主要可以分为以下三个环节：</p>
<h3 id="（1）墙体内侧的对流换热"><a href="#（1）墙体内侧的对流换热" class="headerlink" title="（1）墙体内侧的对流换热"></a>（1）墙体内侧的对流换热</h3><p>该过程为热对流过程，由牛顿冷却公式可得：单位面积墙体上的对流传热量Q1&#x3D;hΔT1</p>
<p>其中，h为表面对流换热系数，通过查询相关文献与手册（《民用建筑热工设计规范》 GB 50176-2016)可得，当Ar&#x3D;L&#x2F;H&lt;&#x3D;0.3时，空气在钢筋混凝土内表面的对流换热系数约为8.7W&#x2F;m^2-K；当Ar&#x3D;L&#x2F;H&gt;0.3时，空气在钢筋混凝土内表面的对流换热系数约为7.6W&#x2F;m^2-K（如图4所示）。ΔT1为室内空气温度Tf1与钢筋混凝土内表面的温度Tw1之差。</p>
<p><img src="/images/wall/4.png" alt="图4:内表面换热系数αi和内表面换热阻Ri"></p>
<p><em>图4:内表面换热系数αi和内表面换热阻Ri</em></p>
<h3 id="（2）通过墙壁的导热（散热）过程"><a href="#（2）通过墙壁的导热（散热）过程" class="headerlink" title="（2）通过墙壁的导热（散热）过程"></a>（2）通过墙壁的导热（散热）过程</h3><p>该过程为热传导过程，由傅里叶定律可得：单位面积墙体上的传导热量Q2&#x3D;λΔT2&#x2F;Δx</p>
<p>其中，λ为钢筋混凝土结构的导热系数，通过查询相关文献与手册（《民用建筑热工设计规范》 GB 50176-2016)可得其值约为1.74W&#x2F;m-K；ΔT2为钢筋混凝土内外表面两侧的温度差，由于传热总是自发由高温向低温处进行，故此处特别定义为Tw1-Tw2；Δx则为墙体厚度s。</p>
<h3 id="（3）墙体外侧的对流换热"><a href="#（3）墙体外侧的对流换热" class="headerlink" title="（3）墙体外侧的对流换热"></a>（3）墙体外侧的对流换热</h3><p>该过程为热对流过程，由牛顿冷却公式可得：单位面积墙体上的对流传热量Q3&#x3D;hΔT3</p>
<p>其中，h为表面对流换热系数，通过查询相关文献与手册（《民用建筑热工设计规范》 GB 50176-2016)可得，冬季时，空气在钢筋混凝土外表面的对流换热系数约为23.0W&#x2F;m^2-K；夏季时，空气在钢筋混凝土外表面的对流换热系数约为19.0W&#x2F;m^2-K（如图5所示）。ΔT3为钢筋混凝土外表面温度Tw2与室外空气温度Tf2之差。</p>
<p><img src="/images/wall/5.png" alt="图5:外表面换热系数αe和外表面换热阻Re"></p>
<p><em>图5:外表面换热系数αe和外表面换热阻Re</em></p>
<h3 id="全热路过程分析"><a href="#全热路过程分析" class="headerlink" title="全热路过程分析"></a>全热路过程分析</h3><p>在分别考虑上述三个传热过程环节后，针对整个完整的传热过程，通过查阅相关文献资料（详见《民用建筑热工设计规范》 GB 50176-2016：3.4 基本计算方法），有如下公式：</p>
<p>单位面积墙体上的散热量Q&#x3D;Q1+Q2+Q3&#x3D;KΔT；</p>
<p>其中ΔT为室内与室外的温度差值Tf1-Tf2；K为该传热过程的传热系数；</p>
<p>传热系数K&#x3D;1&#x2F;R0，R0为整个结构的传热阻值；</p>
<p>R0&#x3D;Ri+R+Re，其中Ri为内表面换热阻，R为钢筋混凝土材料的热阻，Re为外表面换热阻；</p>
<p>Ri,Re的一般数值均可查表获得，如上图4、5所示；</p>
<p>通过查阅资料，钢筋混凝土结构的热阻计算可采用公式R&#x3D;δ&#x2F;λ，其中δ即为墙壁厚度s，λ查表可得约为1.74W&#x2F;m-K。</p>
<p>至此即可在给定的条件下计算出单位面积墙体稳态散热量（传热方程与热路图如下图6、7所示）。</p>
<p><img src="/images/wall/6.png" alt="图6:传热方程——单位面积墙体稳态散热量的定量表达式"></p>
<p><em>图6:传热方程——单位面积墙体稳态散热量的定量表达式</em></p>
<p><img src="/images/wall/7.png" alt="图7:典型建筑墙体稳态传热过程的简化热路图"></p>
<p><em>图7:典型建筑墙体稳态传热过程的简化热路图</em></p>
<p>如需要计算夏季Ar&#x3D;L&#x2F;H&gt;0.3的房屋（钢筋混凝土结构），厚度s&#x3D;0.5m的单位面积墙体稳态散热量，则依据上述数据，取Ri&#x3D;0.13m^2-K&#x2F;W,Re&#x3D;0.05m^2-K&#x2F;W,λ&#x3D;1.74W&#x2F;m-K,则可计算得出总热阻R0≈0.467m^2-K&#x2F;W，传热系数K≈2.141W&#x2F;m^2-K，若室内外温差为10K，则可计算得出此时单位面积上墙体的散热量Q约等于21.41W。</p>
<p>值得注意的是，上述数据均取自于实际的民用建筑热工设计规范标准，因此较接近于大部分情况下建筑墙体的实际情况。但事实上，表面对流换热系数的数值与换热过程中流体的物理性质、换热表面的形状、部位以及流体的流速等都有密切关系。物体表面附近的流体的流速愈大，其表面对流换热系数也愈大，一般采用经验公式进行计算。目前相关的参考资料较少，无法给出针对该典型建筑墙体结构的准确的定量计算公式衡量对流换热系数与流体流速之间的数值对应关系，只能进行定性分析与查表获取一般情况。</p>
<br>

<h2 id="四、结论"><a href="#四、结论" class="headerlink" title="四、结论"></a>四、结论</h2><p>通过对于上述分析所得到公式的整理与总结，综合可能影响墙体的表面对流换热系数等关键参数的因素，可以得出如下结论：</p>
<ol>
<li>墙体导热系数λ和墙体厚度s(δ）的增加都会导致墙体散热量减小。</li>
<li>外部环境空气流速V的增加会增加墙体散热量，尤其是在寒冷的条件下，但暂时无法给出定量的公式分析，不同的场景下该因素对于散热量的影响不同。</li>
<li>对流换热系数h的增加会显著增加墙体散热量，这取决于墙体表面特性和空气性质。</li>
</ol>
<p>因此，我们可以根据这些分析结果来优化建筑墙体的隔热性能，选择合适的材料、厚度和对流措施，以提高能源效率并确保室内舒适度。在寒冷气候下，特别要注意增加对流传热（可以通过加快内外空气对流的方式）以减少能源损失。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2023/09/27/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/"><img class="fill" src="/images/phi.png" alt="2.预备知识"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-09-27T06:06:00.000Z" title="2023/9/27 14:06:00">2023-09-27</time>发表</span><span class="level-item"><time dateTime="2023-10-05T08:20:46.077Z" title="2023/10/5 16:20:46">2023-10-05</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">动手学深度学习</a></span><span class="level-item">10 分钟读完 (大约1440个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/09/27/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/">2.预备知识</a></p><div class="content"><h2 id="2-1-数据操作"><a href="#2-1-数据操作" class="headerlink" title="2.1 数据操作"></a>2.1 数据操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">x = torch.arange(<span class="number">12</span>)</span><br><span class="line">x</span><br></pre></td></tr></table></figure>




<pre><code>tensor([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.shape</span><br></pre></td></tr></table></figure>




<pre><code>torch.Size([12])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.numel()</span><br></pre></td></tr></table></figure>




<pre><code>12
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X=x.reshape(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">X</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X.shape</span><br></pre></td></tr></table></figure>




<pre><code>torch.Size([3, 4])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Y=x.reshape(-<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">Y</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Z=x.reshape(<span class="number">3</span>,-<span class="number">1</span>)</span><br><span class="line">Z</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.zeros((<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[[0., 0., 0., 0.],
         [0., 0., 0., 0.],
         [0., 0., 0., 0.]],

        [[0., 0., 0., 0.],
         [0., 0., 0., 0.],
         [0., 0., 0., 0.]]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.ones((<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[[1., 1., 1., 1.],
         [1., 1., 1., 1.],
         [1., 1., 1., 1.]],

        [[1., 1., 1., 1.],
         [1., 1., 1., 1.],
         [1., 1., 1., 1.]]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.randn(<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 1.6438, -1.2879,  0.2324,  0.2719],
        [-0.6636,  0.9939, -0.8435, -1.0906],
        [-0.5617,  0.2107, -0.9530,  0.7362]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x=torch.tensor([<span class="number">1.0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>])</span><br><span class="line">y=torch.tensor([<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>])</span><br><span class="line">x+y,x-y,x*y,x/y,x**y</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([ 3.,  4.,  6., 10.]),
 tensor([-1.,  0.,  2.,  6.]),
 tensor([ 2.,  4.,  8., 16.]),
 tensor([0.5000, 1.0000, 2.0000, 4.0000]),
 tensor([ 1.,  4., 16., 64.]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.exp(x)</span><br></pre></td></tr></table></figure>




<pre><code>tensor([2.7183e+00, 7.3891e+00, 5.4598e+01, 2.9810e+03])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X=torch.arange(<span class="number">12</span>,dtype=torch.float32).reshape((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">X</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0.,  1.,  2.,  3.],
        [ 4.,  5.,  6.,  7.],
        [ 8.,  9., 10., 11.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Y=torch.tensor([[<span class="number">2.0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],[<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]])</span><br><span class="line">Y</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[2., 1., 4., 3.],
        [1., 2., 3., 4.],
        [4., 3., 2., 1.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.cat((X,Y),dim=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0.,  1.,  2.,  3.],
        [ 4.,  5.,  6.,  7.],
        [ 8.,  9., 10., 11.],
        [ 2.,  1.,  4.,  3.],
        [ 1.,  2.,  3.,  4.],
        [ 4.,  3.,  2.,  1.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.cat((X,Y),dim=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0.,  1.,  2.,  3.,  2.,  1.,  4.,  3.],
        [ 4.,  5.,  6.,  7.,  1.,  2.,  3.,  4.],
        [ 8.,  9., 10., 11.,  4.,  3.,  2.,  1.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X==Y,X&lt;Y</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[False,  True, False,  True],
         [False, False, False, False],
         [False, False, False, False]]),
 tensor([[ True, False,  True, False],
         [False, False, False, False],
         [False, False, False, False]]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X.<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>




<pre><code>tensor(66.)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=torch.arange(<span class="number">6</span>).reshape(<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">b=torch.arange(<span class="number">2</span>).reshape(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">a,b</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[[0],
          [1]],
 
         [[2],
          [3]],
 
         [[4],
          [5]]]),
 tensor([[0, 1]]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=a+b</span><br><span class="line">c</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[[0, 1],
         [1, 2]],

        [[2, 3],
         [3, 4]],

        [[4, 5],
         [5, 6]]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[0, 1],
        [1, 2]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X[-<span class="number">1</span>],X[<span class="number">1</span>:<span class="number">3</span>]</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([ 8.,  9., 10., 11.]),
 tensor([[ 4.,  5.,  6.,  7.],
         [ 8.,  9., 10., 11.]]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X[<span class="number">1</span>,<span class="number">2</span>]=<span class="number">9</span></span><br><span class="line">X</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0.,  1.,  2.,  3.],
        [ 4.,  5.,  9.,  7.],
        [ 8.,  9., 10., 11.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X[<span class="number">0</span>:<span class="number">2</span>,:]=<span class="number">12</span></span><br><span class="line">X</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[12., 12., 12., 12.],
        [12., 12., 12., 12.],
        [ 8.,  9., 10., 11.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before=<span class="built_in">id</span>(Y)</span><br><span class="line">Y=Y+X</span><br><span class="line"><span class="built_in">id</span>(Y)==before</span><br></pre></td></tr></table></figure>




<pre><code>False
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Z=torch.zeros_like(Y)</span><br><span class="line">Z</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[0., 0., 0., 0.],
        [0., 0., 0., 0.],
        [0., 0., 0., 0.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;id(Z):&#x27;</span>,<span class="built_in">id</span>(Z))</span><br></pre></td></tr></table></figure>

<pre><code>id(Z): 3055861362752
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Z[:]=X+Y</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;id(Z):&#x27;</span>,<span class="built_in">id</span>(Z))</span><br></pre></td></tr></table></figure>

<pre><code>id(Z): 3055861362752
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before=<span class="built_in">id</span>(X)</span><br><span class="line">X+=Y</span><br><span class="line"><span class="built_in">id</span>(X)==before</span><br></pre></td></tr></table></figure>




<pre><code>True
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A=X.numpy()</span><br><span class="line">B=torch.tensor(A)</span><br><span class="line"><span class="built_in">type</span>(A),<span class="built_in">type</span>(B)</span><br></pre></td></tr></table></figure>




<pre><code>(numpy.ndarray, torch.Tensor)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A,B</span><br></pre></td></tr></table></figure>




<pre><code>(array([[26., 25., 28., 27.],
        [25., 26., 27., 28.],
        [20., 21., 22., 23.]], dtype=float32),
 tensor([[26., 25., 28., 27.],
         [25., 26., 27., 28.],
         [20., 21., 22., 23.]]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=torch.tensor([<span class="number">3.5</span>])</span><br><span class="line">a,a.item(),<span class="built_in">float</span>(a),<span class="built_in">int</span>(a)</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([3.5000]), 3.5, 3.5, 3)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = torch.arange(<span class="number">12</span>)</span><br><span class="line">X=x.reshape(<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">X</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[[ 0,  1],
         [ 2,  3]],

        [[ 4,  5],
         [ 6,  7]],

        [[ 8,  9],
         [10, 11]]])
</code></pre>
<h2 id="2-2-数据预处理"><a href="#2-2-数据预处理" class="headerlink" title="2.2 数据预处理"></a>2.2 数据预处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.makedirs(os.path.join(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;data&#x27;</span>), exist_ok=<span class="literal">True</span>)</span><br><span class="line">data_file = os.path.join(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;house_tiny.csv&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(data_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;NumRooms,Alley,Price\n&#x27;</span>)  <span class="comment"># 列名</span></span><br><span class="line">    f.write(<span class="string">&#x27;NA,Pave,127500\n&#x27;</span>)  <span class="comment"># 每行表示一个数据样本</span></span><br><span class="line">    f.write(<span class="string">&#x27;2,NA,106000\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;4,NA,178100\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;NA,NA,140000\n&#x27;</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(data_file)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>

<pre><code>   NumRooms Alley   Price
0       NaN  Pave  127500
1       2.0   NaN  106000
2       4.0   NaN  178100
3       NaN   NaN  140000
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inputs, outputs = data.iloc[:, <span class="number">0</span>:<span class="number">2</span>], data.iloc[:, <span class="number">2</span>]</span><br><span class="line">inputs = inputs.fillna(inputs.mean())</span><br><span class="line"><span class="built_in">print</span>(inputs)</span><br></pre></td></tr></table></figure>

<pre><code>   NumRooms Alley
0       3.0  Pave
1       2.0   NaN
2       4.0   NaN
3       3.0   NaN
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inputs = pd.get_dummies(inputs)</span><br><span class="line"><span class="comment">#inputs = pd.get_dummies(inputs, dummy_na=True)</span></span><br><span class="line"><span class="built_in">print</span>(inputs)</span><br></pre></td></tr></table></figure>

<pre><code>   NumRooms  Alley_Pave  Alley_nan
0       3.0           1          0
1       2.0           0          1
2       4.0           0          1
3       3.0           0          1
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">X = torch.tensor(inputs.to_numpy(dtype=<span class="built_in">float</span>))</span><br><span class="line">y = torch.tensor(outputs.to_numpy(dtype=<span class="built_in">float</span>))</span><br><span class="line"><span class="comment">#X，y = torch.tensor(inputs.values),torch.tensor(outputs.values)</span></span><br><span class="line">X, y</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[3., 1., 0.],
         [2., 0., 1.],
         [4., 0., 1.],
         [3., 0., 1.]], dtype=torch.float64),
 tensor([127500., 106000., 178100., 140000.], dtype=torch.float64))
</code></pre>
<h2 id="2-3-线性代数"><a href="#2-3-线性代数" class="headerlink" title="2.3 线性代数"></a>2.3 线性代数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">x = torch.tensor(<span class="number">3.0</span>)</span><br><span class="line">y = torch.tensor(<span class="number">2.0</span>)</span><br><span class="line"></span><br><span class="line">x + y, x * y, x / y, x**y</span><br></pre></td></tr></table></figure>




<pre><code>(tensor(5.), tensor(6.), tensor(1.5000), tensor(9.))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x=torch.arange(<span class="number">4</span>)</span><br><span class="line">x</span><br></pre></td></tr></table></figure>




<pre><code>tensor([0, 1, 2, 3])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>




<pre><code>tensor(3)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">len</span>(x)</span><br></pre></td></tr></table></figure>




<pre><code>4
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.shape</span><br></pre></td></tr></table></figure>




<pre><code>torch.Size([4])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A=torch.arange(<span class="number">20</span>).reshape(<span class="number">5</span>,<span class="number">4</span>)</span><br><span class="line">A</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11],
        [12, 13, 14, 15],
        [16, 17, 18, 19]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.T</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0,  4,  8, 12, 16],
        [ 1,  5,  9, 13, 17],
        [ 2,  6, 10, 14, 18],
        [ 3,  7, 11, 15, 19]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">B=torch.tensor([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">2</span>,<span class="number">0</span>,<span class="number">4</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]])</span><br><span class="line">B</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[1, 2, 3],
        [2, 0, 4],
        [3, 4, 5]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B==B.T</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[True, True, True],
        [True, True, True],
        [True, True, True]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X=torch.arange(<span class="number">24</span>).reshape(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">X</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[[ 0,  1,  2,  3],
         [ 4,  5,  6,  7],
         [ 8,  9, 10, 11]],

        [[12, 13, 14, 15],
         [16, 17, 18, 19],
         [20, 21, 22, 23]]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A=torch.arange(<span class="number">20</span>,dtype=torch.float32).reshape(<span class="number">5</span>,<span class="number">4</span>)</span><br><span class="line">B=A.clone()</span><br><span class="line">A,A+B</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[ 0.,  1.,  2.,  3.],
         [ 4.,  5.,  6.,  7.],
         [ 8.,  9., 10., 11.],
         [12., 13., 14., 15.],
         [16., 17., 18., 19.]]),
 tensor([[ 0.,  2.,  4.,  6.],
         [ 8., 10., 12., 14.],
         [16., 18., 20., 22.],
         [24., 26., 28., 30.],
         [32., 34., 36., 38.]]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A*B</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[  0.,   1.,   4.,   9.],
        [ 16.,  25.,  36.,  49.],
        [ 64.,  81., 100., 121.],
        [144., 169., 196., 225.],
        [256., 289., 324., 361.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">2</span></span><br><span class="line">X=torch.arange(<span class="number">24</span>).reshape(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">a+X,(a*X).shape</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[[ 2,  3,  4,  5],
          [ 6,  7,  8,  9],
          [10, 11, 12, 13]],
 
         [[14, 15, 16, 17],
          [18, 19, 20, 21],
          [22, 23, 24, 25]]]),
 torch.Size([2, 3, 4]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x=torch.arange(<span class="number">4</span>,dtype=torch.float32)</span><br><span class="line">x,x.<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([0., 1., 2., 3.]), tensor(6.))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.shape,A.<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>




<pre><code>(torch.Size([5, 4]), tensor(190.))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A_sum_axis0=A.<span class="built_in">sum</span>(axis=<span class="number">0</span>)</span><br><span class="line">A_sum_axis0,A_sum_axis0.shape</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([40., 45., 50., 55.]), torch.Size([4]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A_sum_axis1=A.<span class="built_in">sum</span>(axis=<span class="number">1</span>)</span><br><span class="line">A_sum_axis1,A_sum_axis1.shape</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([ 6., 22., 38., 54., 70.]), torch.Size([5]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.<span class="built_in">sum</span>(axis=[<span class="number">0</span>,<span class="number">1</span>])</span><br></pre></td></tr></table></figure>




<pre><code>tensor(190.)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.mean(),A.<span class="built_in">sum</span>(),A.numel(),A.<span class="built_in">sum</span>()/A.numel()</span><br></pre></td></tr></table></figure>




<pre><code>(tensor(9.5000), tensor(190.), 20, tensor(9.5000))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.mean(axis=<span class="number">0</span>),A.<span class="built_in">sum</span>(axis=<span class="number">0</span>)/A.shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([ 8.,  9., 10., 11.]), tensor([ 8.,  9., 10., 11.]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sum_A=A.<span class="built_in">sum</span>(axis=<span class="number">1</span>,keepdims=<span class="literal">True</span>)</span><br><span class="line">sum_A</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 6.],
        [22.],
        [38.],
        [54.],
        [70.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A / sum_A</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[0.0000, 0.1667, 0.3333, 0.5000],
        [0.1818, 0.2273, 0.2727, 0.3182],
        [0.2105, 0.2368, 0.2632, 0.2895],
        [0.2222, 0.2407, 0.2593, 0.2778],
        [0.2286, 0.2429, 0.2571, 0.2714]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.cumsum(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 0.,  1.,  2.,  3.],
        [ 4.,  6.,  8., 10.],
        [12., 15., 18., 21.],
        [24., 28., 32., 36.],
        [40., 45., 50., 55.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y=torch.ones(<span class="number">4</span>,dtype=torch.float32)</span><br><span class="line">x,y,torch.dot(x,y)</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([0., 1., 2., 3.]), tensor([1., 1., 1., 1.]), tensor(6.))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.<span class="built_in">sum</span>(x*y)</span><br></pre></td></tr></table></figure>




<pre><code>tensor(6.)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.shape,x.shape,torch.mv(A,x)</span><br></pre></td></tr></table></figure>




<pre><code>(torch.Size([5, 4]), torch.Size([4]), tensor([ 14.,  38.,  62.,  86., 110.]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">B=torch.ones(<span class="number">4</span>,<span class="number">3</span>)</span><br><span class="line">torch.mm(A,B)</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[ 6.,  6.,  6.],
        [22., 22., 22.],
        [38., 38., 38.],
        [54., 54., 54.],
        [70., 70., 70.]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u=torch.tensor([<span class="number">3.0</span>,-<span class="number">4.0</span>])</span><br><span class="line">torch.norm(u)</span><br></pre></td></tr></table></figure>




<pre><code>tensor(5.)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.<span class="built_in">abs</span>(u).<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>




<pre><code>tensor(7.)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.norm(torch.ones((<span class="number">4</span>,<span class="number">9</span>)))</span><br></pre></td></tr></table></figure>




<pre><code>tensor(6.)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x=torch.arange(<span class="number">24</span>,dtype=torch.float32).reshape((<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">x,<span class="built_in">len</span>(x)</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[[ 0.,  1.,  2.,  3.],
          [ 4.,  5.,  6.,  7.],
          [ 8.,  9., 10., 11.]],
 
         [[12., 13., 14., 15.],
          [16., 17., 18., 19.],
          [20., 21., 22., 23.]]]),
 2)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.<span class="built_in">sum</span>(axis=<span class="number">0</span>),x.<span class="built_in">sum</span>(axis=<span class="number">1</span>),x.<span class="built_in">sum</span>(axis=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([[12., 14., 16., 18.],
         [20., 22., 24., 26.],
         [28., 30., 32., 34.]]),
 tensor([[12., 15., 18., 21.],
         [48., 51., 54., 57.]]),
 tensor([[ 6., 22., 38.],
         [54., 70., 86.]]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y=torch.arange(<span class="number">120</span>,dtype=torch.float32).reshape(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">y</span><br></pre></td></tr></table></figure>




<pre><code>tensor([[[[  0.,   1.,   2.,   3.,   4.],
          [  5.,   6.,   7.,   8.,   9.],
          [ 10.,  11.,  12.,  13.,  14.],
          [ 15.,  16.,  17.,  18.,  19.]],

         [[ 20.,  21.,  22.,  23.,  24.],
          [ 25.,  26.,  27.,  28.,  29.],
          [ 30.,  31.,  32.,  33.,  34.],
          [ 35.,  36.,  37.,  38.,  39.]],

         [[ 40.,  41.,  42.,  43.,  44.],
          [ 45.,  46.,  47.,  48.,  49.],
          [ 50.,  51.,  52.,  53.,  54.],
          [ 55.,  56.,  57.,  58.,  59.]]],
</code></pre>
<p>​<br>​            [[[ 60.,  61.,  62.,  63.,  64.],<br>​              [ 65.,  66.,  67.,  68.,  69.],<br>​              [ 70.,  71.,  72.,  73.,  74.],<br>​              [ 75.,  76.,  77.,  78.,  79.]],<br>​<br>             [[ 80.,  81.,  82.,  83.,  84.],<br>              [ 85.,  86.,  87.,  88.,  89.],<br>              [ 90.,  91.,  92.,  93.,  94.],<br>              [ 95.,  96.,  97.,  98.,  99.]],</p>
<pre><code>         [[100., 101., 102., 103., 104.],
          [105., 106., 107., 108., 109.],
          [110., 111., 112., 113., 114.],
          [115., 116., 117., 118., 119.]]]])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">z=torch.linalg.norm(y)<span class="comment">#torch.linalg.norm函数可用于求解多轴张量的类L2范数，要求张量各元素数据类型为浮点数或者复数</span></span><br><span class="line"><span class="comment">#z=torch.linalg.norm(input,p,dim)</span></span><br><span class="line"><span class="comment">#input：输入张量。它的数据类型必须是浮点型或复数型。对于复数的输入，范数使用每个元素的绝对值。注意，输入张量中元素的数据类型一定得是浮点型或者是复数哦，不然就会报错！这个就是主要变化，其次是不能使用 input.norm</span></span><br><span class="line"><span class="comment">#p：范数的阶数。默认是2阶—“fro”，也就是弗罗贝尼乌斯范数（Frobenius norm）。如果输入p=某个正整数，则求解对应的p阶范数。其公式为  sum(abs(x)**p)**(1./p)。</span></span><br><span class="line"><span class="comment">#dim：对输入的张量计算其指定维度（如dim=1，则表示计算第二个维度）上所有元素的范数。如果不对dim进行赋值，则会计算输入张量所有维度上的范数。当然如果指定维数不在输入张量的尺寸之内，将出现错误。</span></span><br><span class="line">z</span><br></pre></td></tr></table></figure>




<pre><code>tensor(754.2015)
</code></pre>
<h2 id="2-4-微积分"><a href="#2-4-微积分" class="headerlink" title="2.4 微积分"></a>2.4 微积分</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib_inline <span class="keyword">import</span> backend_inline</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>*x**<span class="number">2</span>-<span class="number">4</span>*x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">numerical_lim</span>(<span class="params">f,x,h</span>):</span><br><span class="line">    <span class="keyword">return</span> (f(x+h)-f(x))/h</span><br><span class="line"></span><br><span class="line">h=<span class="number">0.1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;h=<span class="subst">&#123;h:<span class="number">.5</span>f&#125;</span>,numerical limit=<span class="subst">&#123;numerical_lim(f,<span class="number">1</span>,h):<span class="number">.5</span>f&#125;</span>&#x27;</span>)</span><br><span class="line">    h*=<span class="number">0.1</span></span><br></pre></td></tr></table></figure>

<pre><code>h=0.10000,numerical limit=2.30000
h=0.01000,numerical limit=2.03000
h=0.00100,numerical limit=2.00300
h=0.00010,numerical limit=2.00030
h=0.00001,numerical limit=2.00003
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#三个用于图形配置的函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">use_svg_display</span>():   <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">##@save标记可将对应函数/类/语句保存在d2l包中，以后无需定义就可以直接调用；e.g:d2l.use_svg_display()</span></span><br><span class="line">    <span class="comment">#使用svg格式在Jupyter中显示绘图</span></span><br><span class="line">    backend_inline.set_matplotlib_formats(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_figsize</span>(<span class="params">figsize=(<span class="params"><span class="number">3.5</span>,<span class="number">2.5</span></span>)</span>):   <span class="comment">#@save</span></span><br><span class="line">    <span class="comment">#设置matplotlib的图表大小</span></span><br><span class="line">    use_svg_display()</span><br><span class="line">    d2l.plt.rcParams[<span class="string">&#x27;figure.figsize&#x27;</span>]=figsize</span><br><span class="line">    </span><br><span class="line"><span class="comment">#@save</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_axes</span>(<span class="params">axes,xlabel,ylabel,xlim,ylim,xscale,yscale,legend</span>):</span><br><span class="line">    <span class="comment">#设置matplotlib的轴</span></span><br><span class="line">    axes.set_xlabel(xlabel)</span><br><span class="line">    axes.set_ylabel(ylabel)</span><br><span class="line">    axes.set_xscale(xscale)</span><br><span class="line">    axes.set_yscale(yscale)</span><br><span class="line">    axes.set_xlim(xlim)</span><br><span class="line">    axes.set_ylim(ylim)</span><br><span class="line">    <span class="keyword">if</span> legend:</span><br><span class="line">        axes.legend(legend)</span><br><span class="line">    axes.grid()</span><br><span class="line">    </span><br><span class="line"><span class="comment">#plot函数：可绘制多条曲线</span></span><br><span class="line"><span class="comment">#@save</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">plot</span>(<span class="params">X,Y=<span class="literal">None</span>,xlabel=<span class="literal">None</span>,ylabel=<span class="literal">None</span>,legend=<span class="literal">None</span>,xlim=<span class="literal">None</span>,ylim=<span class="literal">None</span>,xscale=<span class="string">&#x27;linear&#x27;</span>,yscale=<span class="string">&#x27;linear&#x27;</span>,fmts=(<span class="params"><span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;m--&#x27;</span>,<span class="string">&#x27;g-.&#x27;</span>,<span class="string">&#x27;r:&#x27;</span></span>),figsize=(<span class="params"><span class="number">3.5</span>,<span class="number">2.5</span></span>),axes=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment">#绘制数据点</span></span><br><span class="line">    <span class="keyword">if</span> legend <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        legend=[]</span><br><span class="line"></span><br><span class="line">    set_figsize(figsize)</span><br><span class="line">    axes=axes <span class="keyword">if</span> axes <span class="keyword">else</span> d2l.plt.gca()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#如果X有一个轴，输出True</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_one_axis</span>(<span class="params">X</span>):</span><br><span class="line">        <span class="keyword">return</span>(<span class="built_in">hasattr</span>(X,<span class="string">&quot;ndim&quot;</span>) <span class="keyword">and</span> X.ndim==<span class="number">1</span> <span class="keyword">or</span> <span class="built_in">isinstance</span>(X,<span class="built_in">list</span>) <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(X[<span class="number">0</span>],<span class="string">&quot;__len__&quot;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> has_one_axis(X):</span><br><span class="line">        X=[X]</span><br><span class="line">    <span class="keyword">if</span> Y <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        X,Y=[[]]*<span class="built_in">len</span>(X),X</span><br><span class="line">    <span class="keyword">elif</span> has_one_axis(Y):</span><br><span class="line">        X=X*<span class="built_in">len</span>(Y)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(X)!=<span class="built_in">len</span>(Y):</span><br><span class="line">        X=X*<span class="built_in">len</span>(Y)</span><br><span class="line">    axes.cla()</span><br><span class="line">    <span class="keyword">for</span> x,y,fmt <span class="keyword">in</span> <span class="built_in">zip</span>(X,Y,fmts):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x):</span><br><span class="line">            axes.plot(x,y,fmt)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            axes.plot(y,fmt)</span><br><span class="line">    set_axes(axes,xlabel,ylabel,xlim,ylim,xscale,yscale,legend)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x=np.arange(<span class="number">0</span>,<span class="number">3</span>,<span class="number">0.1</span>)</span><br><span class="line">plot(x,[f(x),<span class="number">2</span>*x-<span class="number">3</span>],<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;f(x)&#x27;</span>,legend=[<span class="string">&#x27;f(x)&#x27;</span>,<span class="string">&#x27;Tangent line(x=1)&#x27;</span>])</span><br></pre></td></tr></table></figure>


<p>​<br><img src="/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86_files/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86_78_0.svg" alt="svg"><br>​    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x**<span class="number">3</span>-(<span class="number">1</span>/x)</span><br><span class="line">plot(x,[g(x),<span class="number">4</span>*x-<span class="number">4</span>],<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;g(x)&#x27;</span>,legend=[<span class="string">&#x27;g(x)&#x27;</span>,<span class="string">&#x27;Tangent line(x=1)&#x27;</span>])</span><br></pre></td></tr></table></figure>

<pre><code>F:\user\Temp\ipykernel_25528\1423519574.py:2: RuntimeWarning: divide by zero encountered in true_divide
  return x**3-(1/x)
</code></pre>
<p><img src="/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86_files/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86_79_1.svg" alt="svg"></p>
<h2 id="2-5-自动微分"><a href="#2-5-自动微分" class="headerlink" title="2.5 自动微分"></a>2.5 自动微分</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">x=torch.arange(<span class="number">4.0</span>)</span><br><span class="line">x</span><br></pre></td></tr></table></figure>




<pre><code>tensor([0., 1., 2., 3.])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y=<span class="number">2</span>*torch.dot(x,x)</span><br><span class="line">y</span><br></pre></td></tr></table></figure>




<pre><code>tensor(28.)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x.requires_grad_(<span class="literal">True</span>) <span class="comment">#等价于x=torch.arange(4.0,requires_grad=True)</span></span><br><span class="line">x.grad <span class="comment">#默认值为None</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y=<span class="number">2</span>*torch.dot(x,x)</span><br><span class="line">y</span><br></pre></td></tr></table></figure>




<pre><code>tensor(28., grad_fn=&lt;MulBackward0&gt;)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y.backward()<span class="comment">#通过调用反向传播函数自动计算y关于x每个分量的梯度</span></span><br><span class="line">x.grad</span><br></pre></td></tr></table></figure>




<pre><code>tensor([ 0.,  4.,  8., 12.])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.grad==<span class="number">4</span>*x</span><br></pre></td></tr></table></figure>




<pre><code>tensor([True, True, True, True])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x.grad.zero_()<span class="comment">#在默认情况下，PyTorch会累积梯度，我们需要清除之前的值</span></span><br><span class="line"></span><br><span class="line">y=x.<span class="built_in">sum</span>()</span><br><span class="line">y.backward()</span><br><span class="line">x.grad</span><br></pre></td></tr></table></figure>




<pre><code>tensor([1., 1., 1., 1.])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#对非标量变量：不计算微分矩阵，而是单独计算批量中每个样本的偏导数之和</span></span><br><span class="line"><span class="comment">#对[非标量]调用backward需要传入一个gradient参数，该参数指定微分函数关于self的梯度</span></span><br><span class="line">x.grad.zero_()</span><br><span class="line">y=x*x</span><br><span class="line">y.<span class="built_in">sum</span>().backward()<span class="comment">#等价于y.backward(torch.ones(len(x)))——传递1的梯度合适：只求偏导数的和</span></span><br><span class="line">y,x.grad</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([0., 1., 4., 9.], grad_fn=&lt;MulBackward0&gt;), tensor([0., 2., 4., 6.]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x.grad.zero_()</span><br><span class="line">y=x*x</span><br><span class="line">u=y.detach()<span class="comment">#分离变量（复制副本，保留计算结果，后续处理的u不带有y除数值外的其他性质）</span></span><br><span class="line">z=u*x</span><br><span class="line"></span><br><span class="line">z.<span class="built_in">sum</span>().backward()</span><br><span class="line">x.grad==u</span><br></pre></td></tr></table></figure>




<pre><code>tensor([True, True, True, True])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x.grad.zero_()</span><br><span class="line">y.<span class="built_in">sum</span>().backward()</span><br><span class="line">x.grad==<span class="number">2</span>*x</span><br></pre></td></tr></table></figure>




<pre><code>tensor([True, True, True, True])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">a</span>):</span><br><span class="line">    b=a*<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> b.norm()&lt;<span class="number">1000</span>:</span><br><span class="line">        b=b*<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> b.<span class="built_in">sum</span>()&gt;<span class="number">0</span>:</span><br><span class="line">        c=b</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c=<span class="number">100</span>*b</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">a=torch.randn(size=(),requires_grad=<span class="literal">True</span>)</span><br><span class="line">d=f(a)</span><br><span class="line">d.backward()<span class="comment">#注意：运行backward函数会自动清除计算图；但可通过在第一次backward中加一句retain_grad=True，即d.backward(retain_graph=True)，意思为一直保留计算图</span></span><br><span class="line"></span><br><span class="line">a,d,a.grad==d/a,a.grad</span><br></pre></td></tr></table></figure>




<pre><code>(tensor(0.1050, requires_grad=True),
 tensor(1719.5204, grad_fn=&lt;MulBackward0&gt;),
 tensor(True),
 tensor(16384.))
</code></pre>
<h2 id="2-6-概率"><a href="#2-6-概率" class="headerlink" title="2.6 概率"></a>2.6 概率</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.distributions <span class="keyword">import</span> multinomial<span class="comment">#multinomial 多项分布</span></span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">fair_probs=torch.ones([<span class="number">6</span>])/<span class="number">6</span></span><br><span class="line">fair_probs,multinomial.Multinomial(<span class="number">1</span>,fair_probs).sample()</span><br></pre></td></tr></table></figure>




<pre><code>(tensor([0.1667, 0.1667, 0.1667, 0.1667, 0.1667, 0.1667]),
 tensor([0., 0., 0., 0., 1., 0.]))
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">multinomial.Multinomial(<span class="number">10</span>,fair_probs).sample()</span><br></pre></td></tr></table></figure>




<pre><code>tensor([2., 0., 1., 3., 1., 3.])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">counts=multinomial.Multinomial(<span class="number">1000</span>,fair_probs).sample()<span class="comment">#将结果储存为float32以进行除法</span></span><br><span class="line">counts/<span class="number">1000</span><span class="comment">#相对频率作为估计值</span></span><br></pre></td></tr></table></figure>




<pre><code>tensor([0.1640, 0.1610, 0.1720, 0.1730, 0.1610, 0.1690])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">counts=multinomial.Multinomial(<span class="number">10</span>,fair_probs).sample((<span class="number">500</span>,))</span><br><span class="line">cum_counts=counts.cumsum(dim=<span class="number">0</span>)<span class="comment">#cumsum:累加函数</span></span><br><span class="line">estimates=cum_counts/cum_counts.<span class="built_in">sum</span>(dim=<span class="number">1</span>,keepdims=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">d2l.set_figsize((<span class="number">6</span>,<span class="number">4.5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    d2l.plt.plot(estimates[:,i].numpy(),label=(<span class="string">&quot;P(die=&quot;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>)+<span class="string">&quot;)&quot;</span>))</span><br><span class="line">d2l.plt.axhline(y=<span class="number">0.167</span>,color=<span class="string">&#x27;black&#x27;</span>,linestyle=<span class="string">&#x27;dashed&#x27;</span>)</span><br><span class="line">d2l.plt.gca().set_xlabel(<span class="string">&#x27;Groups of experiments&#x27;</span>)</span><br><span class="line">d2l.plt.gca().set_ylabel(<span class="string">&#x27;Estimated probability&#x27;</span>)</span><br><span class="line">d2l.plt.legend();</span><br></pre></td></tr></table></figure>


<p>​<br><img src="/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86_files/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86_96_0.svg" alt="svg"><br>​    </p>
<h2 id="2-7-查阅文档"><a href="#2-7-查阅文档" class="headerlink" title="2.7 查阅文档"></a>2.7 查阅文档</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(torch.distributions))</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;AbsTransform&#39;, &#39;AffineTransform&#39;, &#39;Bernoulli&#39;, &#39;Beta&#39;, &#39;Binomial&#39;, &#39;CatTransform&#39;, &#39;Categorical&#39;, &#39;Cauchy&#39;, &#39;Chi2&#39;, &#39;ComposeTransform&#39;, &#39;ContinuousBernoulli&#39;, &#39;CorrCholeskyTransform&#39;, &#39;CumulativeDistributionTransform&#39;, &#39;Dirichlet&#39;, &#39;Distribution&#39;, &#39;ExpTransform&#39;, &#39;Exponential&#39;, &#39;ExponentialFamily&#39;, &#39;FisherSnedecor&#39;, &#39;Gamma&#39;, &#39;Geometric&#39;, &#39;Gumbel&#39;, &#39;HalfCauchy&#39;, &#39;HalfNormal&#39;, &#39;Independent&#39;, &#39;IndependentTransform&#39;, &#39;Kumaraswamy&#39;, &#39;LKJCholesky&#39;, &#39;Laplace&#39;, &#39;LogNormal&#39;, &#39;LogisticNormal&#39;, &#39;LowRankMultivariateNormal&#39;, &#39;LowerCholeskyTransform&#39;, &#39;MixtureSameFamily&#39;, &#39;Multinomial&#39;, &#39;MultivariateNormal&#39;, &#39;NegativeBinomial&#39;, &#39;Normal&#39;, &#39;OneHotCategorical&#39;, &#39;OneHotCategoricalStraightThrough&#39;, &#39;Pareto&#39;, &#39;Poisson&#39;, &#39;PowerTransform&#39;, &#39;RelaxedBernoulli&#39;, &#39;RelaxedOneHotCategorical&#39;, &#39;ReshapeTransform&#39;, &#39;SigmoidTransform&#39;, &#39;SoftmaxTransform&#39;, &#39;SoftplusTransform&#39;, &#39;StackTransform&#39;, &#39;StickBreakingTransform&#39;, &#39;StudentT&#39;, &#39;TanhTransform&#39;, &#39;Transform&#39;, &#39;TransformedDistribution&#39;, &#39;Uniform&#39;, &#39;VonMises&#39;, &#39;Weibull&#39;, &#39;Wishart&#39;, &#39;__all__&#39;, &#39;__builtins__&#39;, &#39;__cached__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__loader__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__path__&#39;, &#39;__spec__&#39;, &#39;bernoulli&#39;, &#39;beta&#39;, &#39;biject_to&#39;, &#39;binomial&#39;, &#39;categorical&#39;, &#39;cauchy&#39;, &#39;chi2&#39;, &#39;constraint_registry&#39;, &#39;constraints&#39;, &#39;continuous_bernoulli&#39;, &#39;dirichlet&#39;, &#39;distribution&#39;, &#39;exp_family&#39;, &#39;exponential&#39;, &#39;fishersnedecor&#39;, &#39;gamma&#39;, &#39;geometric&#39;, &#39;gumbel&#39;, &#39;half_cauchy&#39;, &#39;half_normal&#39;, &#39;identity_transform&#39;, &#39;independent&#39;, &#39;kl&#39;, &#39;kl_divergence&#39;, &#39;kumaraswamy&#39;, &#39;laplace&#39;, &#39;lkj_cholesky&#39;, &#39;log_normal&#39;, &#39;logistic_normal&#39;, &#39;lowrank_multivariate_normal&#39;, &#39;mixture_same_family&#39;, &#39;multinomial&#39;, &#39;multivariate_normal&#39;, &#39;negative_binomial&#39;, &#39;normal&#39;, &#39;one_hot_categorical&#39;, &#39;pareto&#39;, &#39;poisson&#39;, &#39;register_kl&#39;, &#39;relaxed_bernoulli&#39;, &#39;relaxed_categorical&#39;, &#39;studentT&#39;, &#39;transform_to&#39;, &#39;transformed_distribution&#39;, &#39;transforms&#39;, &#39;uniform&#39;, &#39;utils&#39;, &#39;von_mises&#39;, &#39;weibull&#39;, &#39;wishart&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span>(torch.ones)</span><br></pre></td></tr></table></figure>

<pre><code>Help on built-in function ones in module torch:

ones(...)
    ones(*size, *, out=None, dtype=None, layout=torch.strided, device=None, requires_grad=False) -&gt; Tensor
    
    Returns a tensor filled with the scalar value `1`, with the shape defined
    by the variable argument :attr:`size`.
    
    Args:
        size (int...): a sequence of integers defining the shape of the output tensor.
            Can be a variable number of arguments or a collection like a list or tuple.
    
    Keyword arguments:
        out (Tensor, optional): the output tensor.
        dtype (:class:`torch.dtype`, optional): the desired data type of returned tensor.
            Default: if ``None``, uses a global default (see :func:`torch.set_default_tensor_type`).
        layout (:class:`torch.layout`, optional): the desired layout of returned Tensor.
            Default: ``torch.strided``.
        device (:class:`torch.device`, optional): the desired device of returned tensor.
            Default: if ``None``, uses the current device for the default tensor type
            (see :func:`torch.set_default_tensor_type`). :attr:`device` will be the CPU
            for CPU tensor types and the current CUDA device for CUDA tensor types.
        requires_grad (bool, optional): If autograd should record operations on the
            returned tensor. Default: ``False``.
    
    Example::
    
        &gt;&gt;&gt; torch.ones(2, 3)
        tensor([[ 1.,  1.,  1.],
                [ 1.,  1.,  1.]])
    
        &gt;&gt;&gt; torch.ones(5)
        tensor([ 1.,  1.,  1.,  1.,  1.])
</code></pre>
<p>​    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.ones(<span class="number">4</span>)</span><br></pre></td></tr></table></figure>




<pre><code>tensor([1., 1., 1., 1.])
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span>?</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span>(<span class="built_in">list</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Help on class list in module builtins:

class list(object)
 |  list(iterable=(), /)
 |  
 |  Built-in mutable sequence.
 |  
 |  If no argument is given, the constructor creates a new empty list.
 |  The argument must be an iterable if specified.
 |  
 |  Methods defined here:
 |  
 |  __add__(self, value, /)
 |      Return self+value.
 |  
 |  __contains__(self, key, /)
 |      Return key in self.
 |  
 |  __delitem__(self, key, /)
 |      Delete self[key].
 |  
 |  __eq__(self, value, /)
 |      Return self==value.
 |  
 |  __ge__(self, value, /)
 |      Return self&gt;=value.
 |  
 |  __getattribute__(self, name, /)
 |      Return getattr(self, name).
 |  
 |  __getitem__(...)
 |      x.__getitem__(y) &lt;==&gt; x[y]
 |  
 |  __gt__(self, value, /)
 |      Return self&gt;value.
 |  
 |  __iadd__(self, value, /)
 |      Implement self+=value.
 |  
 |  __imul__(self, value, /)
 |      Implement self*=value.
 |  
 |  __init__(self, /, *args, **kwargs)
 |      Initialize self.  See help(type(self)) for accurate signature.
 |  
 |  __iter__(self, /)
 |      Implement iter(self).
 |  
 |  __le__(self, value, /)
 |      Return self&lt;=value.
 |  
 |  __len__(self, /)
 |      Return len(self).
 |  
 |  __lt__(self, value, /)
 |      Return self&lt;value.
 |  
 |  __mul__(self, value, /)
 |      Return self*value.
 |  
 |  __ne__(self, value, /)
 |      Return self!=value.
 |  
 |  __repr__(self, /)
 |      Return repr(self).
 |  
 |  __reversed__(self, /)
 |      Return a reverse iterator over the list.
 |  
 |  __rmul__(self, value, /)
 |      Return value*self.
 |  
 |  __setitem__(self, key, value, /)
 |      Set self[key] to value.
 |  
 |  __sizeof__(self, /)
 |      Return the size of the list in memory, in bytes.
 |  
 |  append(self, object, /)
 |      Append object to the end of the list.
 |  
 |  clear(self, /)
 |      Remove all items from list.
 |  
 |  copy(self, /)
 |      Return a shallow copy of the list.
 |  
 |  count(self, value, /)
 |      Return number of occurrences of value.
 |  
 |  extend(self, iterable, /)
 |      Extend list by appending elements from the iterable.
 |  
 |  index(self, value, start=0, stop=9223372036854775807, /)
 |      Return first index of value.
 |      
 |      Raises ValueError if the value is not present.
 |  
 |  insert(self, index, object, /)
 |      Insert object before index.
 |  
 |  pop(self, index=-1, /)
 |      Remove and return item at index (default last).
 |      
 |      Raises IndexError if list is empty or index is out of range.
 |  
 |  remove(self, value, /)
 |      Remove first occurrence of value.
 |      
 |      Raises ValueError if the value is not present.
 |  
 |  reverse(self, /)
 |      Reverse *IN PLACE*.
 |  
 |  sort(self, /, *, key=None, reverse=False)
 |      Sort the list in ascending order and return None.
 |      
 |      The sort is in-place (i.e. the list itself is modified) and stable (i.e. the
 |      order of two equal elements is maintained).
 |      
 |      If a key function is given, apply it once to each list item and sort them,
 |      ascending or descending, according to their function values.
 |      
 |      The reverse flag can be set to sort in descending order.
 |  
 |  ----------------------------------------------------------------------
 |  Class methods defined here:
 |  
 |  __class_getitem__(...) from builtins.type
 |      See PEP 585
 |  
 |  ----------------------------------------------------------------------
 |  Static methods defined here:
 |  
 |  __new__(*args, **kwargs) from builtins.type
 |      Create and return a new object.  See help(type) for accurate signature.
 |  
 |  ----------------------------------------------------------------------
 |  Data and other attributes defined here:
 |  
 |  __hash__ = None
</code></pre>
<p>​    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span>??</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2023/07/05/20230705/"><img class="fill" src="/images/story/1.jpg" alt="20230705"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-07-05T01:43:03.000Z" title="2023/7/5 09:43:03">2023-07-05</time>发表</span><span class="level-item"><time dateTime="2023-08-04T03:12:11.472Z" title="2023/8/4 11:12:11">2023-08-04</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/About-XJH/">About XJH</a><span> / </span><a class="link-muted" href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/">碎碎念</a><span> / </span><a class="link-muted" href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/CQU/">CQU</a></span><span class="level-item">2 分钟读完 (大约263个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/05/20230705/">20230705</a></p><div class="content"><p>“不论事情是对是错，在做之前，先考虑最坏的后果。这不是让你们当一个悲观主义者，而是要把乐观与悲观相结合。”<br>他嘴很笨，可最质朴的语言却说出了那么多人不曾了解的真理。<br>倏忽之间，我们也终要脱下这身军装，回到各自的人生。或许彼此的相遇就是意外，可我们也走过了这么多的烈日炎炎和风吹雨打。彼此包容，互相理解，通力合作，我们携手共度，也曾历经磕磕绊绊，共同冲向同一个终点，然后四散奔赴各自的山河。那些年少轻狂和叛逆愤懑，都随着那一声解散而烟消云散。<br>可你不再是你，我也不再是我。我们都在这场洗礼中，迎来了属于我们自己的成长。<br>再见，不负遇见。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2023/07/03/20230703/"><img class="fill" src="/images/story/2.jpg" alt="20230703"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-07-03T08:37:03.000Z" title="2023/7/3 16:37:03">2023-07-03</time>发表</span><span class="level-item"><time dateTime="2023-08-04T03:12:20.637Z" title="2023/8/4 11:12:20">2023-08-04</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/About-XJH/">About XJH</a><span> / </span><a class="link-muted" href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/">碎碎念</a><span> / </span><a class="link-muted" href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/CQU/">CQU</a></span><span class="level-item">1 分钟读完 (大约114个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/03/20230703/">20230703</a></p><div class="content"><p>那一声慷慨激昂的散<br>抚平了所有的烦躁与不安<br>好像也不是那么讨厌下雨天了<br>因为雨后总会天晴<br>可不知道为什么<br>那些浅显的至理却会因为对立而变得如此刺耳<br>等到回想起来<br>那些廉价的愤懑似乎都不值一提<br>或许<br>这里真的是家<br>但烈日下的我们<br>却无时不刻不想着逃离。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-07-02T13:42:58.000Z" title="2023/7/2 21:42:58">2023-07-02</time>发表</span><span class="level-item"><time dateTime="2023-08-03T09:19:10.851Z" title="2023/8/3 17:19:10">2023-08-03</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a><span> / </span><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/">软件设计</a></span><span class="level-item">19 分钟读完 (大约2891个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/02/ROS%20Task/">基于ROS（机器人操作系统）的数据展示系统</a></p><div class="content"><p><em>tips</em>:请在使用该系统前安装好相应的库文件（详见附录二），并在不同控制台分别运行roscore（ros操作系统内核）、rosbag play –loop –pause all.bag（ros数据包展示）和rosrun gmapping slam_gmapping（任务四建图处理进程）</p>
<p>该系统程序名为final_system，使用以下命令克隆git仓库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Asgard-Tim/ROS-Coding.git</span><br></pre></td></tr></table></figure>

<p>安装好相关库文件后可通过以下命令运行系统程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//项目构建</span><br><span class="line"></span><br><span class="line">cd /home/ubuntu/project/catkin_ws</span><br><span class="line"></span><br><span class="line">catkin_make</span><br><span class="line"></span><br><span class="line">//程序运行</span><br><span class="line"></span><br><span class="line">source /home/ubuntu/project/catkin_ws/devel/setup.bash</span><br><span class="line"></span><br><span class="line">cd /home/ubuntu/project/catkin_ws</span><br><span class="line"></span><br><span class="line">rosrun final_system final_system</span><br></pre></td></tr></table></figure>

<p>完整代码已上传至Github平台，URL地址：<a target="_blank" rel="noopener" href="https://github.com/Asgard-Tim/ROS-Coding">Asgard-Tim&#x2F;ROS-Coding: 重庆大学明月科创实验班软件设计课程作业 (github.com)</a></p>
<p>Bilibili同步上传系统演示视频Demo，链接：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1YV411M7jj/?vd_source=9360c83a7f1073e99c67f3821a48fb8c">重庆大学明月科创实验班软件设计作业–ROS数据展示系统_哔哩哔哩_bilibili</a></p>
<h4 id="程序主要结构与算法分析"><a href="#程序主要结构与算法分析" class="headerlink" title="程序主要结构与算法分析"></a><strong>程序主要结构与算法分析</strong></h4><p>在**main()**函数中：</p>
<ul>
<li><p>创建ROS节点和节点句柄。</p>
</li>
<li><p>调用**initialize()**函数显示初始菜单:提示用户选择登录、注册或退出系统。</p>
</li>
<li><p>定义一个<strong>user</strong>类，用于保存用户的用户名和密码信息;根据用户选择执行不同的操作：</p>
</li>
<li><ul>
<li>登录：要求用户输入用户名和密码，然后检查是否匹配存储在文件中的用户信息。</li>
<li>注册：要求用户输入新的用户名和密码，然后将用户信息保存到文件中。</li>
<li>退出系统：结束程序运行。</li>
</ul>
</li>
<li><p>如果登录成功，调用**systeminitialize()**函数显示登录成功后的菜单:提示用户选择不同的数据可视化选项或退出系统。</p>
</li>
<li><p>根据用户选择执行不同的数据可视化操作：</p>
</li>
</ul>
<h5 id="任务一：用命令行窗口显示小车的IMU和里程计（odometry）数据"><a href="#任务一：用命令行窗口显示小车的IMU和里程计（odometry）数据" class="headerlink" title="任务一：用命令行窗口显示小车的IMU和里程计（odometry）数据"></a><strong><u>任务一：用命令行窗口显示小车的IMU和里程计（odometry）数据</u></strong></h5><ul>
<li><ul>
<li><p>IMU数据：订阅IMU数据的ROS话题，将数据传递给回调函数<strong>callback1</strong>进行处理。</p>
</li>
<li><p>回调函数<strong>callback1</strong>，处理IMU数据：</p>
</li>
<li><ul>
<li>从接收到的IMU消息中获取线性加速度和角速度信息。</li>
<li>使用<strong>std::cout</strong>打印出线性加速度和角速度信息。</li>
</ul>
</li>
<li><p>里程计数据：订阅里程计数据的ROS话题，将数据传递给回调函数<strong>callback2</strong>进行处理。</p>
</li>
<li><p>回调函数<strong>callback2</strong>，处理里程计数据：</p>
</li>
<li><ul>
<li>从接收到的里程计消息中获取位置和姿态信息。</li>
<li>使用<strong>std::cout</strong>打印出位置和姿态信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="任务二：用图形界面显示颜色相机和深度相机的数据（利用OpenCV库）"><a href="#任务二：用图形界面显示颜色相机和深度相机的数据（利用OpenCV库）" class="headerlink" title="任务二：用图形界面显示颜色相机和深度相机的数据（利用OpenCV库）"></a><strong><u>任务二：用图形界面显示颜色相机和深度相机的数据（利用OpenCV库）</u></strong></h5><ul>
<li><ul>
<li><p>颜色相机数据：订阅颜色相机数据的ROS话题，将数据传递给回调函数<strong>callback3</strong>进行处理。</p>
</li>
<li><p>回调函数<strong>callback3</strong>，处理颜色相机数据：</p>
</li>
<li><ul>
<li>将接收到的彩色图像消息转换为OpenCV的图像格式。</li>
<li>使用OpenCV的窗口显示彩色图像。</li>
</ul>
</li>
<li><p>深度相机数据：订阅深度相机数据的ROS话题，将数据传递给回调函数<strong>callback4</strong>进行处理。</p>
</li>
<li><p>回调函数<strong>callback4</strong>，处理深度相机数据：</p>
</li>
<li><ul>
<li>将接收到的深度图像消息转换为OpenCV的图像格式。</li>
<li>使用OpenCV的窗口显示深度图像。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="任务三：用图形界面显示激光雷达的点云数据（利用PCL库）"><a href="#任务三：用图形界面显示激光雷达的点云数据（利用PCL库）" class="headerlink" title="任务三：用图形界面显示激光雷达的点云数据（利用PCL库）"></a><strong><u>任务三：用图形界面显示激光雷达的点云数据（利用PCL库）</u></strong></h5><ul>
<li><ul>
<li><p>点云数据：订阅点云数据的ROS话题，将数据传递给回调函数<strong>callback5</strong>进行处理。</p>
</li>
<li><p>**pcl::visualization::CloudViewer viewer(“Cloud      Viewer”);**：创建一个PCL点云可视化器。</p>
</li>
<li><p>回调函数<strong>callback5</strong>，处理点云数据：</p>
</li>
<li><ul>
<li>将接收到的点云消息转换为PCL的点云格式。</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>使用PCL的可视化器显示点云。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="任务四：自行选择一种高级算法（例如语义分割、三维重建、导航定位（SLAM）等），实现该算法（可以直接利用第三方库），将其集成到系统中"><a href="#任务四：自行选择一种高级算法（例如语义分割、三维重建、导航定位（SLAM）等），实现该算法（可以直接利用第三方库），将其集成到系统中" class="headerlink" title="任务四：自行选择一种高级算法（例如语义分割、三维重建、导航定位（SLAM）等），实现该算法（可以直接利用第三方库），将其集成到系统中"></a><strong><u>任务四：自行选择一种高级算法（例如语义分割、三维重建、导航定位（SLAM）等），实现该算法（可以直接利用第三方库），将其集成到系统中</u></strong></h5><ul>
<li><ul>
<li><strong>选择Gmapping算法（一个基于2D激光雷达使用RBPF（Rao-Blackwellized Particle Filters）算法完成二维栅格地图构建的SLAM算法）</strong></li>
<li>占据栅格地图数据：订阅占据栅格地图数据的ROS话题，将数据传递给回调函数<strong>callback6</strong>进行处理。</li>
<li>回调函数<strong>callback6</strong>，处理占据栅格地图数据：</li>
<li><ul>
<li><ul>
<li>从接收到的占据栅格地图消息中获取分辨率、宽度和高度等信息。</li>
<li>创建一个OpenCV的图像对象，用于绘制地图。</li>
<li>遍历地图的每个栅格，根据栅格的值绘制不同的颜色圆点。</li>
<li>使用OpenCV的窗口显示地图。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="各功能部分构建过程与实现效果"><a href="#各功能部分构建过程与实现效果" class="headerlink" title="各功能部分构建过程与实现效果"></a><strong>各功能部分构建过程与实现效果</strong></h4><h5 id="1-系统界面"><a href="#1-系统界面" class="headerlink" title="1.系统界面"></a>1.系统界面</h5><h6 id="（1）登录界面"><a href="#（1）登录界面" class="headerlink" title="（1）登录界面"></a>（1）登录界面</h6><p><img src="/images/1.png" alt="1"></p>
<h6 id="（2）功能选择界面"><a href="#（2）功能选择界面" class="headerlink" title="（2）功能选择界面"></a>（2）功能选择界面</h6><p><img src="/images/2.png" alt="2"></p>
<h5 id="2-各部分功能"><a href="#2-各部分功能" class="headerlink" title="2.各部分功能"></a>2.各部分功能</h5><p>整体架构思路（以imu数据显示为例，其余任务基本一致）：</p>
<p>（1）在运行rosbag后利用rostopic list指令查看当前开放的所有话题</p>
<p><img src="/images/3.png" alt="3"></p>
<p>（2）找到所需数据所对应的话题（如imu数据对应的是&#x2F;imu&#x2F;data_raw这一topic)，利用rostopic info指令查看其消息类型(如图中Type所示)</p>
<p><img src="/images/4.png" alt="4"></p>
<p>（3）根据获得的消息类型（如上图Type所示应为sensor_msg&#x2F;Imu),利用rosmsg show指令查看其对应的各部分数据类型</p>
<p><img src="/images/5.png" alt="5"></p>
<p>（4）根据获得的数据类型，编写对应callback函数展示对应数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">void callback1(const sensor_msgs::Imu::ConstPtr&amp; ptr)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;std_msgs/Header header&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    uint32 seq: &quot; &lt;&lt; ptr-&gt;header.seq &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    time stamp: &quot; &lt;&lt; ptr-&gt;header.stamp &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    string frame_id: &quot; &lt;&lt; ptr-&gt;header.frame_id &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;geometry_msgs/Quaternion orientation&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 x: &quot; &lt;&lt; ptr-&gt;orientation.x &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 y: &quot; &lt;&lt; ptr-&gt;orientation.y &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 z: &quot; &lt;&lt; ptr-&gt;orientation.z &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 w: &quot; &lt;&lt; ptr-&gt;orientation.w &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;float64[9] orientation_covariance&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    &quot;;</span><br><span class="line">    for (int i = 0; i &lt; 9; i++) &#123;</span><br><span class="line">        cout &lt;&lt; ptr-&gt;orientation_covariance[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;geometry_msgs/Vector3 angular_velocity&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 x: &quot; &lt;&lt; ptr-&gt;angular_velocity.x &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 y: &quot; &lt;&lt; ptr-&gt;angular_velocity.y &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 z: &quot; &lt;&lt; ptr-&gt;angular_velocity.z &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;float64[9] angular_velocity_covariance&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    &quot;;</span><br><span class="line">    for (int i = 0; i &lt; 9; i++) &#123;</span><br><span class="line">        cout &lt;&lt; ptr-&gt;angular_velocity_covariance[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;geometry_msgs/Vector3 linear_acceleration&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 x: &quot; &lt;&lt; ptr-&gt;linear_acceleration.x &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 y: &quot; &lt;&lt; ptr-&gt;linear_acceleration.y &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    float64 z: &quot; &lt;&lt; ptr-&gt;linear_acceleration.z &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;float64[9] linear_acceleration_covariance&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;    &quot;;</span><br><span class="line">    for (int i = 0; i &lt; 9; i++) &#123;</span><br><span class="line">        cout &lt;&lt; ptr-&gt;linear_acceleration_covariance[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;-------------------------------------------------------------&quot; &lt;&lt; endl;</span><br><span class="line">    return ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（5）编写主函数程序建立订阅者节点订阅话题内容，并调用对应callback函数进行数据处理与显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ros::init(argc, argv, &quot;imu&quot;);</span><br><span class="line"></span><br><span class="line">ros::NodeHandle nodeHandle;</span><br><span class="line"></span><br><span class="line">ros::Subscriber subscriber = nodeHandle.subscribe(&quot;/imu/data_raw&quot;, 1000, callback1);</span><br><span class="line"></span><br><span class="line">ros::spin();</span><br></pre></td></tr></table></figure>

<p>注意：在任务二、三中，对应的callback函数需要分别调用opencv和pcl库，将读取的数据进行处理，以可视化图形界面的形式显示出来。</p>
<p>这里以任务三为例展示如何使用库文件进行数据处理并进行图形化界面显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">void callback5(const sensor_msgs::PointCloud2::ConstPtr&amp; msg)</span><br><span class="line">&#123;</span><br><span class="line">    pcl::PointCloud&lt;pcl::PointXYZ&gt; cloud;  </span><br><span class="line">    // 创建一个存储PointXYZ类型点云数据的PointCloud对象，每个点有三个坐标值</span><br><span class="line">    pcl::PCLPointCloud2 pcl_pc;  </span><br><span class="line">    // 创建一个PCLPointCloud2对象，用于存储传感器消息中的点云数据</span><br><span class="line">    pcl_conversions::toPCL(*msg, pcl_pc);  </span><br><span class="line">    // 将ROS中的sensor_msgs::PointCloud2类型消息转换为PCL中的PCLPointCloud2类型</span><br><span class="line">    pcl::fromPCLPointCloud2(pcl_pc, cloud); </span><br><span class="line">    // 将PCLPointCloud2类型转换为PointCloud&lt;pcl::PointXYZ&gt;类型</span><br><span class="line">    viewer.showCloud(cloud.makeShared());  // 在可视化窗口中显示点云数据</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终各部分功能实现的效果图如下：</p>
<p>（1）展示imu数据</p>
<p><img src="/images/6.png" alt="6"></p>
<p>（2）展示里程计数据</p>
<p><img src="/images/7.png" alt="7"></p>
<p>（3）展示颜色相机数据</p>
<p><img src="/images/8.png" alt="8"></p>
<p>（4）展示深度相机数据</p>
<p><img src="/images/9.png" alt="9"></p>
<p>（5）展示激光雷达点云数据</p>
<p><img src="/images/10.png" alt="10"></p>
<h5 id="3-Gmapping建图算法的实现"><a href="#3-Gmapping建图算法的实现" class="headerlink" title="3.Gmapping建图算法的实现"></a>3.Gmapping建图算法的实现</h5><h6 id="（1）msg数据类型查询"><a href="#（1）msg数据类型查询" class="headerlink" title="（1）msg数据类型查询"></a>（1）msg数据类型查询</h6><p><img src="/images/11.png" alt="11"></p>
<h6 id="（2）启动Gmapping算法功能包"><a href="#（2）启动Gmapping算法功能包" class="headerlink" title="（2）启动Gmapping算法功能包"></a>（2）启动Gmapping算法功能包</h6><p>输入如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun gmapping slam_gmapping</span><br></pre></td></tr></table></figure>

<p><img src="/images/12.png" alt="12"></p>
<p><img src="/images/13.png" alt="13"></p>
<h6 id="（3）编写回调函数，利用opencv库绘制2D地图"><a href="#（3）编写回调函数，利用opencv库绘制2D地图" class="headerlink" title="（3）编写回调函数，利用opencv库绘制2D地图"></a>（3）编写回调函数，利用opencv库绘制2D地图</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">void callback6(const nav_msgs::OccupancyGrid::ConstPtr&amp; ptr)</span><br><span class="line"></span><br><span class="line">&#123;  </span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; &quot;resolution: &quot; &lt;&lt; ptr-&gt;info.resolution &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; &quot;width: &quot; &lt;&lt; ptr-&gt;info.width &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; &quot;height: &quot; &lt;&lt; ptr-&gt;info.height &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  double scale = 1.0;</span><br><span class="line"></span><br><span class="line">  int width = 1200;</span><br><span class="line"></span><br><span class="line">  int height = 1200;</span><br><span class="line"></span><br><span class="line">  cv::Point offset(-1600, -1600);</span><br><span class="line"></span><br><span class="line">  cv::Mat map = cv::Mat::zeros(cv::Size(width, height), CV_8UC3);</span><br><span class="line"></span><br><span class="line">  for (int i = 0; i &lt; ptr-&gt;info.width * ptr-&gt;info.height; ++i) &#123;</span><br><span class="line"></span><br><span class="line">  int x = (i % ptr-&gt;info.width + offset.x) * scale, y = (i / ptr-&gt;info.width + offset.y) * scale;</span><br><span class="line"></span><br><span class="line">  if (ptr-&gt;data[i] == -1) &#123;</span><br><span class="line"></span><br><span class="line">  cv::circle(map, cv::Point(x, y), 1, cv::Scalar(255, 255, 255), -1);</span><br><span class="line"></span><br><span class="line">    &#125; else if (ptr-&gt;data[i] &gt;= 80) &#123;</span><br><span class="line"></span><br><span class="line">  cv::circle(map, cv::Point(x, y), 3, cv::Scalar(0, 0, 0), -1);</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line"></span><br><span class="line">  cv::circle(map, cv::Point(x, y), 3, cv::Scalar(0, 255, 0), -1);</span><br><span class="line"></span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cv::imshow(&quot;map&quot;, map);</span><br><span class="line"></span><br><span class="line">  cv::waitKey(1000);</span><br><span class="line"></span><br><span class="line">  return ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="（4）建立节点并订阅-map话题，调用回调函数"><a href="#（4）建立节点并订阅-map话题，调用回调函数" class="headerlink" title="（4）建立节点并订阅&#x2F;map话题，调用回调函数"></a>（4）建立节点并订阅&#x2F;map话题，调用回调函数</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ros::init(argc, argv, &quot;show_map&quot;);</span><br><span class="line">ros::NodeHandle nodeHandle;</span><br><span class="line">ros::Subscriber subscriber = nodeHandle.subscribe(&quot;/map&quot;, 1000, callback6);</span><br><span class="line">ros::spin();</span><br></pre></td></tr></table></figure>

<h6 id="（5）建图结果"><a href="#（5）建图结果" class="headerlink" title="（5）建图结果"></a>（5）建图结果</h6><p><img src="/images/14.png" alt="14"></p>
<h4 id="附录一：必要的库文件和头文件："><a href="#附录一：必要的库文件和头文件：" class="headerlink" title="附录一：必要的库文件和头文件："></a>附录一：必要的库文件和头文件：</h4><ol>
<li><ul>
<li>**<iostream>**：用于输入输出操作。</li>
<li>**<fstream>**：用于文件读写操作。</li>
<li>**<string>**：用于处理字符串。</li>
<li>**<ctime>**：用于时间相关操作。</li>
<li>**<iomanip>**：用于格式化输出。</li>
<li>**”ros&#x2F;ros.h”**：ROS的主要头文件。</li>
<li>**”sensor_msgs&#x2F;Imu.h”**：ROS中IMU（惯性测量单元）数据的消息类型。</li>
<li>**”nav_msgs&#x2F;Odometry.h”**：ROS中里程计数据的消息类型。</li>
<li>**<cstring>**：用于C风格字符串操作。</li>
<li>**&lt;opencv2&#x2F;opencv.hpp&gt;**：OpenCV库的头文件。</li>
<li>**”cv_bridge&#x2F;cv_bridge.h”**：ROS中用于将ROS图像消息转换为OpenCV图像格式的库。</li>
<li>**”image_transport&#x2F;image_transport.h”**：ROS中用于图像传输的库。</li>
<li>**<memory>**：用于内存管理。</li>
<li>**”pcl&#x2F;visualization&#x2F;cloud_viewer.h”**：PCL（点云库）中用于可视化点云的类。</li>
<li>**”pcl_conversions&#x2F;pcl_conversions.h”**：PCL与ROS消息类型转换的库。</li>
<li>**”pcl&#x2F;point_types.h”**：定义了PCL中常用的点类型。</li>
<li>**”pcl&#x2F;PCLPointCloud2.h”**：PCL中点云数据的消息类型。</li>
<li>**”pcl&#x2F;conversions.h”**：PCL与ROS消息类型转换的库。</li>
<li>**”pcl_ros&#x2F;transforms.h”**：PCL中点云坐标系变换的库。</li>
<li>**”nav_msgs&#x2F;OccupancyGrid.h”**：ROS中占据栅格地图数据的消息类型。</li>
</ul>
</li>
</ol>
<h4 id="附录二：安装各库文件的命令"><a href="#附录二：安装各库文件的命令" class="headerlink" title="附录二：安装各库文件的命令"></a>附录二：安装各库文件的命令</h4><ol>
<li><pre><code>sudo apt-get update
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 更新包管理器的软件包列表。</span><br><span class="line"></span><br><span class="line">3. ```</span><br><span class="line">   sudo apt-get upgrade</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>升级系统中的所有已安装软件包。</p>
</li>
<li><pre><code>sudo apt-get install libopencv-dev
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6. 安装OpenCV库的开发文件。</span><br><span class="line"></span><br><span class="line">7. ```</span><br><span class="line">   sudo apt-get install libopencv-contrib-dev</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>安装OpenCV贡献模块的开发文件。</p>
</li>
<li><pre><code>sudo apt-get update
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">10. 再次更新包管理器的软件包列表。</span><br><span class="line"></span><br><span class="line">11. ```</span><br><span class="line">    sudo apt-get install libproj-dev</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>安装Proj库的开发文件，Proj库提供了地理投影转换的功能。</p>
</li>
<li><pre><code>sudo apt-get install libpcl-dev
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">14. 安装PCL（Point Cloud Library）库的开发文件，PCL库用于点云数据处理和分析。</span><br><span class="line"></span><br><span class="line">15. ```</span><br><span class="line">    sudo apt-get install libsdl1.2-dev</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>安装SDL 1.2库的开发文件，SDL库用于创建图形用户界面和处理多媒体。</p>
</li>
<li><pre><code>sudo apt install libsdl-image1.2-dev
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">18. 安装SDL_image 1.2库的开发文件，SDL_image库提供了图像处理功能。</span><br><span class="line"></span><br><span class="line">19. ```</span><br><span class="line">    sudo apt-get install ros-kinetic-gmapping</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>安装ROS Kinetic版本中的gmapping软件包，gmapping是用于构建占据栅格地图的SLAM算法。</p>
</li>
<li><pre><code>sudo apt-get install ros-kinetic-slam-gmapping
</code></pre>
</li>
<li><p>安装ROS Kinetic版本中的slam_gmapping软件包，slam_gmapping提供了用于构建占据栅格地图的SLAM算法。</p>
</li>
</ol>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">上一页</a></div><div class="pagination-next"><a href="/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/head.jpg" alt="明诚"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">明诚</p><p class="is-size-6 is-block">走过的路，每一步都算数。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>江苏 苏州</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">23</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">33</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Asgard-Tim" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Asgard-Tim"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://www.weibo.com/u/6315188431"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://space.bilibili.com/171895120"><i class="fab fa-bilibili"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://jaguarliu.me/ai-projects" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AI-Tools</span></span><span class="level-right"><span class="level-item tag">jaguarliu.me</span></span></a></li><li><a class="level is-mobile" href="https://zlibrary-east.se/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Zlibrary</span></span><span class="level-right"><span class="level-item tag">zlibrary-east.se</span></span></a></li><li><a class="level is-mobile" href="https://www.cnki.net/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CNKI</span></span><span class="level-right"><span class="level-item tag">www.cnki.net</span></span></a></li><li><a class="level is-mobile" href="https://chat.openai.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ChatGPT</span></span><span class="level-right"><span class="level-item tag">chat.openai.com</span></span></a></li><li><a class="level is-mobile" href="https://www.iodraw.com/tool/sketch" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">照片转素描</span></span><span class="level-right"><span class="level-item tag">www.iodraw.com</span></span></a></li><li><a class="level is-mobile" href="https://www.integral-calculator.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">积分计算器</span></span><span class="level-right"><span class="level-item tag">www.integral-calculator.com</span></span></a></li><li><a class="level is-mobile" href="https://cli.im/text" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">二维码生成器</span></span><span class="level-right"><span class="level-item tag">cli.im</span></span></a></li><li><a class="level is-mobile" href="https://tool.sacdr.net/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">音乐解锁</span></span><span class="level-right"><span class="level-item tag">tool.sacdr.net</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/About-XJH/"><span class="level-start"><span class="level-item">About XJH</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul><li><a class="level is-mobile" href="/categories/About-XJH/%E6%98%8E%E6%85%B5/"><span class="level-start"><span class="level-item">明慵</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"><span class="level-start"><span class="level-item">碎碎念</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/CQU/"><span class="level-start"><span class="level-item">CQU</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/"><span class="level-start"><span class="level-item">个人项目</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">动手学深度学习</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/"><span class="level-start"><span class="level-item">课程项目</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%AE%9A%E9%87%8F%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95I/"><span class="level-start"><span class="level-item">定量工程设计方法I</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">工程原理</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">工程设计</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"><span class="level-start"><span class="level-item">线性代数</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">软件设计</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/2024/02/11/QQmsganalysis/"><img src="/images/QQmsganalysis_files/QQmsganalysis_42_0.png" alt="QQ聊天记录分析 QQMsgAnalysis"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-02-11T14:13:58.000Z">2024-02-11</time></p><p class="title"><a href="/2024/02/11/QQmsganalysis/">QQ聊天记录分析 QQMsgAnalysis</a></p><p class="categories"><a href="/categories/About-XJH/">About XJH</a> / <a href="/categories/About-XJH/%E6%98%8E%E6%85%B5/">明慵</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/11/12/%E6%96%AF%E7%89%B9%E6%9E%97%E5%BE%AA%E7%8E%AF/"><img src="/images/hot/022.png" alt="课题：斯特林发动机热力循环计算及分析"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-11-11T21:56:58.000Z">2023-11-12</time></p><p class="title"><a href="/2023/11/12/%E6%96%AF%E7%89%B9%E6%9E%97%E5%BE%AA%E7%8E%AF/">课题：斯特林发动机热力循环计算及分析</a></p><p class="categories"><a href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a> / <a href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/">工程设计</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/10/13/%E6%B0%94%E7%BC%B8%E6%B4%BB%E5%A1%9E%E6%8A%A5%E5%91%8A/"><img src="/images/qigang/06.png" alt="课题：发动机驱动部件的制作（气缸）"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-10-12T17:49:58.000Z">2023-10-13</time></p><p class="title"><a href="/2023/10/13/%E6%B0%94%E7%BC%B8%E6%B4%BB%E5%A1%9E%E6%8A%A5%E5%91%8A/">课题：发动机驱动部件的制作（气缸）</a></p><p class="categories"><a href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a> / <a href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/">工程设计</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/10/05/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"><img src="/images/phi.png" alt="3.线性神经网络"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-10-05T08:20:00.000Z">2023-10-05</time></p><p class="title"><a href="/2023/10/05/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/">3.线性神经网络</a></p><p class="categories"><a href="/categories/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">动手学深度学习</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/10/01/%E6%8A%A5%E5%91%8A/"><img src="/images/wall/3.jpg" alt="课题：典型建筑墙体的稳态传热分析"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-10-01T10:08:58.000Z">2023-10-01</time></p><p class="title"><a href="/2023/10/01/%E6%8A%A5%E5%91%8A/">课题：典型建筑墙体的稳态传热分析</a></p><p class="categories"><a href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a> / <a href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/">工程设计</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C51/"><span class="tag">C51</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CQU/"><span class="tag">CQU</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ChatGPT/"><span class="tag">ChatGPT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FPGA/"><span class="tag">FPGA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MATLAB/"><span class="tag">MATLAB</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/QQbot/"><span class="tag">QQbot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RANSAC/"><span class="tag">RANSAC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROS/"><span class="tag">ROS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/STM32/"><span class="tag">STM32</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/XJH/"><span class="tag">XJH</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BC%A0%E7%83%AD%E5%AD%A6/"><span class="tag">传热学</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%86%9B%E8%AE%AD/"><span class="tag">军训</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="tag">动手学深度学习</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/"><span class="tag">单片机</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/"><span class="tag">可视化</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB/"><span class="tag">图像识别</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="tag">学习笔记</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%9A%E9%87%8F%E5%88%86%E6%9E%90/"><span class="tag">定量分析</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%8F%E4%BD%9C%E6%96%87/"><span class="tag">小作文</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%8F%E8%BD%A6/"><span class="tag">小车</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E7%A8%8B%E7%83%AD%E5%8A%9B%E5%AD%A6/"><span class="tag">工程热力学</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"><span class="tag">年终总结</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%88%86%E6%9E%90/"><span class="tag">数据处理分析</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%AF%E7%89%B9%E6%9E%97%E5%8F%91%E5%8A%A8%E6%9C%BA/"><span class="tag">斯特林发动机</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%9F%E6%97%A5/"><span class="tag">生日</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"><span class="tag">碎碎念</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"><span class="tag">线性代数</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%88%B9/"><span class="tag">船</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/"><span class="tag">路径规划</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/title.png" alt="XJH&#039;s Secret Base" height="28"></a><p class="is-size-7"><span>&copy; 2024 明诚</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© Copyright by XJH 此心安处是吾乡。</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Asgard-Tim"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/chitose.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>