<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta name="theme-color" content="#123456"><meta name="generator" content="Hexo 4.2.0"><title>标签: STM32 - XJH&#039;s Secret Base</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="XJH&#039;s Secret Base"><meta name="msapplication-TileImage" content="/img/logo.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="XJH&#039;s Secret Base"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="144x144" href="/img/logo.png"><meta name="description" content="XJH的秘密基地"><meta property="og:type" content="blog"><meta property="og:title" content="XJH&#039;s Secret Base"><meta property="og:url" content="http://asgard-tim.github.io/"><meta property="og:site_name" content="XJH&#039;s Secret Base"><meta property="og:description" content="XJH的秘密基地"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://asgard-tim.github.io/img/og_image.png"><meta property="article:author" content="明诚"><meta property="article:tag" content="XJH&#039;s blogs"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://asgard-tim.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://Asgard-Tim.github.io"},"headline":"XJH's Secret Base","image":["http://asgard-tim.github.io/img/og_image.png"],"author":{"@type":"Person","name":"明诚"},"publisher":{"@type":"Organization","name":"XJH's Secret Base","logo":{"@type":"ImageObject","url":"http://asgard-tim.github.io/img/title.png"}},"description":"XJH的秘密基地"}</script><link rel="icon" href="/img/logo.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/xt256.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/title.png" alt="XJH&#039;s Secret Base" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">时间轴</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com">GitHub</a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Asgard-Tim"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">标签</a></li><li class="is-active"><a href="#" aria-current="page">STM32</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-06-24T21:56:58.000Z" title="2023/6/25 05:56:58">2023-06-25</time>发表</span><span class="level-item"><time dateTime="2023-08-03T09:18:54.789Z" title="2023/8/3 17:18:54">2023-08-03</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a><span> / </span><a class="link-muted" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%AE%9A%E9%87%8F%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95I/">定量工程设计方法I</a></span><span class="level-item">1 小时读完 (大约8636个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/06/25/QEA-Radar-Car/">小车路径规划</a></p><div class="content"><p>本项目全部代码已同步上传至Github,仓库链接：<a target="_blank" rel="noopener" href="https://github.com/Asgard-Tim/Path-Planning">Asgard-Tim&#x2F;Path-Planning: 重庆大学明月科创实验班定量工程设计方法课程项目 (github.com)</a></p>
<h4 id="一、设计要求"><a href="#一、设计要求" class="headerlink" title="一、设计要求"></a>一、设计要求</h4><hr>
<p>在本部分的课程项目中，要求我们运用LD14雷达扫描地图，在MATLAB中进行人工势场添加并对STM32小车进行路径规划，在一规定的场地中让小车避开两个矩形障碍物并以尽可能短的路径最终抵达圆形目标位置。</p>
<br>

<h4 id="二、系统方案"><a href="#二、系统方案" class="headerlink" title="二、系统方案"></a>二、系统方案</h4><hr>
<h5 id="2-1-移动底盘分析"><a href="#2-1-移动底盘分析" class="headerlink" title="2.1 移动底盘分析"></a><strong>2.1 移动底盘分析</strong></h5><p>小车为履带式小车，左右履带分别由一枚直流电机进行驱动，运动模式类似常规双轮小车，通过左右两枚电机转动的差速实现转向。该小车相对来说较为容易进行控制，只需要控制两个驱动轮的速度存在差异，即两轮差速，即可控制机器人实现无滑动摩擦的旋转，也可实现零半径转弯。</p>
<p><em>图2-1 双轮履带小车外观图</em></p>
<p><img src="/images/radarcar/2-1.jpg" alt="1"></p>
<p><em>图2-2 两轮差速式机器人运动学分析图</em></p>
<p><img src="/images/radarcar/2-2.png" alt="2"></p>
<p>对小车移动底盘的运动学分析（如上图2-2所示）：</p>
<p>小车的速度控制主要是控制 X 轴（前后方向）和 Z 轴（旋转方向）的速度， 以 Vx 和 Vz 来指代，单位分别是 m&#x2F;s 和弧度&#x2F;s。X 轴方向以前进记为正，Z 轴方向以右转记为正。车轮速度是使用编码器来计算和得出，读取编码器计数后再转化成车轮的速度。Vz则是通过左右电机转动的差速计算得到的。</p>
<p>图中参数分别代表：</p>
<p><img src="/images/radarcar/2-3.png" alt="3"></p>
<h5 id="2-2-电机特性分析"><a href="#2-2-电机特性分析" class="headerlink" title="2.2 电机特性分析"></a><strong>2.2 电机特性分析</strong></h5><p>在本次项目中，我们采用带有减速器与编码器的直流电机驱动小车前进。</p>
<p>直流电机的物理模型图如下图2-3所示。其中，固定部分有磁铁，这里称作主磁极；固定部分还有电刷。转动部分有环形铁心和绕在环形铁心上的绕组。 (其中 2 个小圆圈是为了方便表示该位置上的导体电势或电流的方向而设置的) 它的固定部分（定子）上，装设了一对直流励磁的静止的主磁极 N 和S，在旋转部分（转子）上装设电枢铁心。在电枢铁心上放置了两根导体连成的电枢线圈， 线圈的首端和末端分别连到两个圆弧形的铜片上，此铜片称为换向片。换向片之间 互相绝缘，由换向片构成的整体称为换向器。换向器固定在转轴上，换向片与转轴 之间亦互相绝缘。在换向片上放置着一对固定不动的电刷 B1 和 B2，当电枢旋转时，电枢线圈通过换向片和电刷与外电路接通。在电刷上施加直流电压 U,电枢线圈中的电流流向为：N 极下的有效边中的电流总是一个方向，而 S 极下的有效边中的电流总是另一个方向。这样两个有效边所受的洛伦兹力的方向一致（可以根据左手法则判定），电枢开始转动。具体来说就是，把上图中的+和-分别接到电池的正极和负极，电机即可转动；如果是把上图中的+和-分别接到电池的负极和正极，则电机会反方向转动。电机的转速可以理解为和外接的电压是正相关的（实际是由电枢电流决定）。</p>
<p>总而言之，如果我们可以调节施加在电机上面的直流电压大小，即可实现直流 电机调速，改变施加电机上面直流电压的极性，即可实现电机换向。</p>
<p><em>图2-3 直流电机的物理模型</em></p>
<p><img src="/images/radarcar/2-4.png" alt="4"></p>
<p>在具体的使用过程中，我们需要通过在特定的引脚之间（如本次项目所用电机为1&#x2F;6引脚）接上一个直流电源，电机即可转动，且改变电压大小即可改变电机转速。接线方式说明如下图2-4所示。</p>
<p><img src="/images/radarcar/2-5.png" alt="5"></p>
<h5 id="2-3-电机控制策略以及PID特性分析"><a href="#2-3-电机控制策略以及PID特性分析" class="headerlink" title="2.3 电机控制策略以及PID特性分析"></a><strong>2.3 电机控制策略以及PID特性分析</strong></h5><p>小车电机驱动器芯片使用 AT8236，具有过流保护功能，并可设置电流阈值。驱动芯片只需两个逻辑输入，便可达到调速和正反转的功能，本小车中，每个电机使用两路PWM进行调速（实际上一个普通 IO 和一路 PWM 即可进行正反转 和调速）。</p>
<p>电机的速度使用 13 线霍尔编码器输出 AB 相进行测量，电机减速比为 1:30，使用 STM32 的编码器测量功能，并初始化为脉冲上升沿和下降沿都进行计数，可实现轮子转一圈输出 1560 个计数。</p>
<p>电机调速框图如下图2-5所示。</p>
<p><em>图2-5 电机调速框图</em></p>
<p><img src="/images/radarcar/2-6.png" alt="6"></p>
<p>基于2.1节提到的小车移动地盘的运动学分析，我们可以进一步讨论这些物理量之间的关系，并求出其运动学正逆解公式（如下图2-6），结合PID实现控制。</p>
<p><em>图2-6 两轮差速式机器人的运动学正逆解公式</em></p>
<p><img src="/images/radarcar/2-7.png" alt="7"></p>
<p><img src="/images/radarcar/2-8.png" alt="8"></p>
<p><img src="/images/radarcar/2-9.png" alt="9"></p>
<p><img src="/images/radarcar/2-10.png" alt="10"></p>
<p>下图2-7为PID的控制框图，每个方块代表控制系统的一个组成部分，从图中可看出系统中各组成部分的相互关系和影响，即 PID 调节系统是具有被调参数负反馈的闭环系统。当被控量 Y 受到干扰的影响而升高时，反馈信号将高于给定值 X，经过比较而到放大元件去的偏差信号 e 将为负值，控制器将发出信号而使执行元件动作，其作用方向为负，使被控量下降，这就达到了自动控制的目的。</p>
<p>图2-7中的目标速度一般我们可以通过按键或者开关等方式编程实现改变目标值，测量速度就是通过单片机定时去采集编码器的数据并清零。目标速度和测量速度之间做差这个就是目前系统的偏差。在控制过程中，需要将目标速度、测量速度与偏差三者送入 PID 控制器进行计算输出，然后再经过电机驱动的功率放大控制电机的转动去减小偏差，最终达到目标速度。</p>
<p><em>图2-7 PID控制框图</em></p>
<p><img src="/images/radarcar/2-11.png" alt="11"></p>
<p>对于上述PID控制的基于C语言的实现，我们给出以下代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">`<span class="type">int</span> <span class="title function_">Incremental_PI</span> <span class="params">(<span class="type">int</span> Encoder,<span class="type">int</span> Target)</span>` </span><br><span class="line"></span><br><span class="line">`&#123;` </span><br><span class="line"></span><br><span class="line">`<span class="type">static</span> <span class="type">float</span> Bias,Pwm,Last_bias;` </span><br><span class="line"></span><br><span class="line">`Bias=Encoder-Target; <span class="comment">//计算偏差` </span></span><br><span class="line"></span><br><span class="line">`Pwm+=Velocity_KP*(Bias-Last_bias)+Velocity_KI*Bias;`</span><br><span class="line"></span><br><span class="line"> `<span class="comment">//增量式 PI 控制器` </span></span><br><span class="line"></span><br><span class="line">`Last_bias=Bias; <span class="comment">//保存上一次偏差` </span></span><br><span class="line"></span><br><span class="line">`<span class="keyword">return</span> Pwm; <span class="comment">//增量输出` </span></span><br><span class="line"></span><br><span class="line">`&#125;`</span><br></pre></td></tr></table></figure>

<p>其中，入口参数为编码器的速度测量值和速度控制的目标值，返回值为电机控制 PWM。第一行是相关内部变量的定义。第二行是求出速度偏差，由测量值减去目标值。第三行使用增量 PI 控制器求出电机 PWM。第四行保存上一次偏差，便于下次调用。最后一行是返回。</p>
<h5 id="2-4-嵌入式控制系统总结分析"><a href="#2-4-嵌入式控制系统总结分析" class="headerlink" title="2.4 嵌入式控制系统总结分析"></a><strong>2.4 嵌入式控制系统总结分析</strong></h5><p>总体而言，我们基于小车本身的轮距等基本参数编写了一整套嵌入式PID控制流程与系统（基于C语言，面向STM32编程），结合PWM波控制电压，从而控制电机的转速以实现对于车轮速度的反馈调节机制，能够保证小车始终保持相对稳定的速度前进，便于后面进一步规划算法，使小车的运动更加可控。此部分编写的KEIL工程详见附件“PID.zip”。</p>
<h5 id="2-5-传感系统总结分析"><a href="#2-5-传感系统总结分析" class="headerlink" title="2.5 传感系统总结分析"></a><strong>2.5 传感系统总结分析</strong></h5><p>本次项目所采用的传感器主要为激光雷达，在此我们选用LD14雷达。LD14 主要由激光测距核心，无线传电单元，无线通讯单元，角度测量单元、电机驱动单元和机械外壳组成。LD14测距核心采用三角测量法技术，可进行每秒 2300 次的测距。每次测距时，LD14从一个固定的角度发射出红外激光，激光遇到目标物体后被反射到接收单元。通过激光、目标物体、接收单元形成的三角关系，从而解算出距离。获取到距离数据后，LD14 会融合角度测量单元测量到的角度值组成点云数据，再进行导出。</p>
<p>雷达扫描点云数据形式如下图2-8所示：</p>
<p><em>图2-8 雷达扫描点云极坐标数据形式（下图2数据为角度（角度制），右侧为距离）</em></p>
<p><img src="/images/radarcar/2-12.png" alt="12"></p>
<p><img src="/images/radarcar/2-13.png" alt="13"></p>
<p>在项目的实践过程中，我们需要通过对STM32单片机进行编程，从激光雷达读取数据并通过串口将处理后的数据传输至电脑中（用特定的软件读取串口输出信息）。STM32中烧录的KEIL工程见附件“Lidar.zip”，接线方式如下图所示。</p>
<p><em>图2-9 激光雷达与单片机接线方式对应</em></p>
<p><img src="/images/radarcar/2-14.png" alt="14"></p>
<p><img src="/images/radarcar/2-15.png" alt="15"></p>
<p>这里给出KEIL工程中main.c中的主干代码（图2-10），最终会输出数据θ和r,分别代表偏转的角度（AvoidData[i].angle）和距离原点的距离（AvoidData[i].distance）。</p>
<p><em>图2-10 读取激光雷达数据的主干代码</em></p>
<p><img src="/images/radarcar/2-16.png" alt="16"></p>
<br>

<h4 id="三、硬件电路设计"><a href="#三、硬件电路设计" class="headerlink" title="三、硬件电路设计"></a>三、硬件电路设计</h4><hr>
<p>主要运用模块电路图如下图3-1所示：</p>
<p><em>图3-1 主要模块电路图</em></p>
<p><img src="/images/radarcar/3-1.png" alt="17"></p>
<p>其中，小车的主控为STM32 F103RCT6芯片，其主控板实物图如下图3-2所示：</p>
<p><em>图3-2 STM32主控板实物图</em></p>
<p><img src="/images/radarcar/3-2.png" alt="18"></p>
<p>由于本次项目需要完成的目标较为单一，仅使用其中少部分接口和器件。</p>
<br>

<h4 id="四、软件算法设计"><a href="#四、软件算法设计" class="headerlink" title="四、软件算法设计"></a>四、软件算法设计</h4><hr>
<h5 id="4-1-任务描述"><a href="#4-1-任务描述" class="headerlink" title="4.1 任务描述"></a><strong>4.1 任务描述</strong></h5><p>在本项目中，我们需要通过激光雷达对于小车所处的地图环境（2m*2m，放置有三个正方体障碍物与一个圆柱体目标物）进行扫描，并对扫描得到的数据结果进行处理。通过一定的算法对于目标物与障碍物进行识别后，我们还需要通过人工势场法进行路径规划，使得小车能够以最优的路径绕开障碍物到达目标物。</p>
<p>本次项目任务分为静态和动态两个部分，其中动态测试过程中会对障碍物的位置进行人为的随机改动。测试过程中，小车的起点位置与目标物的位置始终不变，且可自由选定小车的初始面对方向。</p>
<h5 id="4-2-技术路径和策略"><a href="#4-2-技术路径和策略" class="headerlink" title="4.2 技术路径和策略"></a><strong>4.2 技术路径和策略</strong></h5><p>通过对于任务描述的分析，我们大致可以将静态情况下的路径规划问题拆解为以下几个部分，并给出相应的处理工具与解决策略：</p>
<ul>
<li>（1） 地图扫描：需要通过对STM32单片机进行编程（利用软件工具KEIL），利用串口通信读取激光雷达扫描所获取的周围地图环境点云的极坐标数据</li>
<li>（2） 处理数据：将串口所得到的数据导入MATLAB中，利用坐标变换将不同点位扫描的极坐标数据统一到同一个笛卡尔坐标系中以便后续处理与识别</li>
<li>（3） 识别物体：在获取扫描后得到的地图后，需要利用RANSAC算法（随机抽样一致算法）识别点云数据中的直线与圆形，并得到相应的障碍物与目标物的二维坐标</li>
<li>（4） 路径规划：在MATLAB中编程，利用得到的出发点、障碍物和目标点各自的坐标建立势场，并用梯度下降法寻找避开障碍物、到达目标点的最优路径</li>
</ul>
<p>实际上，在动态情况下的路径规划问题中，实现的步骤也与上述大致相同，只是并没有MABLAB等电脑端的辅助软件帮助其进行数据处理与路径规划，需要将这些算法通过对STM32单片机编程集成到小车上，从而实现在测试地图环境随机发生改变的情况下仍然能够按照局部最优的路线避开障碍物到达目标点。</p>
<br>

<h5 id="4-3-核心程序逻辑"><a href="#4-3-核心程序逻辑" class="headerlink" title="4.3 核心程序逻辑"></a><strong>4.3 核心程序逻辑</strong></h5><h6 id="4-3-1-激光雷达极坐标点云数据的处理与变换——得到二维地图"><a href="#4-3-1-激光雷达极坐标点云数据的处理与变换——得到二维地图" class="headerlink" title="4.3.1 激光雷达极坐标点云数据的处理与变换——得到二维地图"></a>4.3.1 激光雷达极坐标点云数据的处理与变换——得到二维地图</h6><p>在2.5节，我们给出了我们的KEIL工程。通过将其烧入至STM32内，并按照特定接线方式将激光雷达与主控板连接，利用串口通信及相关软件成功在电脑上读取了激光雷达扫描得到的点云极坐标数据（如图2-8右图）。在实际测试时，我们选取了五个坐标点分别放置小车（控制朝向相同）对周围地图环境进行扫描，获得了“data1.txt”等一系列数据文件（详见附件）。</p>
<p>在MATLAB程序的第一部分，我们首先利用importdata函数从数据文本文件中读取相应数据，并将其按列分割为“angle”和“distance”两部分。随后，我们利用MATLAB中自带的坐标变换函数pol2cart将一系列的极坐标数据转换为笛卡尔坐标系下的x-y数据（算法原理如下图4-1）。事实上，由于小车每次扫描的位置均不同，因此还需要将多次扫描的结果结合每次小车放置位置的坐标进行一系列的拼接与变换，才可得到最终的场地二维地图（效果如下图4-2）。</p>
<p><em>图4-1 利用pol2cart函数进行坐标变换的原理示意图</em></p>
<p><img src="/images/radarcar/4-1.png" alt="19"></p>
<p><em>图4-2 经拼接后得到的场地二维地图</em></p>
<p><img src="/images/radarcar/4-2.png" alt="20"></p>
<p>该部分的代码给出如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">`<span class="comment">%Step1:处理激光雷达扫描数据，绘制二维坐标系地图`</span></span><br><span class="line"></span><br><span class="line">`<span class="built_in">ans</span>=importdata(<span class="string">&quot;data1.txt&quot;</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">angle</span>=<span class="built_in">ans</span>(:,<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">angle</span>=<span class="built_in">angle</span>.*<span class="number">2.</span>*<span class="number">3.1415926</span>./<span class="number">360</span>;`</span><br><span class="line"></span><br><span class="line">`distance=<span class="built_in">ans</span>(:,<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">`[x,y] = <span class="built_in">pol2cart</span>(<span class="built_in">angle</span>,distance);`</span><br><span class="line"></span><br><span class="line">`ans1=importdata(<span class="string">&quot;data2.txt&quot;</span>);`</span><br><span class="line"></span><br><span class="line">`angle1=ans1(:,<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`angle1=angle1.*<span class="number">2.</span>*<span class="number">3.1415926</span>./<span class="number">360</span>;`</span><br><span class="line"></span><br><span class="line">`distance1=ans1(:,<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">`[x1,y1] = <span class="built_in">pol2cart</span>(angle1,distance1);`</span><br><span class="line"></span><br><span class="line">`ans2=importdata(<span class="string">&quot;data3.txt&quot;</span>);`</span><br><span class="line"></span><br><span class="line">`angle2=ans2(:,<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`angle2=angle2.*<span class="number">2.</span>*<span class="number">3.1415926</span>./<span class="number">360</span>;`</span><br><span class="line"></span><br><span class="line">`distance2=ans2(:,<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">`[x2,y2] = <span class="built_in">pol2cart</span>(angle2,distance2);`</span><br><span class="line"></span><br><span class="line">`ans3=importdata(<span class="string">&quot;data4.txt&quot;</span>);`</span><br><span class="line"></span><br><span class="line">`angle3=ans3(:,<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`angle3=angle3.*<span class="number">2.</span>*<span class="number">3.1415926</span>./<span class="number">360</span>;`</span><br><span class="line"></span><br><span class="line">`distance3=ans3(:,<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">`[x3,y3] = <span class="built_in">pol2cart</span>(angle3,distance3);`</span><br><span class="line"></span><br><span class="line">`ans5=importdata(<span class="string">&quot;data5.txt&quot;</span>);`</span><br><span class="line"></span><br><span class="line">`angle5=ans5(:,<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`angle5=angle5.*<span class="number">2.</span>*<span class="number">3.1415926</span>./<span class="number">360</span>;`</span><br><span class="line"></span><br><span class="line">`distance5=ans5(:,<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">`[x5,y5] = <span class="built_in">pol2cart</span>(angle5,distance5);`</span><br><span class="line"></span><br><span class="line">`x4 = [x;x1<span class="number">-100</span>;x2+<span class="number">1850</span>;x3+<span class="number">1400</span>;x5+<span class="number">1500</span>]/<span class="number">100</span>;`</span><br><span class="line"></span><br><span class="line">`y4 = [y;y1+<span class="number">1750</span>;y2+<span class="number">100</span>;y3+<span class="number">1650</span>;y5+<span class="number">1000</span>]/<span class="number">100</span>;`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">figure</span>(<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">scatter</span>(x4,y4,<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">hold</span> on`</span><br><span class="line"></span><br><span class="line">`axis equal`</span><br><span class="line"></span><br><span class="line">`axis( [ <span class="number">-3</span>, <span class="number">22</span>, <span class="number">-3</span>, <span class="number">22</span> ] )`</span><br></pre></td></tr></table></figure>

<h6 id="4-3-2-利用RANSAC算法识别地图中的直线和圆——获得目标点与障碍物的坐标"><a href="#4-3-2-利用RANSAC算法识别地图中的直线和圆——获得目标点与障碍物的坐标" class="headerlink" title="4.3.2 利用RANSAC算法识别地图中的直线和圆——获得目标点与障碍物的坐标"></a>4.3.2 利用RANSAC算法识别地图中的直线和圆——获得目标点与障碍物的坐标</h6><p>在成功利用激光雷达的扫描数据建立了二维地图后，我们需要让机器人知道哪里能走哪里不能走，要走向哪里，即明确目标点以及障碍物的具体坐标。在本测试项目中，设定圆柱为目标物而正方体为障碍物，所以问题的关键即为如何从二维地图中识别出圆形以及正方形（本质上为直线的拼接）并获得其坐标。</p>
<p>在之前的课程中，介绍了RANSAC这一算法。随机样本一致性(<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Random_sample_consensus">Random Sample Consensus RANSAC</a>) 是一种迭代方法，用于从包含异常值的观察数据中估计出数学模型参数，因此也可以理解为一种异常值检测方法。RANSAC的一个基本假设是，数据由内点(“inliers”)和外点(“outliers”)组成，其中内点是在一定误差范围内可以通过一些模型参数来解释的数据，外点是不符合模型的数据。RANSAC的另一个假设是，随机选取的样本数据都是内点，存在一个可以估计模型参数的过程，该模型可以最佳地解释或拟合该数据。通过该算法，我们可以有效地从已有的地图（本质上是二维坐标系下的点集数据）中拟合出直线与圆的轮廓，并获取相应图形的对应坐标。</p>
<p>该算法的实现步骤如下：</p>
<p>（1） 从原始数据集S中随机选择子集s，s为假设的内点(子集s一般为最小子集，如：直线选取两个点，圆选择三个点)</p>
<p>（2） 依据子集s估计模型参数</p>
<p>（3） 遍历数据集S中除子集s外的所有数据，如果数据点在给定误差e以内，则标记为内点，否则标记为外点</p>
<p>（4）所有内点组成一致集，如果一致集中点的个数满足给定阈值T，则用一致集中所有内点重新估计模型参数，然后结束算法</p>
<p>（5）如果一致集中内点个数少于阈值T，则重新选择新的子集s，并重复步骤（1）-（4）</p>
<p>（6） 经过K次迭代，选择一个内点数量最多的一致集，用一致集中所有内点重新估计模型参数，然后结束算法</p>
<p>基于上述基本思想与步骤，我们编写了一段MATLAB代码，用于二维坐标地图中直线的识别与拟合。在此基础之上，我们根据算法原理，从点集中随机取出三个点，利用三点成圆获得圆的方程（利用自己编写的函数ThreePoint2Circle）。再对圆的轨迹赋予一个宽度，统计落入这个宽度中的点的数量，对所有的点进行逐个取点，获得最优的圆的方程。值得注意的是，由于待识别的正方形是由多条直边构成，这要求我们需要重复对于该图像进行扫描拟合，且需要在一次拟合之后将该次拟合中涉及的数据点删除以防影响下次拟合。下面将给出这一部分的代码实现以及拟合效果（如图4-3、4-4）。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line">`<span class="comment">%Step2:利用RANSAC算法识别直线和圆`</span></span><br><span class="line"></span><br><span class="line">`<span class="comment">%(1)圆的识别`</span></span><br><span class="line"></span><br><span class="line">`a = [x4,y4];`</span><br><span class="line"></span><br><span class="line">`<span class="comment">% RANSCA参数：`</span></span><br><span class="line"></span><br><span class="line">`<span class="comment">% 迭代次数`</span></span><br><span class="line"></span><br><span class="line">`iter = <span class="number">0</span>;`</span><br><span class="line"></span><br><span class="line">`<span class="comment">% 查看圆数据的大小`</span></span><br><span class="line"></span><br><span class="line">`[m,n] = <span class="built_in">size</span>(a);`</span><br><span class="line"></span><br><span class="line">`<span class="comment">% 误差参数`</span></span><br><span class="line"></span><br><span class="line">`berr = <span class="number">0.02</span>;`</span><br><span class="line"></span><br><span class="line">`<span class="comment">% 拟合参数`</span></span><br><span class="line"></span><br><span class="line">`bfit = [];`</span><br><span class="line"></span><br><span class="line">`<span class="comment">% 内点个数为点数的1/3`</span></span><br><span class="line"></span><br><span class="line">`t = <span class="built_in">floor</span>(m/<span class="number">3</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="comment">% 开始循环迭代`</span></span><br><span class="line"></span><br><span class="line">`<span class="keyword">while</span> iter&lt;<span class="number">100</span>`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">% 随机挑选三个点，三个点不重复`</span></span><br><span class="line"></span><br><span class="line">  `<span class="comment">% 拟合圆最少需要三个点，拟合直线最少需要两个`</span></span><br><span class="line"></span><br><span class="line">  `<span class="comment">% ran为索引编号`</span></span><br><span class="line"></span><br><span class="line">  `ran = randperm(m,<span class="number">3</span>)&#x27;;`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">% b为索引得到的点`</span></span><br><span class="line"></span><br><span class="line">  `b = a(ran,:);`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">% 根据随机得到的三个点，计算圆的半径和圆心`</span></span><br><span class="line"></span><br><span class="line">  `[r1,p1] = ThreePoint2Circle(b(<span class="number">1</span>,<span class="number">1</span>:<span class="number">2</span>), b(<span class="number">2</span>,<span class="number">1</span>:<span class="number">2</span>), b(<span class="number">3</span>,<span class="number">1</span>:<span class="number">2</span>));`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">% 选择除了随机得到的三个点外的其他点`</span></span><br><span class="line"></span><br><span class="line">  `c = setdiff(a,b,<span class="string">&quot;rows&quot;</span>);`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">% 计算每个点到圆心的距离dis`</span></span><br><span class="line"></span><br><span class="line">  `dis = <span class="built_in">sqrt</span>(sum((c(:,<span class="number">1</span>:<span class="number">2</span>)-p1).^<span class="number">2</span>,<span class="number">2</span>));`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">% 计算 dis和拟合圆的误差`</span></span><br><span class="line"></span><br><span class="line">  `res = dis - r1;`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">% 选择小于误差的点，进入到内点中`</span></span><br><span class="line"></span><br><span class="line">  `d = c(res&lt;berr,:);`</span><br><span class="line"></span><br><span class="line">  `len = <span class="built_in">length</span>(d(:,<span class="number">1</span>));`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">% 判断内点数量是否满足条件`</span></span><br><span class="line"></span><br><span class="line">  `<span class="keyword">if</span> len &gt; t`</span><br><span class="line"></span><br><span class="line">​    `<span class="comment">% 满足条件时，多点拟合圆，这里用平均值计算圆心`</span></span><br><span class="line"></span><br><span class="line">​    `p = <span class="built_in">mean</span>(d);`</span><br><span class="line"></span><br><span class="line">​    `r = <span class="built_in">mean</span>(<span class="built_in">sqrt</span>(sum((d(:,<span class="number">1</span>:<span class="number">2</span>)-p(:,<span class="number">1</span>:<span class="number">2</span>)).^<span class="number">2</span>,<span class="number">2</span>)));`</span><br><span class="line"></span><br><span class="line">​    `<span class="comment">% 多点拟合的圆和随机点拟合的圆的误差`</span></span><br><span class="line"></span><br><span class="line">​    `err = <span class="built_in">sqrt</span>(sum((p-p1).^<span class="number">2</span>))+<span class="built_in">sqrt</span>((r-r1)^<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">​    `<span class="comment">% 如果误差满足条件，则可以结束循环`</span></span><br><span class="line"></span><br><span class="line">​    `<span class="comment">% 不满足则继续`</span></span><br><span class="line"></span><br><span class="line">​    `<span class="keyword">if</span> err &lt; berr`</span><br><span class="line"></span><br><span class="line">​      `bfit = [p,r];`</span><br><span class="line"></span><br><span class="line">​      `berr = err;`</span><br><span class="line"></span><br><span class="line">​      `<span class="keyword">break</span>`</span><br><span class="line"></span><br><span class="line">​    `<span class="keyword">else</span>`</span><br><span class="line"></span><br><span class="line">​      `iter = iter+<span class="number">1</span>;`</span><br><span class="line"></span><br><span class="line">​       `<span class="keyword">continue</span>`</span><br><span class="line"></span><br><span class="line">​    `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">  `<span class="keyword">else</span>`</span><br><span class="line"></span><br><span class="line">​    `iter = iter+<span class="number">1</span>;`</span><br><span class="line"></span><br><span class="line">  `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">`<span class="comment">%绘图`</span></span><br><span class="line"></span><br><span class="line">`para = [p(<span class="number">1</span>)-r, p(<span class="number">2</span>)-r, <span class="number">2</span>*r, <span class="number">2</span>*r];`</span><br><span class="line"></span><br><span class="line">`rectangle(<span class="string">&#x27;Position&#x27;</span>, para, <span class="string">&#x27;Curvature&#x27;</span>, [<span class="number">1</span> <span class="number">1</span>]);` </span><br><span class="line"></span><br><span class="line">`<span class="comment">%（2）直线的识别`</span></span><br><span class="line"></span><br><span class="line">`iter = <span class="number">100</span>;`</span><br><span class="line"></span><br><span class="line">`data1=transpose(x4);`</span><br><span class="line"></span><br><span class="line">`data2=transpose(y4);`</span><br><span class="line"></span><br><span class="line">`data=[data1;data2];`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">for</span> t=<span class="number">1</span>:<span class="number">10</span>`</span><br><span class="line"></span><br><span class="line"> `number = <span class="built_in">size</span>(data,<span class="number">2</span>); <span class="comment">% 总点数`</span></span><br><span class="line"></span><br><span class="line"> `bestParameter1=<span class="number">0</span>; bestParameter2=<span class="number">0</span>; <span class="comment">% 最佳匹配的参数`</span></span><br><span class="line"></span><br><span class="line"> `sigma = <span class="number">1</span>;`</span><br><span class="line"></span><br><span class="line"> `pretotal=<span class="number">0</span>;   <span class="comment">%符合拟合模型的数据的个数`</span></span><br><span class="line"></span><br><span class="line"> `<span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:iter`</span><br><span class="line"></span><br><span class="line"> `<span class="comment">%随机选择两个点`</span></span><br><span class="line"></span><br><span class="line">   `idx = randperm(number,<span class="number">2</span>);` </span><br><span class="line"></span><br><span class="line">   `sample = data(:,idx);` </span><br><span class="line"></span><br><span class="line">   `<span class="comment">%拟合直线方程 y=kx+b`</span></span><br><span class="line"></span><br><span class="line">   `line = <span class="built_in">zeros</span>(<span class="number">1</span>,<span class="number">3</span>);`</span><br><span class="line"></span><br><span class="line">   `x = sample(:, <span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">   `y = sample(:, <span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">   `k=(y(<span class="number">1</span>)-y(<span class="number">2</span>))/(x(<span class="number">1</span>)-x(<span class="number">2</span>));   <span class="comment">%直线斜率`</span></span><br><span class="line"></span><br><span class="line">   `b = y(<span class="number">1</span>) - k*x(<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">   `line = [k <span class="number">-1</span> b];`</span><br><span class="line"></span><br><span class="line">   `mask=<span class="built_in">abs</span>(line*[data; <span class="built_in">ones</span>(<span class="number">1</span>,<span class="built_in">size</span>(data,<span class="number">2</span>))]);  <span class="comment">%求每个数据到拟合直线的距离`</span></span><br><span class="line"></span><br><span class="line">   `total=sum(mask&lt;sigma);       <span class="comment">%计算数据距离直线小于一定阈值的数据的个数`</span></span><br><span class="line"></span><br><span class="line">   `<span class="keyword">if</span> total&gt;pretotal      <span class="comment">%找到符合拟合直线数据最多的拟合直线`</span></span><br><span class="line"></span><br><span class="line">​     `pretotal=total;`</span><br><span class="line"></span><br><span class="line">​     `bestline=line;     <span class="comment">%找到最好的拟合直线`</span></span><br><span class="line"></span><br><span class="line">  `<span class="keyword">end</span>` </span><br><span class="line"></span><br><span class="line"> `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">`<span class="comment">%显示符合最佳拟合的数据`</span></span><br><span class="line"></span><br><span class="line"> `mask=<span class="built_in">abs</span>(bestline*[data; <span class="built_in">ones</span>(<span class="number">1</span>,<span class="built_in">size</span>(data,<span class="number">2</span>))])&lt;sigma;`  </span><br><span class="line"></span><br><span class="line"> `<span class="built_in">hold</span> on;`</span><br><span class="line"></span><br><span class="line"> `k=<span class="number">1</span>;`</span><br><span class="line"></span><br><span class="line"> `index=[];`</span><br><span class="line"></span><br><span class="line"> `<span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(mask)`</span><br><span class="line"></span><br><span class="line">  `<span class="keyword">if</span> mask(<span class="built_in">i</span>)`</span><br><span class="line"></span><br><span class="line">​    `inliers(<span class="number">1</span>,k) = data(<span class="number">1</span>,<span class="built_in">i</span>);`</span><br><span class="line"></span><br><span class="line">​    `k=k+<span class="number">1</span>;`</span><br><span class="line"></span><br><span class="line">​    `index=[index <span class="built_in">i</span>];`</span><br><span class="line"></span><br><span class="line">  `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line"> `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line"> `<span class="comment">%删除完成拟合的点以进行下一次拟合`</span></span><br><span class="line"></span><br><span class="line"> `<span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(index)`</span><br><span class="line"></span><br><span class="line">  `data(:,index(<span class="built_in">i</span>))=[];`</span><br><span class="line"></span><br><span class="line">  `<span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:<span class="built_in">length</span>(index)`</span><br><span class="line"></span><br><span class="line">​    `<span class="keyword">if</span>(index(<span class="built_in">j</span>)&gt;index(<span class="built_in">i</span>))`</span><br><span class="line"></span><br><span class="line">​      `index(<span class="built_in">j</span>)=index(<span class="built_in">j</span>)<span class="number">-1</span>;`</span><br><span class="line"></span><br><span class="line">​    `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">  `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line"> `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line"> `<span class="comment">% 绘制最佳匹配曲线`</span></span><br><span class="line"></span><br><span class="line"> `bestParameter1 = -bestline(<span class="number">1</span>)/bestline(<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line"> `bestParameter2 = -bestline(<span class="number">3</span>)/bestline(<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line"> `xAxis = <span class="built_in">min</span>(inliers(<span class="number">1</span>,:)):<span class="built_in">max</span>(inliers(<span class="number">1</span>,:));`</span><br><span class="line"></span><br><span class="line"> `yAxis = bestParameter1*xAxis + bestParameter2;`</span><br><span class="line"></span><br><span class="line"> `<span class="built_in">plot</span>(xAxis,yAxis,<span class="string">&#x27;r-&#x27;</span>,<span class="string">&#x27;LineWidth&#x27;</span>,<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">`<span class="function"><span class="keyword">function</span> <span class="params">[R,P0]</span> = <span class="title">ThreePoint2Circle</span><span class="params">(P1, P2, P3)</span>`</span></span><br><span class="line"></span><br><span class="line">`<span class="comment">%% 求圆心和半径，三个点可以求圆心和半径`</span></span><br><span class="line"></span><br><span class="line">  `x1 = P1(<span class="number">1</span>);  x2 = P2(<span class="number">1</span>);  x3 = P3(<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">  `y1 = P1(<span class="number">2</span>);  y2 = P2(<span class="number">2</span>);  y3 = P3(<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">  `z1 = x2^<span class="number">2</span> + y2^<span class="number">2</span> - x1^<span class="number">2</span> - y1^<span class="number">2</span>;`</span><br><span class="line"></span><br><span class="line">  `z2 = x3^<span class="number">2</span> + y3^<span class="number">2</span> - x1^<span class="number">2</span> - y1^<span class="number">2</span>;`</span><br><span class="line"></span><br><span class="line">  `z3 = x3^<span class="number">2</span> + y3^<span class="number">2</span> - x2^<span class="number">2</span> - y2^<span class="number">2</span>;`</span><br><span class="line"></span><br><span class="line">  `A = [(x2-x1), (y2-y1); (x3-x1), (y3-y1); (x3-x2), (y3-y2)];`</span><br><span class="line"></span><br><span class="line">  `B = <span class="number">0.5</span>*[z1; z2; z3];`</span><br><span class="line"></span><br><span class="line">  `P0 = (A&#x27;*A)\A&#x27;*B;`</span><br><span class="line"></span><br><span class="line">  `R1 = <span class="built_in">sqrt</span>( (P0(<span class="number">1</span>) - P1(<span class="number">1</span>))^<span class="number">2</span> + (P0(<span class="number">2</span>) - P1(<span class="number">2</span>))^<span class="number">2</span> );`</span><br><span class="line"></span><br><span class="line">  `R2 = <span class="built_in">sqrt</span>( (P0(<span class="number">1</span>) - P2(<span class="number">1</span>))^<span class="number">2</span> + (P0(<span class="number">2</span>) - P2(<span class="number">2</span>))^<span class="number">2</span> );`</span><br><span class="line"></span><br><span class="line">  `R3 = <span class="built_in">sqrt</span>( (P0(<span class="number">1</span>) - P3(<span class="number">1</span>))^<span class="number">2</span> + (P0(<span class="number">2</span>) - P3(<span class="number">2</span>))^<span class="number">2</span> );`</span><br><span class="line"></span><br><span class="line">  `R = (R1 + R2 + R3)/<span class="number">3</span>;`</span><br><span class="line"></span><br><span class="line">  `P0 = P0&#x27;;`</span><br><span class="line"></span><br><span class="line">`End`</span><br></pre></td></tr></table></figure>

<p><em>图4-3（上） 对于二维地图中一条直线的拟合（红线为拟合结果）</em></p>
<p><em>（可以看到拟合效果相对良好）</em></p>
<p>  <img src="/images/radarcar/4-3.png" alt="21"></p>
<p><em>图4-4（右） 对于给定圆坐标数据的RANSAC拟合（上图为给定的圆，下图为拟合出的圆）</em></p>
<p><em>（说明该算法实现的有效性）</em></p>
<p><img src="/images/radarcar/4-4.png" alt="22"></p>
<h6 id="4-3-3-建立势场并利用梯度下降法确定最优路径（人工势场法）"><a href="#4-3-3-建立势场并利用梯度下降法确定最优路径（人工势场法）" class="headerlink" title="4.3.3 建立势场并利用梯度下降法确定最优路径（人工势场法）"></a>4.3.3 建立势场并利用梯度下降法确定最优路径（人工势场法）</h6><p>人工势场法引入了物理中斥力场和引力场的思想，把工作环境抽象为一个电磁场，而机器人则是其中的一个电荷，机器人在磁场力的作用下移动。人工势场法会在障碍物周围构建斥力场、在目标点周围构建引力场；这样，机器人便能够在斥力场和引力场的作用下向目标点移动。同时，当障碍物和目标点太近时，机器人很可能会因为刹不住车而出现无法到达目标点等问题，这也就出现了一堆相应的优化算法。</p>
<p>通过利用RANSAC算法对于地图中具有特定形状的边界、障碍物与目标物进行识别，我们成功获得了障碍物与目标点的坐标。在此基础之上，我们基于原型函数<img src="/images/radarcar/4-5.png" alt="23">（a,b即为障碍物&#x2F;目标点的x,y坐标）建立势场。通过观察不难发现，在以（a,b）为圆心、半径为1的圆之外的地方该势函数均为正，反之为负。事实上，对于场地内的3个障碍物以及1个目标物而言，所形成的是一个叠加场，由原型函数作用于不同的点叠加而成。在此，我们不妨认为势场为正处具有排斥力而势场为负处具有吸引力，需要吸引小车向目标点走去而花费尽量少的能量。在这样的算法理念基础上，我们需要在代表目标点的原型函数部分加上负号；更进一步的，我们还希望这个吸引力足够大而防止被障碍物阻断，因此在建立势场时，不妨在代表目标点的原型函数前乘上一定的系数以保证其足够强大的吸引力。最终，我们根据地图实际情况，建立了整个势场叠加后的函数方程：F&#x3D;log(sqrt((x-4.75).^2+(y-12.5).^2))+log(sqrt((x-12).^2+(y-7.6).^2))+log(sqrt((x-11.2).^2+(y-13).^2))-5*log(sqrt((x-16.5).^2+(y-18.5).^2))，并根据该函数绘制了势能图（如图4-5）与等势线图（如图4-6)。</p>
<p><em>图4-5 势场函数势能图</em></p>
<p><img src="/images/radarcar/4-6.png" alt="24"></p>
<p><em>图4-6 势场函数等势线图</em></p>
<p><img src="/images/radarcar/4-7.png" alt="25"></p>
<p>该部分代码如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">`<span class="comment">%Step3:通过识别得到的障碍物和目标坐标建立势场`</span></span><br><span class="line"></span><br><span class="line">`v=<span class="number">-2</span>:<span class="number">1</span>:<span class="number">22</span>;`</span><br><span class="line"></span><br><span class="line">`[x,y]=<span class="built_in">meshgrid</span>(v);`</span><br><span class="line"></span><br><span class="line">`F=<span class="built_in">log</span>(<span class="built_in">sqrt</span>((x<span class="number">-4.75</span>).^<span class="number">2</span>+(y<span class="number">-12.5</span>).^<span class="number">2</span>))+<span class="built_in">log</span>(<span class="built_in">sqrt</span>((x<span class="number">-12</span>).^<span class="number">2</span>+(y<span class="number">-7.6</span>).^<span class="number">2</span>))+<span class="built_in">log</span>(<span class="built_in">sqrt</span>((x<span class="number">-11.2</span>).^<span class="number">2</span>+(y<span class="number">-13</span>).^<span class="number">2</span>))<span class="number">-5</span>*<span class="built_in">log</span>(<span class="built_in">sqrt</span>((x<span class="number">-16.5</span>).^<span class="number">2</span>+(y<span class="number">-18.5</span>).^<span class="number">2</span>));`</span><br><span class="line"></span><br><span class="line">`[px,py]=gradient(F,<span class="number">1</span>,<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`contour(x,y,F);`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">hold</span> on;`</span><br><span class="line"></span><br><span class="line">`title(<span class="string">&#x27;人工势场法路径规划&#x27;</span>);`</span><br><span class="line"></span><br><span class="line">`quiver(x,y,px,py,<span class="number">0</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">figure</span>(<span class="number">2</span>);`</span><br><span class="line"></span><br><span class="line">`surf(x,y,-F);`</span><br></pre></td></tr></table></figure>

<p>在建立完势场之后，由于我们需要寻找的是避开障碍物而通往目标点的最优路径，实际上即为所耗费能量最少的路径，我们引入了梯度下降法，通过间隔相同距离的不断迭代，在每一处都寻找能量下降最快的方向（即为梯度方向）前进（在MATLAB中通过调用函数文件path_plan.m与computP.m实现该功能），最终得到了如下图4-7绿色线所示的最优路径。</p>
<p><em>图4-7 人工势场法路径规划结果（绿色即为规划出的最优路径）</em></p>
<p><img src="/images/radarcar/4-8.png" alt="26"></p>
<p>其中，path_plan函数是整个算法过程中的关键，也是梯度下降思想的集中体现，其大致实现思路流程如下：</p>
<p>1）起点、终点 、障碍物、迭代次数、取点半径等参数的设定</p>
<p>2）以起点为中心，作半径为r的圆，从圆上取八个均布的点</p>
<p>3）分别计算八个点的前进“代价”—— 终点对其的引力+所有障碍物对其的斥力</p>
<p>4）取“代价”最小的点的坐标，结合现有起点，计算得到新的起点，然后重复上述内容</p>
<p>5）当发现 一个点距离终点很近 or 迭代的次数计算完 程序停止。</p>
<p>该部分的实现代码如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">`<span class="comment">%Step4:通过人工势场法确定最优路径`</span></span><br><span class="line"></span><br><span class="line">`axis([<span class="number">-3</span> <span class="number">22</span> <span class="number">-3</span> <span class="number">22</span>]);`</span><br><span class="line"></span><br><span class="line">`begin=[<span class="number">0</span>;<span class="number">0</span>]<span class="comment">%起始点坐标`</span></span><br><span class="line"></span><br><span class="line">`over=[<span class="number">16.5</span>;<span class="number">18.5</span>];<span class="comment">%目标点坐标`</span></span><br><span class="line"></span><br><span class="line">`<span class="built_in">figure</span>(<span class="number">1</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">hold</span> on;`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">plot</span>(begin(<span class="number">1</span>),begin(<span class="number">2</span>),<span class="string">&#x27;*b&#x27;</span>,<span class="string">&#x27;MarkerSize&#x27;</span>,<span class="number">10</span>);`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">plot</span>(over(<span class="number">1</span>),over(<span class="number">2</span>),<span class="string">&#x27;*b&#x27;</span>,<span class="string">&#x27;MarkerSize&#x27;</span>,<span class="number">10</span>);`</span><br><span class="line"></span><br><span class="line">`obstacle=[<span class="number">4.75</span>,<span class="number">12</span>,<span class="number">11.35</span>;<span class="number">12.75</span>,<span class="number">7.5</span>,<span class="number">12</span>];<span class="comment">%障碍物坐标`</span></span><br><span class="line"></span><br><span class="line">`point= path_plan(begin,over,obstacle);`</span><br><span class="line"></span><br><span class="line">`<span class="function"><span class="keyword">function</span> <span class="params">[ point ]</span> = <span class="title">path_plan</span><span class="params">(begin,over,obstacle)</span>`</span></span><br><span class="line"></span><br><span class="line">`iters=<span class="number">1</span>; <span class="comment">%迭代次数`</span></span><br><span class="line"></span><br><span class="line">`curr=begin;`</span><br><span class="line"></span><br><span class="line">`testR=<span class="number">0.1</span>;  <span class="comment">%测试8点的圆的半径为0.1`</span></span><br><span class="line"></span><br><span class="line">`<span class="keyword">while</span> (norm(curr-over)&gt;<span class="number">0.2</span>) &amp;&amp; (iters&lt;=<span class="number">2000</span>)`</span><br><span class="line"></span><br><span class="line">  `point(:,iters)=curr;`</span><br><span class="line"></span><br><span class="line">`<span class="comment">%   attr=attractive(curr,over);`</span></span><br><span class="line"></span><br><span class="line">`<span class="comment">%   repu=repulsion(curr,obstacle);`</span></span><br><span class="line"></span><br><span class="line">`<span class="comment">%curoutput=computP(curr,over,obstacle);`</span></span><br><span class="line"></span><br><span class="line">  `<span class="comment">%计算当前点附近半径为0.2的8个点的势能，然后让当前点的势能减去8个点的势能取差值最大的，确定这个方向，就是下一步迭代的点`</span></span><br><span class="line"></span><br><span class="line">  `<span class="comment">%先求这八个点的坐标`</span></span><br><span class="line"></span><br><span class="line">  `<span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="number">8</span>    testPoint(:,<span class="built_in">i</span>)=[testR*<span class="built_in">sin</span>((<span class="built_in">i</span><span class="number">-1</span>)*<span class="built_in">pi</span>/<span class="number">4</span>)+curr(<span class="number">1</span>);testR*<span class="built_in">cos</span>((<span class="built_in">i</span><span class="number">-1</span>)*<span class="built_in">pi</span>/<span class="number">4</span>)+curr(<span class="number">2</span>)];`</span><br><span class="line"></span><br><span class="line">​    `testOut(:,<span class="built_in">i</span>)=computP(testPoint(:,<span class="built_in">i</span>),over,obstacle);`</span><br><span class="line"></span><br><span class="line">​    `<span class="comment">%找出来最小的就可以了`</span></span><br><span class="line"></span><br><span class="line">  `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">  `[temp num]=<span class="built_in">min</span>(testOut);`</span><br><span class="line"></span><br><span class="line">  `<span class="comment">%迭代的距离为0.1`</span></span><br><span class="line"></span><br><span class="line">  `curr=(curr+testPoint(:,num))/<span class="number">2</span>;`</span><br><span class="line"></span><br><span class="line">  `<span class="built_in">plot</span>(curr(<span class="number">1</span>),curr(<span class="number">2</span>),<span class="string">&#x27;og&#x27;</span>);`</span><br><span class="line"></span><br><span class="line">  `iters=iters+<span class="number">1</span>;`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">`<span class="function"><span class="keyword">function</span> <span class="params">[ output ]</span> = <span class="title">computP</span><span class="params">( curr,over,obstacle )</span>`</span></span><br><span class="line"></span><br><span class="line"> `k_att=<span class="number">1</span>;`</span><br><span class="line"></span><br><span class="line">`repu=<span class="number">0</span>;`</span><br><span class="line"></span><br><span class="line">`k_rep=<span class="number">100</span>;`</span><br><span class="line"></span><br><span class="line">`Q_star=<span class="number">2</span>;`</span><br><span class="line"></span><br><span class="line">`<span class="comment">%计算当前点距离终点的引力`</span></span><br><span class="line"></span><br><span class="line">`attr=<span class="number">1</span>/<span class="number">2</span>*k_att*(norm(curr-over))^<span class="number">2</span>;`</span><br><span class="line"></span><br><span class="line">`<span class="comment">%计算障碍点与当前点的斥力`</span></span><br><span class="line"></span><br><span class="line">`<span class="comment">%设定障碍的斥力作用半径为2`</span></span><br><span class="line"></span><br><span class="line">`<span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">size</span>(obstacle,<span class="number">2</span>)`</span><br><span class="line"></span><br><span class="line">   `<span class="keyword">if</span> norm(curr-obstacle(:,<span class="built_in">i</span>))&lt;=Q_star`</span><br><span class="line"></span><br><span class="line">​    `repu=repu+<span class="number">1</span>/<span class="number">2</span>*k_rep*(<span class="number">1</span>/norm(curr-obstacle(:,<span class="built_in">i</span>))<span class="number">-1</span>/Q_star)^<span class="number">2</span>;`</span><br><span class="line"></span><br><span class="line">  `<span class="keyword">else</span>`</span><br><span class="line"></span><br><span class="line">​    `repu=repu+<span class="number">0</span>;`</span><br><span class="line"></span><br><span class="line">  `<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">end</span>`</span><br><span class="line"></span><br><span class="line">`output=attr+repu;`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">end</span>`</span><br></pre></td></tr></table></figure>

<h5 id="4-4-实现的实际效果"><a href="#4-4-实现的实际效果" class="headerlink" title="4.4 实现的实际效果"></a>4.4 实现的实际效果</h5><p>事实上，尽管RANSAC算法在理论上已经具备足够的拟合精度，但在实际的识别过程中，由于激光雷达扫描获取的数据过多而导致干扰噪点的数量达到了一定规模，以及在算法参数设置上考虑到算力有限等因素而没有采用精确度最高的设置，诸如此类的干扰因素导致在多条直线识别时出现了互相覆盖与识别错误的情况，识别圆形时也并未识别出目标点的圆柱所在处，因此在实际的测试过程中，利用RANSAC算法识别圆与直线以获取目标点和障碍物坐标这一过程并未取得特别良好的效果。为了后面的路径规划算法顺利开展，我们最终采用人工识别的方式，分别给出了起点、障碍物以及目标点的大致坐标，并顺利实现了利用人工势场法进行路径规划的算法，合理规划出了从起点避开障碍物到达目标点停下的最优路径，并通过STM32单片机编程成功驱动了小车按照规划好的路径进行运动，顺利完成开环测试。</p>
<br>

<h4 id="五、实验结果及分析"><a href="#五、实验结果及分析" class="headerlink" title="五、实验结果及分析"></a><strong>五、实验结果及分析</strong></h4><hr>
<p>经过几次测试，在进行4至5个位置的扫描之后，通过将数据进行变换与拼接，可以得到一张较为完整的二维地图，再将地图中通过RANSAC算法识别出的特定点位数据读入程序运行，可以得到一条较为合理的最优路径。</p>
<p>事实上，在前面的嵌入式控制系统设计部分，我们计划采用PID方式对于小车与电机进行反馈调节控制，但在实际的测试中，PID的控制方式实现的效果并不尽如人意，无法合理利用MATLAB路径规划所得到的数据结果顺利完成测试。于是我们果断选择了重新使用PWM的方式，依托于MATLAB程序运行规划出的路径对应的相关数据计算所需要的PWM以及延时的时间。最终采用的代码如下图5-1所示（具体KEIL工程内容详见Run.zip附件)。</p>
<p><em>图5-1 PWM电机驱动部分实现代码</em></p>
<p><img src="/images/radarcar/5-1.png" alt="27"></p>
<p><img src="/images/radarcar/5-2.png" alt="28"></p>
<p>通过调整PWM的方式对小车进行开环运动控制，最终可以较好达到项目要求。（实现效果见下图5-2及视频附件“测试.mp4”）</p>
<p><em>图5-2 静态路径规划实现效果实地测试</em></p>
<p><img src="/images/radarcar/5-3.jpg" alt="29"></p>
<p><img src="/images/radarcar/5-4.jpg" alt="30"></p>
<p>虽然静态路径规划部分完成情况相对较好，但遗憾的是，由于对于C语言编程不是特别熟悉，包括受限于对库的了解、算法的时间复杂度较高、实现繁琐以及对于STM32内部利用效率的不完全开发等因素，最终并没有能够成功完成动态部分的路径规划。事实上，动态情况下的路径规划更符合我们在日常生活中常见的应用场景，不论是扫地机器人还是汽车导航，本身所应对的环境都在时刻发生着改变，因此动态的路径规划问题仍然值得在课程结束之后继续进行深挖和探索。希望在未来的工程实践中，我们能够以更加定量化的思维去分析和思考问题，同时更加熟练的掌握相关的算法设计，提高自己的硬件嵌入式编程能力。</p>
<br>

<h4 id="六、个人总结"><a href="#六、个人总结" class="headerlink" title="六、个人总结"></a><strong>六、个人总结</strong></h4><hr>
<p>在路径规划这一阶段的课程中，我在前半段主要负责的是STM32单片机的一些基础开发，对于其基本的开发流程以及GPIO等基本的功能模块有了一定的了解并能进行一些简单的32单片机编程；在后半段，我主要负责整体路径规划项目的思路整理与算法设计，结合课堂上介绍的RANSAC识别算法以及人工势场法规划路径，课下积极结合概念的巩固以及相关资料的查询，阅读了相关的示例代码，并根据算法的整体思路自己动手实现了RANSAC算法对于直线与圆的识别拟合以及在建立的势场中利用梯度下降法实现路径规划的MATLAB程序，积极将自己的算法实现与队友编写的STM32 C语言程序融合在一起，在与队友的充分交流沟通与合作的基础上共同完成了该项目。在死亡之桥的测试项目中，我在一个人调试了单片机程序许久未果后，与队友进行了积极的沟通与合作，也基本确定了由我负责编写MATLAB算法程序给队友的单片机编程提供数据支持的合作模式，对于我们团队的所有人来说都是一次难忘的经历。在利用激光雷达扫描地图的过程中，我们也充分信任彼此，在他们编写好了读取雷达数据的相关程序后，我结合着MATLAB程序的需求对于KEIL代码的输出格式部分进行了一定的修改，在通力合作下最终圆满完成了该项任务。除此之外，也非常感谢整个课程阶段过程中凌睿老师在算法思路方面对我们进行的一系列教学与指导以及助教学长们在答疑时的倾力相助。</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/head.jpg" alt="明诚"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">明诚</p><p class="is-size-6 is-block">走过的路，每一步都算数。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>江苏 苏州</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">20</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">28</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Asgard-Tim" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Asgard-Tim"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://www.weibo.com/u/6315188431"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://space.bilibili.com/171895120"><i class="fab fa-bilibili"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://jaguarliu.me/ai-projects" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AI-Tools</span></span><span class="level-right"><span class="level-item tag">jaguarliu.me</span></span></a></li><li><a class="level is-mobile" href="https://zlibrary-east.se/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Zlibrary</span></span><span class="level-right"><span class="level-item tag">zlibrary-east.se</span></span></a></li><li><a class="level is-mobile" href="https://www.cnki.net/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CNKI</span></span><span class="level-right"><span class="level-item tag">www.cnki.net</span></span></a></li><li><a class="level is-mobile" href="https://chat.openai.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ChatGPT</span></span><span class="level-right"><span class="level-item tag">chat.openai.com</span></span></a></li><li><a class="level is-mobile" href="https://www.iodraw.com/tool/sketch" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">照片转素描</span></span><span class="level-right"><span class="level-item tag">www.iodraw.com</span></span></a></li><li><a class="level is-mobile" href="https://www.integral-calculator.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">积分计算器</span></span><span class="level-right"><span class="level-item tag">www.integral-calculator.com</span></span></a></li><li><a class="level is-mobile" href="https://cli.im/text" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">二维码生成器</span></span><span class="level-right"><span class="level-item tag">cli.im</span></span></a></li><li><a class="level is-mobile" href="https://tool.sacdr.net/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">音乐解锁</span></span><span class="level-right"><span class="level-item tag">tool.sacdr.net</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/About-XJH/"><span class="level-start"><span class="level-item">About XJH</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"><span class="level-start"><span class="level-item">碎碎念</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/CQU/"><span class="level-start"><span class="level-item">CQU</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/"><span class="level-start"><span class="level-item">个人项目</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">动手学深度学习</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/"><span class="level-start"><span class="level-item">课程项目</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%AE%9A%E9%87%8F%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95I/"><span class="level-start"><span class="level-item">定量工程设计方法I</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">工程原理</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">工程设计</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"><span class="level-start"><span class="level-item">线性代数</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">软件设计</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/2023/10/05/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"><img src="/images/phi.png" alt="3.线性神经网络"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-10-05T08:20:00.000Z">2023-10-05</time></p><p class="title"><a href="/2023/10/05/3.%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/">3.线性神经网络</a></p><p class="categories"><a href="/categories/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">动手学深度学习</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/10/01/%E6%8A%A5%E5%91%8A/"><img src="/images/wall/3.jpg" alt="具有一定扶正能力的船舶设计"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-10-01T10:08:58.000Z">2023-10-01</time></p><p class="title"><a href="/2023/10/01/%E6%8A%A5%E5%91%8A/">具有一定扶正能力的船舶设计</a></p><p class="categories"><a href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/">课程项目</a> / <a href="/categories/%E8%AF%BE%E7%A8%8B%E9%A1%B9%E7%9B%AE/%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1/">工程设计</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/09/27/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/"><img src="/images/phi.png" alt="2.预备知识"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-09-27T06:06:00.000Z">2023-09-27</time></p><p class="title"><a href="/2023/09/27/2.%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/">2.预备知识</a></p><p class="categories"><a href="/categories/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">动手学深度学习</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/08/02/index/"><img src="/images/book.jpeg" alt="Welcome to XJH&#039;s Secret Base!"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-08-02T11:52:30.000Z">2023-08-02</time></p><p class="title"><a href="/2023/08/02/index/">Welcome to XJH&#039;s Secret Base!</a></p><p class="categories"><a href="/categories/About-XJH/">About XJH</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/07/05/20230705/"><img src="/images/story/1.jpg" alt="20230705"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-07-05T01:43:03.000Z">2023-07-05</time></p><p class="title"><a href="/2023/07/05/20230705/">20230705</a></p><p class="categories"><a href="/categories/About-XJH/">About XJH</a> / <a href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/">碎碎念</a> / <a href="/categories/About-XJH/%E7%A2%8E%E7%A2%8E%E5%BF%B5/CQU/">CQU</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C51/"><span class="tag">C51</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CQU/"><span class="tag">CQU</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ChatGPT/"><span class="tag">ChatGPT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FPGA/"><span class="tag">FPGA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MATLAB/"><span class="tag">MATLAB</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/QQbot/"><span class="tag">QQbot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RANSAC/"><span class="tag">RANSAC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROS/"><span class="tag">ROS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/STM32/"><span class="tag">STM32</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/XJH/"><span class="tag">XJH</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BC%A0%E7%83%AD%E5%AD%A6/"><span class="tag">传热学</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%86%9B%E8%AE%AD/"><span class="tag">军训</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="tag">动手学深度学习</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/"><span class="tag">单片机</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB/"><span class="tag">图像识别</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="tag">学习笔记</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%9A%E9%87%8F%E5%88%86%E6%9E%90/"><span class="tag">定量分析</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%8F%E4%BD%9C%E6%96%87/"><span class="tag">小作文</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%8F%E8%BD%A6/"><span class="tag">小车</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"><span class="tag">年终总结</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%9F%E6%97%A5/"><span class="tag">生日</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"><span class="tag">碎碎念</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"><span class="tag">线性代数</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%88%B9/"><span class="tag">船</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/"><span class="tag">路径规划</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/title.png" alt="XJH&#039;s Secret Base" height="28"></a><p class="is-size-7"><span>&copy; 2023 明诚</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© Copyright by XJH 此心安处是吾乡。</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Asgard-Tim"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/chitose.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>